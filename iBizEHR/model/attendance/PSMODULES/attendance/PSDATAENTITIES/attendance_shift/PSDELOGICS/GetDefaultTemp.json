{
  "codeName" : "GetDefaultTemp",
  "defaultParamName" : "DEFAULT",
  "dynaModelFilePath" : "PSMODULES/attendance/PSDATAENTITIES/attendance_shift/PSDELOGICS/GetDefaultTemp.json",
  "logicName" : "获取默认班次临时数据",
  "name" : "获取默认班次临时数据",
  "scriptCode" : "console.log('获取默认班次临时数据:');\r\n\r\nconst serviceUtil = ibiz.hub.getApp(context.srfappid).deService;\nconst service = await serviceUtil.getService(context, 'attendanceapp.attendance_shift');\r\n//获取默认shift\r\nconst list = service.local.getList(context);\r\nconst defaultShift = list.find(item =>item.default_flag == 1 );\r\ncontext.shift = defaultShift.id\r\nconsole.log(\"计算工时\" + defaultShift);\r\nvar _scopes = defaultShift.scopes || [];\r\nvar totalWorkingMinutes = 0;\r\n\r\nfunction timeToMinutes(timeStr) {\r\n  const parts = timeStr.split(':');\r\n  const hours = parseInt(parts[0], 10);\r\n  const minutes = parseInt(parts[1], 10);\r\n  return hours * 60 + minutes;\r\n}\r\n\r\n// 遍历现有 scope 计算总工时\r\nfor (var i = 0; i < _scopes.length; i++) {\r\n  var scope = _scopes[i];\r\n  // 转换时间为分钟数\r\n  const start = timeToMinutes(scope.start_base_time);\r\n  const end = timeToMinutes(scope.end_base_time);\r\n  \r\n  // 计算单个班次工时（分钟）\r\n  totalWorkingMinutes += (end - start);\r\n}\r\n\r\n// 转换为小时分钟格式\r\nvar hours = Math.floor(Math.abs(totalWorkingMinutes) / 60);\r\nvar minutes = totalWorkingMinutes % 60;\r\nvar workLoadText = hours + \"小时\" + minutes + \"分钟\";\r\n\r\ndefaultShift.work_load = workLoadText;\r\nreturn defaultShift;\r\n",
  "customCode" : true,
  "enableBackend" : false,
  "enableFront" : true
}