{
  "codeName" : "batchReissue",
  "defaultParamName" : "Default",
  "dynaModelFilePath" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record/PSDELOGICS/batchReissue.json",
  "logicName" : "批量补卡",
  "name" : "批量补卡",
  "getPSDELogicNodes" : [ {
    "codeName" : "Begin",
    "leftPos" : 200,
    "logicNodeType" : "BEGIN",
    "name" : "开始",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "DEBUGPARAM_01"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "Begin"
      }
    } ],
    "topPos" : 212,
    "parallelOutput" : true
  }, {
    "codeName" : "DEBUGPARAM_01",
    "getDstPSDELogicParam" : {
      "modelref" : true,
      "id" : "Default"
    },
    "leftPos" : 300,
    "logicNodeType" : "DEBUGPARAM",
    "name" : "调试逻辑参数",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "RAWSFCODE_01"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "DEBUGPARAM_01"
      }
    } ],
    "topPos" : 210,
    "parallelOutput" : true
  }, {
    "code" : "def _default = logic.param('Default').getReal()\r\ndef depts = logic.param('depts').getReal()\r\ndef persons = logic.param('persons').getReal()\r\ndef member_name = _default.get(\"member_name\")\r\nif (member_name != null && member_name != \"\") {\r\n    def jsonParser = new groovy.json.JsonSlurper()\r\n    def person_range = jsonParser.parseText(member_name)\r\n    person_range.each { item ->\r\n        if (item.type == \"dept\") {\r\n            def dept = sys.entity('user_object')\r\n            dept.set(\"n_dept_id_eq\", item.id)\r\n            depts.add(dept)\r\n        } else {\r\n            def person = sys.entity('employee')\r\n            person.set(\"id\", item.id)\r\n            person.set(\"name\", item.name)\r\n            persons.add(person)\r\n        }\r\n    }\r\n}",
    "codeName" : "RAWSFCODE_01",
    "codeType" : "Groovy",
    "leftPos" : 520,
    "logicNodeType" : "RAWSFCODE",
    "name" : "执行脚本代码",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "LOOPSUBCALL_01"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "RAWSFCODE_01"
      }
    } ],
    "topPos" : 210,
    "parallelOutput" : true
  }, {
    "codeName" : "LOOPSUBCALL_01",
    "getDstPSDELogicParam" : {
      "modelref" : true,
      "id" : "temp"
    },
    "leftPos" : 770,
    "logicNodeType" : "LOOPSUBCALL",
    "name" : "循环子调用",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "PREPAREPARAM_01"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "LOOPSUBCALL_01"
      },
      "subCallLink" : true
    }, {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "RAWSFCODE_03"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "LOOPSUBCALL_01"
      }
    } ],
    "getSrcPSDELogicParam" : {
      "modelref" : true,
      "id" : "depts"
    },
    "topPos" : 210,
    "parallelOutput" : true
  }, {
    "code" : "def persons = logic.param('persons').getReal()\r\ndef _default = logic.param('Default').getReal()\r\n\r\npersons.each { emp ->\r\n    def record = sys.entity('attendance_clock_in_record')\r\n    record.set(\"id\",net.ibizsys.runtime.util.KeyValueUtils.genUniqueId())\r\n    record.set(\"member_id\",emp.id)\r\n    record.set(\"member_name\",emp.name)\r\n    record.set(\"dept_name\",emp.dept_name)\r\n    record.set(\"dept_id\",emp.dept_id)\r\n    record.set(\"checkin_type\",\"reissue\")\r\n    record.set(\"checkin_time\",_default.get(\"checkin_time\"))\r\n    def recordRuntime = sys.dataentity('attendance_clock_in_record')\r\n    recordRuntime.create(record)\r\n}",
    "codeName" : "RAWSFCODE_03",
    "codeType" : "Groovy",
    "leftPos" : 1024,
    "logicNodeType" : "RAWSFCODE",
    "name" : "创建打卡记录",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "END_01"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "RAWSFCODE_03"
      }
    } ],
    "topPos" : 210,
    "parallelOutput" : true
  }, {
    "codeName" : "END_01",
    "leftPos" : 1230,
    "logicNodeType" : "END",
    "name" : "结束",
    "topPos" : 210,
    "parallelOutput" : true
  }, {
    "codeName" : "PREPAREPARAM_01",
    "leftPos" : 770,
    "logicNodeType" : "PREPAREPARAM",
    "name" : "准备参数",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "DEDATASET_01"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "PREPAREPARAM_01"
      }
    } ],
    "getPSDELogicNodeParams" : [ {
      "dstFieldName" : "n_dept_id_eq",
      "getDstPSDELogicParam" : {
        "modelref" : true,
        "id" : "filter"
      },
      "paramAction" : "SETPARAMVALUE",
      "srcFieldName" : "n_dept_id_eq",
      "getSrcPSDELogicParam" : {
        "modelref" : true,
        "id" : "temp"
      },
      "srcValueType" : "SRCDLPARAM"
    } ],
    "topPos" : 330,
    "parallelOutput" : true
  }, {
    "codeName" : "DEDATASET_01",
    "getDstPSDEDataSet" : {
      "modelref" : true,
      "id" : "deptall"
    },
    "getDstPSDELogicParam" : {
      "modelref" : true,
      "id" : "filter"
    },
    "getDstPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
    },
    "leftPos" : 770,
    "logicNodeType" : "DEDATASET",
    "name" : "实体数据集",
    "getPSDELogicLinks" : [ {
      "getDstPSDELogicNode" : {
        "modelref" : true,
        "id" : "RAWSFCODE_02"
      },
      "name" : "连接名称",
      "getSrcPSDELogicNode" : {
        "modelref" : true,
        "id" : "DEDATASET_01"
      }
    } ],
    "getRetPSDELogicParam" : {
      "modelref" : true,
      "id" : "employees"
    },
    "topPos" : 450,
    "parallelOutput" : true
  }, {
    "code" : "def employees = logic.param('employees').getReal()\r\ndef persons = logic.param('persons').getReal()\r\ndef uniqueMemberIdMap = new HashMap()\r\n// 先将原始 persons 放入Map\r\npersons.each { emp ->\r\n    uniqueMemberIdMap.put(emp.id, emp)\r\n}\r\nemployees.each { emp ->\r\n    uniqueMemberIdMap.put(emp.id, emp)\r\n}\r\npersons.clear()\r\npersons.addAll(uniqueMemberIdMap.values())",
    "codeName" : "RAWSFCODE_02",
    "codeType" : "Groovy",
    "leftPos" : 770,
    "logicNodeType" : "RAWSFCODE",
    "name" : "执行脚本代码",
    "topPos" : 580,
    "parallelOutput" : true
  } ],
  "getPSDELogicParams" : [ {
    "codeName" : "Default",
    "logicName" : "传入变量",
    "name" : "传入变量",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
    },
    "default" : true,
    "entityParam" : true
  }, {
    "codeName" : "allMembers",
    "logicName" : "allMembers",
    "name" : "allMembers",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
    },
    "entityListParam" : true
  }, {
    "codeName" : "depts",
    "logicName" : "depts",
    "name" : "depts",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
    },
    "entityListParam" : true
  }, {
    "codeName" : "employees",
    "logicName" : "employees",
    "name" : "employees",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
    },
    "entityPageParam" : true
  }, {
    "codeName" : "filter",
    "logicName" : "filter",
    "name" : "filter",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
    },
    "filterParam" : true
  }, {
    "codeName" : "persons",
    "logicName" : "persons",
    "name" : "persons",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
    },
    "entityListParam" : true
  }, {
    "codeName" : "temp",
    "logicName" : "temp",
    "name" : "temp",
    "getParamPSDataEntity" : {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
    },
    "entityParam" : true
  } ],
  "getStartPSDELogicNode" : {
    "modelref" : true,
    "id" : "Begin"
  },
  "enableBackend" : true,
  "enableFront" : false
}