{
  "getAllPSApps" : [ {
    "modelref" : true,
    "path" : "PSSYSAPPS/attendanceapp/PSSYSAPP.json"
  } ],
  "getAllPSCodeLists" : [ {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList64.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/leave_application_statistics.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/abnormal_statistics.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList75.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList68.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/attendance_result.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList95.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSCODELISTS/copy_give.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList27.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList118.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/unit_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList42.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList60.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList81.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList83.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList94.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList79.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_certificate.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_display_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList30.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/clock_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/Week2.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/attendance_policy.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList113.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/checkin_info.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CycleDays.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList11.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/resource_resource_resource_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList116.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/barcode_source.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList84.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList65.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/periodFrom.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/WFStates.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList77.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList70.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/checkin_method_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList48.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/workday_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/attendance_statistics.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList38.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/Week4.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList5.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList24.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/details_result.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList114.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList41.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/DurationStatistics.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/TrueFalse.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList37.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList111.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/search_month.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList34.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/Duration.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/leave_status.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/months.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList28.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList62.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList6.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList46.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList23.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_week_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList86.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_attendance_out_mode.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList89.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList2.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList90.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList19.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList67.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList4.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/abnormal_attendance_result.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/ShiftNum.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/workingNumber.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_activity_exception_decoration.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList102.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList20.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/checkin_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList50.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList9.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList29.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList45.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList74.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList39.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList101.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList3.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList1.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/holiday.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList32.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList87.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/cycle.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList57.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/approval_status.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/daily_statistics.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/schedule_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/manualType.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/overtime_kind.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList16.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList7.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/overtime_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/CycleWeeks.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/holiday_dyna.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/device_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList40.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList58.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList10.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList36.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList93.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList92.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList107.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/member_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList88.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/holidayType.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/inversion_count.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList80.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList52.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList8.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList103.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList35.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList55.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList33.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList59.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList104.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList99.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList21.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList108.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_activity_state.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList96.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList112.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_report_calendar_state.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList14.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_state.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList56.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/same_restday.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/elastic_minutes.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList100.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/checkin_frequency.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/attendance_rules.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_dayofweek.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList117.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_leaves_time_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList66.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/YesNo.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/attendance_status.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/SysOperator.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList13.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList54.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList12.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList71.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList98.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList31.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSCODELISTS/employeeType.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/off_time_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/workday.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/shift_status.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_attendance_overtime_status.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList105.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList22.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/AbnormalStatistics.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList17.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/kiosk_mode.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_request_date_from_period.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/base_info.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList47.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/Week1.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList61.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_day_period.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList106.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/overtime_validation.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSCODELISTS/dept.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_gender.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList97.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/leave_calc_type.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList18.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList69.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList115.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList63.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList49.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/effectConfig.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList26.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList91.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList85.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_distance_home_work_unit.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList82.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList72.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/Week3.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList110.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_employee_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSCODELISTS/hr_attendance_in_mode.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSCODELISTS/employee.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/deli_checkin_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/leave_ask_unit.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/application_status.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList78.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/DailystatisticsBase.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/with_salary.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList109.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/leaveScopeType.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/SortDir.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList15.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList53.json"
  }, {
    "modelref" : true,
    "path" : "PSCODELISTS/CodeList76.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/all_schedule_type.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSCODELISTS/attendance_type.json"
  } ],
  "getAllPSDEOPPrivs" : [ {
    "logicName" : "建立",
    "name" : "CREATE"
  }, {
    "logicName" : "删除",
    "name" : "DELETE"
  }, {
    "logicName" : "拒绝",
    "name" : "DENY"
  }, {
    "logicName" : "无控制",
    "name" : "NONE"
  }, {
    "logicName" : "读取",
    "name" : "READ"
  }, {
    "logicName" : "考勤计算",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "ATTENDANCE_CALCULATION"
    },
    "mapSysUniResCode" : "ATTENDANCE_CALCULATION",
    "name" : "SRFUR__ATTENDANCE_CALCULATION",
    "mapSysUniRes" : true
  }, {
    "logicName" : "批量推送",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "BATCH_PUSH"
    },
    "mapSysUniResCode" : "BATCH_PUSH",
    "name" : "SRFUR__BATCH_PUSH",
    "mapSysUniRes" : true
  }, {
    "logicName" : "清除手动排班",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
    },
    "mapSysUniResCode" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE",
    "name" : "SRFUR__CLEAR_MANUAL_ATTENDANCE_SCHEDULE",
    "mapSysUniRes" : true
  }, {
    "logicName" : "删除",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "DELETE"
    },
    "mapSysUniResCode" : "DELETE",
    "name" : "SRFUR__DELETE",
    "mapSysUniRes" : true
  }, {
    "logicName" : "删除得力信息",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "DELETE_DELI_INFO"
    },
    "mapSysUniResCode" : "DELETE_DELI_INFO",
    "name" : "SRFUR__DELETE_DELI_INFO",
    "mapSysUniRes" : true
  }, {
    "logicName" : "初始化数据",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "INIT_CLOCK_IN_DATA"
    },
    "mapSysUniResCode" : "INIT_CLOCK_IN_DATA",
    "name" : "SRFUR__INIT_CLOCK_IN_DATA",
    "mapSysUniRes" : true
  }, {
    "logicName" : "推送至得力",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "PUSH"
    },
    "mapSysUniResCode" : "PUSH",
    "name" : "SRFUR__PUSH",
    "mapSysUniRes" : true
  }, {
    "logicName" : "同步数据",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "SYNC_CLOCK_IN_DATA"
    },
    "mapSysUniResCode" : "SYNC_CLOCK_IN_DATA",
    "name" : "SRFUR__SYNC_CLOCK_IN_DATA",
    "mapSysUniRes" : true
  }, {
    "logicName" : "同步得力信息",
    "getMapPSSysUniRes" : {
      "modelref" : true,
      "id" : "SYNC_DELI_INFO"
    },
    "mapSysUniResCode" : "SYNC_DELI_INFO",
    "name" : "SRFUR__SYNC_DELI_INFO",
    "mapSysUniRes" : true
  }, {
    "logicName" : "更新",
    "name" : "UPDATE"
  }, {
    "logicName" : "流程启动",
    "name" : "WFSTART"
  } ],
  "getAllPSDataEntities" : [ {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_activate_rule.json",
    "name" : "ATTENDANCE_ACTIVATE_RULE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_activate_shift.json",
    "name" : "ATTENDANCE_ACTIVATE_SHIFT"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json",
    "name" : "ATTENDANCE_CHECKIN_APPLICATION"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_device.json",
    "name" : "ATTENDANCE_CHECKIN_DEVICE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json",
    "name" : "ATTENDANCE_CLOCK_IN_RECORD"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics.json",
    "name" : "ATTENDANCE_DEPARTMENT_STATISTICS"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_device.json",
    "name" : "ATTENDANCE_DEVICE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_gps_location.json",
    "name" : "ATTENDANCE_GPS_LOCATION"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_group_shift.json",
    "name" : "ATTENDANCE_GROUP_SHIFT"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_group_shift_member.json",
    "name" : "ATTENDANCE_GROUP_SHIFT_MEMBER"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type.json",
    "name" : "ATTENDANCE_LEAVE_TYPE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json",
    "name" : "ATTENDANCE_RECORD"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record_detail.json",
    "name" : "ATTENDANCE_RECORD_DETAIL"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json",
    "name" : "ATTENDANCE_RULE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json",
    "name" : "ATTENDANCE_SCHEDULE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_scope.json",
    "name" : "ATTENDANCE_SCOPE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_shift.json",
    "name" : "ATTENDANCE_SHIFT"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json",
    "name" : "ATTENDANCE_STATISTICS"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_wifi_location.json",
    "name" : "ATTENDANCE_WIFI_LOCATION"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_workday.json",
    "name" : "ATTENDANCE_WORKDAY"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json",
    "name" : "DEPARTMENT"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json",
    "name" : "EMPLOYEE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSDATAENTITIES/hr_attendance.json",
    "name" : "HR_ATTENDANCE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSDATAENTITIES/hr_attendance_overtime.json",
    "name" : "HR_ATTENDANCE_OVERTIME"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSDATAENTITIES/hr_department.json",
    "name" : "HR_DEPARTMENT"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSDATAENTITIES/hr_employee.json",
    "name" : "HR_EMPLOYEE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/hr/PSDATAENTITIES/hr_leave.json",
    "name" : "HR_LEAVE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/mail/PSDATAENTITIES/mail_thread.json",
    "name" : "MAIL_THREAD"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSDATAENTITIES/public_leave_type.json",
    "name" : "PUBLIC_LEAVE_TYPE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/base/PSDATAENTITIES/res_company.json",
    "name" : "RES_COMPANY"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/base/PSDATAENTITIES/res_config_settings.json",
    "name" : "RES_CONFIG_SETTINGS"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSDATAENTITIES/resource_calendar.json",
    "name" : "RESOURCE_CALENDAR"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSDATAENTITIES/resource_calendar_attendance.json",
    "name" : "RESOURCE_CALENDAR_ATTENDANCE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSDATAENTITIES/resource_calendar_leaves.json",
    "name" : "RESOURCE_CALENDAR_LEAVES"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/resource/PSDATAENTITIES/resource_resource.json",
    "name" : "RESOURCE_RESOURCE"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json",
    "name" : "USER_OBJECT"
  } ],
  "getAllPSSysBackServices" : [ {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSSYSBACKSERVICES/attendance_calculation.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSSYSBACKSERVICES/Monthly.json"
  }, {
    "modelref" : true,
    "path" : "PSMODULES/attendance/PSSYSBACKSERVICES/Daily.json"
  }, {
    "modelref" : true,
    "path" : "PSSYSBACKSERVICES/DENotifyDeamon.json"
  }, {
    "modelref" : true,
    "path" : "PSSYSBACKSERVICES/SysDataSyncAgentDeamon.json"
  }, {
    "modelref" : true,
    "path" : "PSSYSBACKSERVICES/WFCallbackDeamon.json"
  }, {
    "modelref" : true,
    "path" : "PSSYSBACKSERVICES/SysAdminDeamon.json"
  } ],
  "getAllPSSysContentCats" : [ {
    "modelref" : true,
    "path" : "PSSYSCONTENTCATS/LIQUIBASE_CHANGELOGS__DEFAULT.json"
  } ],
  "getAllPSSysCounters" : [ {
    "codeName" : "WFExpBar",
    "counterType" : "CUSTOM",
    "dynaModelFilePath" : "PSSYSCOUNTERS/WFExpBar.json",
    "name" : "流程导航栏计数器",
    "getPSCounterId" : "WFEXPBAR",
    "timer" : 60000,
    "uniqueTag" : "WFExpBar"
  }, {
    "codeName" : "Portal",
    "counterType" : "CUSTOM",
    "dynaModelFilePath" : "PSSYSCOUNTERS/Portal.json",
    "name" : "门户界面计数器",
    "getPSCounterId" : "PORTAL",
    "timer" : 60000,
    "uniqueTag" : "Portal"
  } ],
  "getAllPSSysDBSchemes" : [ {
    "modelref" : true,
    "path" : "PSSYSDBSCHEMES/DEFAULT.json"
  } ],
  "getAllPSSysDBValueFuncs" : [ {
    "modelref" : true,
    "path" : "PSSYSDBVFS/DATEDIFFNOW2.json"
  }, {
    "modelref" : true,
    "path" : "PSSYSDBVFS/DATEDIFFNOW.json"
  }, {
    "modelref" : true,
    "path" : "PSSYSDBVFS/STRLEN.json"
  } ],
  "getAllPSSysERMaps" : [ {
    "modelref" : true,
    "path" : "PSSYSERMAPS/rule.json"
  } ],
  "getAllPSSysEditorStyles" : [ {
    "codeName" : "A3db8f2f369ff51395a",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/A3db8f2f369ff51395a.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBDATE",
    "editorWidth" : -1.0,
    "name" : "精确到小时",
    "styleCode" : "A3db8f2f369ff51395a",
    "replaceDefault" : false
  }, {
    "codeName" : "A8e25807ee9795aff94",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/A8e25807ee9795aff94.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBTEXT",
    "editorWidth" : -1.0,
    "name" : "电话号码",
    "styleCode" : "A8e25807ee9795aff94",
    "replaceDefault" : false
  }, {
    "codeName" : "STATUS_BAR",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/STATUS_BAR.json",
    "editorHeight" : -1.0,
    "editorType" : "DROPDOWNLIST",
    "editorWidth" : -1.0,
    "name" : "状态栏",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "ODOO_STATUS_BAR",
      "runtimeObject" : true
    },
    "styleCode" : "STATUS_BAR",
    "replaceDefault" : false
  }, {
    "codeName" : "Ad92efdf150be73b553",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/Ad92efdf150be73b553.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBTEXT",
    "editorWidth" : -1.0,
    "name" : "数字",
    "styleCode" : "Ad92efdf150be73b553",
    "replaceDefault" : false
  }, {
    "codeName" : "PERSONEL_SELECT_EMP",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/PERSONEL_SELECT_EMP.json",
    "editorHeight" : -1.0,
    "editorType" : "PICKEREX_TRIGGER",
    "editorWidth" : -1.0,
    "name" : "人员选择器（员工）",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "PERSON_SELECT",
      "runtimeObject" : true
    },
    "styleCode" : "PERSONEL_SELECT_EMP",
    "replaceDefault" : false
  }, {
    "codeName" : "TIME_PICKER",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/TIME_PICKER.json",
    "editorHeight" : -1.0,
    "editorType" : "DATEPICKEREX_NODAY_NOSECOND",
    "editorWidth" : -1.0,
    "name" : "时间选择（可指定禁用小时和分钟）",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "TIME_PICKER",
      "runtimeObject" : true
    },
    "styleCode" : "TIME_PICKER",
    "replaceDefault" : false
  }, {
    "codeName" : "A3b311448b3c77b1116",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/A3b311448b3c77b1116.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBTEXT",
    "editorWidth" : -1.0,
    "name" : "网址",
    "styleCode" : "A3b311448b3c77b1116",
    "replaceDefault" : false
  }, {
    "codeName" : "HOLIDAY_CALENDAR",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/HOLIDAY_CALENDAR.json",
    "editorHeight" : -1.0,
    "editorType" : "PICKER",
    "editorWidth" : -1.0,
    "name" : "节假日日历",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "HOLIDAY_CALENDAR",
      "runtimeObject" : true
    },
    "styleCode" : "HOLIDAY_CALENDAR",
    "replaceDefault" : false
  }, {
    "codeName" : "ODOO_PERSONNEL_INFO",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/ODOO_PERSONNEL_INFO.json",
    "editorHeight" : -1.0,
    "editorType" : "SPAN",
    "editorWidth" : -1.0,
    "name" : "odoo人员信息",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "ODOO_PERSONNEL_INFO",
      "runtimeObject" : true
    },
    "styleCode" : "ODOO_PERSONNEL_INFO",
    "replaceDefault" : false
  }, {
    "codeName" : "DATE_RANGE_EX",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/DATE_RANGE_EX.json",
    "editorHeight" : -1.0,
    "editorType" : "DATERANGE_NOTIME",
    "editorWidth" : -1.0,
    "name" : "时间范围增强",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "DATE_RANGE_EX",
      "runtimeObject" : true
    },
    "styleCode" : "DATE_RANGE_EX",
    "replaceDefault" : false
  }, {
    "codeName" : "ATTENDANCE_GROUP_SHIFTS",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/ATTENDANCE_GROUP_SHIFTS.json",
    "editorHeight" : -1.0,
    "editorType" : "TEXTBOX",
    "editorWidth" : -1.0,
    "name" : "组排班表格",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "ATTENDANCE_GROUP_SHIFTS",
      "runtimeObject" : true
    },
    "styleCode" : "ATTENDANCE_GROUP_SHIFTS",
    "replaceDefault" : false
  }, {
    "codeName" : "PERSON_SELECT",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/PERSON_SELECT.json",
    "editorHeight" : -1.0,
    "editorType" : "ADDRESSPICKUP",
    "editorWidth" : -1.0,
    "name" : "部门人员选择",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "PERSON_SELECT",
      "runtimeObject" : true
    },
    "styleCode" : "PERSON_SELECT",
    "replaceDefault" : false
  }, {
    "codeName" : "Afe299e4725e315af5c",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/Afe299e4725e315af5c.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBDATE",
    "editorWidth" : -1.0,
    "name" : "只有小时分钟",
    "styleCode" : "Afe299e4725e315af5c",
    "replaceDefault" : false
  }, {
    "codeName" : "Af77981cb7cacfab434",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/Af77981cb7cacfab434.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBTEXT",
    "editorWidth" : -1.0,
    "name" : "密码框",
    "styleCode" : "Af77981cb7cacfab434",
    "replaceDefault" : false
  }, {
    "codeName" : "Auto84309142",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/Auto84309142.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBTEXT",
    "editorWidth" : -1.0,
    "name" : "电话号码",
    "styleCode" : "Auto84309142",
    "replaceDefault" : false
  }, {
    "codeName" : "CUSTOM_FORM_CALENDAR",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/CUSTOM_FORM_CALENDAR.json",
    "editorHeight" : -1.0,
    "editorType" : "SPAN",
    "editorWidth" : -1.0,
    "name" : "表单日历",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "CUSTOM_FORM_CALENDAR",
      "runtimeObject" : true
    },
    "styleCode" : "CUSTOM_FORM_CALENDAR",
    "replaceDefault" : false
  }, {
    "codeName" : "A077fcdf942a132fedd",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/A077fcdf942a132fedd.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBTEXT",
    "editorWidth" : -1.0,
    "name" : "邮箱",
    "styleCode" : "A077fcdf942a132fedd",
    "replaceDefault" : false
  }, {
    "codeName" : "Aa708288b814c6529c0",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/Aa708288b814c6529c0.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBDATE",
    "editorWidth" : -1.0,
    "name" : "精确到分钟",
    "styleCode" : "Aa708288b814c6529c0",
    "replaceDefault" : false
  }, {
    "codeName" : "Aaa73b9bd3be66e7778",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/Aaa73b9bd3be66e7778.json",
    "editorHeight" : -1.0,
    "editorType" : "MOBDATE",
    "editorWidth" : -1.0,
    "name" : "精确到天",
    "styleCode" : "Aaa73b9bd3be66e7778",
    "replaceDefault" : false
  }, {
    "codeName" : "TEAM_SELECT",
    "dynaModelFilePath" : "PSSYSEDITORSTYLES/TEAM_SELECT.json",
    "editorHeight" : -1.0,
    "editorType" : "PICKER",
    "editorWidth" : -1.0,
    "memo" : "TEAMURL=/groups/fetch_default\nTEAMMETHOD=post\nTEAMMEMBERURL=/groups/${params.teamid}/members/fetch_default\nTEAMMEMBERMETHOD=post\nTEAMTYPEFIELD=reviewer_type",
    "name" : "人员团队选择",
    "getPSSysPFPlugin" : {
      "pluginType" : "EDITOR_CUSTOMSTYLE",
      "pluginCode" : "TEAM_SELECT",
      "runtimeObject" : true
    },
    "styleCode" : "TEAM_SELECT",
    "replaceDefault" : false
  } ],
  "getAllPSSysI18Ns" : [ {
    "modelref" : true,
    "path" : "PSSYSI18NS/DEFAULT.json"
  } ],
  "getAllPSSysPDTViews" : [ {
    "caption" : "流程跟踪列表视图",
    "codeName" : "PDTView6",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView6.json",
    "name" : "流程跟踪列表视图"
  }, {
    "caption" : "流程后加签操作视图",
    "codeName" : "PDTView2",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView2.json",
    "name" : "流程后加签操作视图"
  }, {
    "caption" : "流程回退操作视图",
    "codeName" : "PDTView4",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView4.json",
    "name" : "流程回退操作视图"
  }, {
    "caption" : "流程征求意见操作视图",
    "codeName" : "PDTView9",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView9.json",
    "name" : "流程征求意见操作视图"
  }, {
    "caption" : "流程前加签操作视图",
    "codeName" : "PDTView3",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView3.json",
    "name" : "流程前加签操作视图"
  }, {
    "caption" : "常规数据附件列表",
    "codeName" : "PDTView",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView.json",
    "name" : "常规数据附件列表"
  }, {
    "caption" : "流程补充信息操作视图",
    "codeName" : "PDTView8",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView8.json",
    "name" : "流程补充信息操作视图"
  }, {
    "caption" : "流程跟踪图形视图",
    "codeName" : "PDTView7",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView7.json",
    "name" : "流程跟踪图形视图"
  }, {
    "caption" : "流程催办列表视图",
    "codeName" : "PDTView5",
    "dynaModelFilePath" : "PSSYSPDTVIEWS/PDTView5.json",
    "name" : "流程催办列表视图"
  } ],
  "getAllPSSysSFPlugins" : [ {
    "codeName" : "AbnormalAttendance",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/AbnormalAttendance.json",
    "memo" : "异常考勤自定义导出",
    "name" : "AbnormalAttendancePOIDEDataExportRuntimeEx",
    "pluginCode" : "AbnormalAttendance",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport.AbnormalAttendancePOIDEDataExportRuntimeEx",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport\r\n\r\nimport groovy.transform.CompileStatic\r\nimport net.ibizsys.central.plugin.poi.dataentity.dataexport.POIDEDataExportRuntime\r\n\r\nimport net.ibizsys.central.util.IEntityDTO;\r\nimport net.ibizsys.model.dataentity.dataexport.IPSDEDataExportItem\r\nimport net.ibizsys.runtime.security.UserContext\r\nimport org.apache.poi.ss.usermodel.Cell;\r\nimport org.apache.poi.ss.usermodel.Row;\r\nimport org.apache.poi.ss.usermodel.Sheet;\r\nimport org.apache.poi.ss.usermodel.Workbook;\r\nimport org.apache.poi.ss.util.CellRangeAddress;\r\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.util.MultiValueMap;\r\nimport org.springframework.util.ObjectUtils\r\n\r\nimport java.text.SimpleDateFormat;\r\n\r\n@CompileStatic\r\nclass AbnormalAttendancePOIDEDataExportRuntimeEx extends POIDEDataExportRuntime {\r\n\r\n\r\n    @Override\r\n    protected void onExportStream(Object objData, OutputStream outputStram) throws Throwable {\r\n        Workbook workbook = new XSSFWorkbook();\r\n        Throwable var4 = null;\r\n\r\n        try {\r\n            List<IPSDEDataExportItem> exportItems = this.getPSDEDataExport().getPSDEDataExportItems();\r\n\r\n            if (ObjectUtils.isEmpty(exportItems)) {\r\n                throw new Exception(\"未指定导出列\");\r\n            }\r\n            MultiValueMap<String, String> parameters = UserContext.getCurrent().getWebContext().getParameters();\r\n\r\n            // 基础信息\r\n            List<String> baseInfoList = convertStringToList(parameters.get(\"base_info\")?.toString())\r\n            // 打卡信息\r\n            List<String> indexNumList = convertStringToList(parameters.get(\"index_num\")?.toString())\r\n            List<String> resultList = new ArrayList<>()\r\n            // 遍历 indexNumList\r\n            for (String item : indexNumList) {\r\n                resultList.add(\"start_\" + item);\r\n                resultList.add(\"end_\" + item);\r\n            }\r\n            List<String> checkInInfoList = convertStringToList(parameters.get(\"check_in_info\")?.toString())\r\n            resultList.addAll(checkInInfoList)\r\n            // 时长统计\r\n            List<String> durationStatisticsList = convertStringToList(parameters.get(\"duration_statistics\")?.toString())\r\n\r\n            Sheet sheet = workbook.createSheet()\r\n\r\n            // 创建动态表头\r\n            createHeaders(sheet, baseInfoList, resultList, durationStatisticsList, exportItems);\r\n\r\n            // 获取动态属性列\r\n            Row headerRow = sheet.getRow(2);\r\n            List<String> propertyNames = getPropertyNames(headerRow);\r\n\r\n            // 创建Excel表格数据\r\n            List<IEntityDTO> data = ((Page) objData).getContent();\r\n\r\n            // 平铺打卡数据\r\n            SimpleDateFormat sdf = new SimpleDateFormat(\"HH:mm:ss\");\r\n            for (Object item : data) {\r\n                IEntityDTO it = item as IEntityDTO;\r\n                if (!ObjectUtils.isEmpty(it.get(\"details\"))) {\r\n                    List<IEntityDTO> details = it.get(\"details\") as List<IEntityDTO>;\r\n                    for (IEntityDTO item2 : details) {\r\n                        if (!ObjectUtils.isEmpty(item2.get(\"checkin_time\"))) {\r\n                            it.set(item2.get(\"detail_index\"), sdf.format(item2.get(\"checkin_time\")));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            int startRowIndex = 3; // 数据从第4行开始（0-based索引）\r\n            fillDataRows(sheet, data, propertyNames, startRowIndex);\r\n\r\n            // 删除标识行\r\n            deleteRowSimple(sheet, 2)\r\n\r\n            workbook.write(outputStram);\r\n        } catch (Throwable var25) {\r\n            var4 = var25;\r\n            throw var25;\r\n        } finally {\r\n            if (workbook != null) {\r\n                if (var4 != null) {\r\n                    try {\r\n                        workbook.close();\r\n                    } catch (Throwable var24) {\r\n                        var4.addSuppressed(var24);\r\n                    }\r\n                } else {\r\n                    workbook.close();\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // 字符串转List方法\r\n    private static List<String> convertStringToList(String input) {\r\n        if (input == \"[]\" || input == \"[null]\" || input == \"\" || input == null || input.trim().isEmpty()) {\r\n            return new ArrayList<>();\r\n        }\r\n\r\n        // 去除方括号并按逗号分割\r\n        String cleaned = input.substring(1, input.length() - 1).trim();\r\n        String[] parts = cleaned.split(\",\");\r\n\r\n        List<String> result = new ArrayList<>();\r\n        for (String part : parts) {\r\n            if (!\"name\".equals(part.trim())) {\r\n                result.add(part.trim());\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // 创建复杂的列头结构\r\n    private static void createHeaders(Sheet sheet, List<String> baseInfoList,\r\n                                                  List<String> resultList,\r\n                                                  List<String> durationStatisticsList,\r\n                                                  List<IPSDEDataExportItem> exportItems) {\r\n        // 创建两行表头\r\n        Row row0 = sheet.createRow(0);\r\n        Row row1 = sheet.createRow(1);\r\n        Row row2 = sheet.createRow(2);\r\n        int colIndex = 0;\r\n        // 基本信息分组\r\n        if (baseInfoList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"基本信息\", baseInfoList, exportItems);\r\n        }\r\n        // 打卡信息分组\r\n        if (resultList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"打卡信息\", resultList, exportItems);\r\n        }\r\n        // 时长统计分组\r\n        if (durationStatisticsList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"时长统计\", durationStatisticsList, exportItems);\r\n        }\r\n    }\r\n\r\n    // 安全合并单元格（防止无效合并区域）\r\n    private static void addSafeMergedRegion(Sheet sheet, int firstRow, int lastRow,\r\n                                            int firstCol, int lastCol) {\r\n        // 确保是有效的合并区域（至少包含两个单元格）\r\n        int rowSpan = lastRow - firstRow + 1;\r\n        int colSpan = lastCol - firstCol + 1;\r\n\r\n        if (rowSpan >= 2 || colSpan >= 2) {\r\n            sheet.addMergedRegion(new CellRangeAddress(firstRow, lastRow, firstCol, lastCol));\r\n        }\r\n    }\r\n\r\n    // 创建分组列头（修复单列问题）\r\n    private static int createGroupHeader(Sheet sheet, Row row0, Row row1, Row row2,\r\n                                         int startCol, String groupName,\r\n                                         List<String> headers, List<IPSDEDataExportItem> exportItems) {\r\n        if (headers.isEmpty()) {\r\n            return startCol;\r\n        }\r\n\r\n        int endCol = startCol + headers.size() - 1;\r\n\r\n        // 创建分组标题单元格（存在分组列就创建）\r\n        Cell groupCell = row0.createCell(startCol);\r\n        groupCell.setCellValue(groupName);\r\n\r\n        // 处理多列情况\r\n        if (headers.size() > 1) {\r\n            // 横向合并分组标题\r\n            sheet.addMergedRegion(new CellRangeAddress(0, 0, startCol, endCol));\r\n\r\n            // 创建分组内的列头\r\n            for (int i = 0; i < headers.size(); i++) {\r\n                Cell headerCell = row1.createCell(startCol + i);\r\n                Cell headerCell2 = row2.createCell(startCol + i);\r\n                String header = headers.get(i);\r\n                String headerName = getHeaderName(header, exportItems)\r\n                headerCell.setCellValue(headerName);\r\n                headerCell2.setCellValue(header)\r\n            }\r\n        }\r\n        // 处理单列情况\r\n        else if (headers.size() == 1) {\r\n            // 1. 分组标题显示在第一行（不合并）\r\n            // 2. 列头显示在第二行\r\n            // 创建列头单元格\r\n            Cell headerCell = row1.createCell(startCol);\r\n            String header = headers.get(0);\r\n            String headerName = getHeaderName(header, exportItems)\r\n            headerCell.setCellValue(headerName);\r\n            Cell headerCell2 = row2.createCell(startCol);\r\n            headerCell2.setCellValue(header)\r\n        }\r\n\r\n        return endCol + 1;\r\n    }\r\n\r\n    private static String getHeaderName(String header, List<IPSDEDataExportItem> exportItems) {\r\n        String headerName = \"\"\r\n        for (IPSDEDataExportItem item : exportItems) {\r\n            if (item.getName().equals(header)) {\r\n                headerName = item.getCaption()\r\n            }\r\n        }\r\n        return headerName\r\n    }\r\n\r\n    // 填充数据行\r\n    private static void fillDataRows(Sheet sheet, List<IEntityDTO> data, List<String> propertyNames, int startRowIndex) {\r\n        if (data == null || data.isEmpty()) return;\r\n        for (int i = 0; i < data.size(); i++) {\r\n            IEntityDTO entity = data.get(i);\r\n            // 创建每行数据\r\n            Row dataRow = sheet.createRow(startRowIndex + i);\r\n            // 填充每个单元格\r\n            for (int col = 0; col < propertyNames.size(); col++) {\r\n                String propertyName = propertyNames.get(col);\r\n                String propertyValue = entity.get(propertyName);\r\n                Cell cell = dataRow.createCell(col);\r\n                // 设置单元格值\r\n                cell.setCellValue(propertyValue);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 获取第三行的属性名列表\r\n    private static List<String> getPropertyNames(Row headerRow) {\r\n        List<String> propertyNames = new ArrayList<>();\r\n        int lastCellNum = headerRow.getLastCellNum();\r\n\r\n        for (int i = 0; i < lastCellNum; i++) {\r\n            Cell cell = headerRow.getCell(i);\r\n            if (cell != null) {\r\n                propertyNames.add(cell.getStringCellValue());\r\n            } else {\r\n                propertyNames.add(\"\"); // 空值处理\r\n            }\r\n        }\r\n        return propertyNames;\r\n    }\r\n\r\n    private static void deleteRowSimple(Sheet sheet, int rowIndex) {\r\n        int lastRowNum = sheet.getLastRowNum();\r\n        // 验证行索引\r\n        if (rowIndex < 0 || rowIndex > lastRowNum) {\r\n            throw new IllegalArgumentException(\"行索引超出范围: \" + rowIndex);\r\n        }\r\n        // 如果是最后一行，直接删除\r\n        if (rowIndex == lastRowNum) {\r\n            Row row = sheet.getRow(rowIndex);\r\n            if (row != null) {\r\n                sheet.removeRow(row);\r\n            }\r\n        }\r\n        // 如果是中间行，向上移动后续行\r\n        else {\r\n            sheet.shiftRows(rowIndex + 1, lastRowNum, -1);\r\n        }\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "AttendanceCalculate",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/AttendanceCalculate.json",
    "name" : "考勤计算",
    "pluginCode" : "AttendanceCalculate",
    "pluginType" : "DEACTION",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.AttendanceCalculateDEActionRuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\nimport net.ibizsys.central.cloud.core.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.database.ISysDBSchemeRuntime\r\nimport net.ibizsys.central.dataentity.action.DEActionRuntimeBase\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.central.util.ISearchContextDTO\r\nimport org.springframework.util.ObjectUtils\r\n\r\nimport java.sql.Timestamp\r\nimport java.text.SimpleDateFormat\r\nimport java.time.LocalDate;\r\nimport java.time.LocalDateTime;\r\nimport java.time.format.DateTimeFormatter;\r\nimport java.time.LocalTime;\r\nimport java.time.Duration;\r\nimport net.ibizsys.runtime.util.Entity\r\nimport net.ibizsys.runtime.util.KeyValueUtils\r\n\r\nclass AttendanceCalculateDEActionRuntime extends DEActionRuntimeBase{\r\n\r\n    // 定义日期格式\r\n    private static final DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");\r\n    private static final DateTimeFormatter time_formatter = DateTimeFormatter.ofPattern(\"HH:mm:ss\");\r\n    private static final DateTimeFormatter originalFormat = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss.S\");\r\n    private static final DateTimeFormatter originalFormat2 = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\");\r\n\r\n\r\n    @Override\r\n    protected Object onExecute(IEntityDTO iEntityDTO) throws Throwable {\r\n        // 初始化运行时对象\r\n        ISysDBSchemeRuntime dbSchema = this.getDataEntityRuntime().getSysDBSchemeRuntimeMust()\r\n\r\n        // 获取相关实体运行时\r\n        IDataEntityRuntime attendance_scheduleRuntime = systemRuntime.getDataEntityRuntime(\"attendance_schedule\");\r\n        ISearchContextDTO attendance_scheduleSearchContext = attendance_scheduleRuntime.createSearchContext().all();\r\n        IDataEntityRuntime attendanceRecordRuntime = systemRuntime.getDataEntityRuntime(\"attendance_record\");\r\n        IDataEntityRuntime recordDetailRuntime = systemRuntime.getDataEntityRuntime(\"attendance_record_detail\");\r\n        IDataEntityRuntime employeeRuntime = systemRuntime.getDataEntityRuntime(\"hr_employee\");\r\n\r\n\r\n        // 清理历史数据\r\n        attendance_scheduleSearchContext = cleanAttendanceData(attendance_scheduleSearchContext, iEntityDTO, dbSchema);\r\n\r\n        // 查询排班记录\r\n        List<IEntityDTO> attendance_schedules = attendance_scheduleRuntime.selectDataQuery(\"all\", attendance_scheduleSearchContext);\r\n\r\n        // 处理排班记录\r\n        def (List<IEntityDTO> recordList, List<IEntityDTO> detailList) = processSchedules(attendanceRecordRuntime, recordDetailRuntime, employeeRuntime, dbSchema, attendance_schedules);\r\n\r\n        //批量保存数据\r\n        batchSaveData(attendanceRecordRuntime, recordList, recordDetailRuntime, detailList);\r\n\r\n    }\r\n\r\n    /**\r\n     * 清理指定时间范围内的考勤数据\r\n     */\r\n    private ISearchContextDTO cleanAttendanceData(ISearchContextDTO attendance_scheduleSearchContext, IEntityDTO iEntityDTO, ISysDBSchemeRuntime dbSchema) {\r\n        def del_detail_sql = \"\";\r\n        def del_record_sql = \"\";\r\n        def del_param = [];\r\n\r\n        // 判断是否未手动执行重新计算\r\n        def n_date_gtandeq = \"\";\r\n        def n_date_ltandeq = \"\";\r\n        // 获取昨天的日期\r\n        LocalDate yesterday = LocalDate.now();\r\n        // 格式化昨天的日期为字符串\r\n        String yesterdayStr = yesterday.format(formatter);\r\n        if (!ObjectUtils.isEmpty(iEntityDTO)) {\r\n            n_date_gtandeq = iEntityDTO.get(\"name\");\r\n            n_date_ltandeq = iEntityDTO.get(\"cmd\");\r\n        }\r\n\r\n        if (!ObjectUtils.isEmpty(n_date_gtandeq) && !ObjectUtils.isEmpty(n_date_ltandeq)){\r\n            del_detail_sql = \"delete from attendance_record_detail where record_id in (select t2.id from attendance_record t2 where t2.checkin_date >= ? and t2.checkin_date <= ?)\";\r\n            del_record_sql = \"delete from attendance_record where checkin_date >= ? and checkin_date <= ?\";\r\n            del_param.add(n_date_gtandeq);\r\n            del_param.add(n_date_ltandeq);\r\n            attendance_scheduleSearchContext.gte(\"checkin_date\", n_date_gtandeq);\r\n            attendance_scheduleSearchContext.lte(\"checkin_date\", n_date_ltandeq);\r\n        } else {\r\n            del_detail_sql = \"delete from attendance_record_detail where record_id in (select t2.id from attendance_record t2 where t2.checkin_date = ?)\";\r\n            del_record_sql = \"delete from attendance_record where checkin_date = ?\";\r\n            del_param.add(yesterdayStr);\r\n            attendance_scheduleSearchContext.eq(\"checkin_date\", yesterdayStr);\r\n        }\r\n        dbSchema.executeSQL(del_detail_sql, del_param);\r\n        dbSchema.executeSQL(del_record_sql, del_param);\r\n        return attendance_scheduleSearchContext;\r\n    }\r\n\r\n    /**\r\n     * 处理所有排班记录生成考勤数据\r\n     */\r\n    private List[] processSchedules(attendanceRecordRuntime, recordDetailRuntime, employeeRuntime, dbSchema, List<IEntityDTO> attendance_schedules) {\r\n        if (!ObjectUtils.isEmpty(attendance_schedules)){\r\n            List<IEntityDTO> record_list = attendanceRecordRuntime.createEntityList();\r\n            List<IEntityDTO> all_details_list = recordDetailRuntime.createEntityList();\r\n            SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n\r\n            for (IEntityDTO attendance_schedule : attendance_schedules) {\r\n                String member_id = attendance_schedule.get(\"member_id\");\r\n                //是否工作日\r\n                Integer workday = attendance_schedule.getInteger(\"workday\", 0);\r\n                if (workday == 1) {\r\n                    List<Map<String, Object>> applications = null;\r\n                    if (!ObjectUtils.isEmpty(member_id) && !ObjectUtils.isEmpty(attendance_schedule.get(\"checkin_date\"))){\r\n                        def checkinApplicationSql = \"select hlt.name as LEAVE_TYPE, h.DATE_FROM , h.DATE_TO  from hr_leave h left join  hr_leave_type hlt on h.HOLIDAY_STATUS_ID  = hlt.id  where h.STATE = 'validate' and DATE(h.DATE_FROM) <= ? and DATE(h.DATE_TO) >= ? and h.EMPLOYEE_ID = ?\";\r\n                        def _param = []\r\n                        _param.add(dateFormat.format(attendance_schedule.get(\"checkin_date\")));\r\n                        _param.add(dateFormat.format(attendance_schedule.get(\"checkin_date\")));\r\n                        _param.add(member_id);\r\n                        applications = dbSchema.executeSelectSQL(checkinApplicationSql, _param) as List<Map<String, Object>>;\r\n\r\n                        // 创建基础考勤记录\r\n                        IEntityDTO employee = employeeRuntime.get(member_id);\r\n                        IEntityDTO record = createAttendanceRecord(attendance_schedule, employee, attendanceRecordRuntime);\r\n\r\n                        // 应出勤天数\r\n                        double attendance_ratio = 1;\r\n                        // 应出勤总工时(分钟数)\r\n                        int work_load = 0;\r\n                        if (!ObjectUtils.isEmpty(attendance_schedule.get(\"shift_data\"))) {\r\n                            Map<String, Object> shift_data = attendance_schedule.get(\"shift_data\") as Map<String, Object>;\r\n                            if (!ObjectUtils.isEmpty(shift_data.get(\"attendance_ratio\"))) {\r\n                                attendance_ratio = shift_data.get(\"attendance_ratio\");\r\n                            }\r\n                            if (!ObjectUtils.isEmpty(shift_data.get(\"work_load\"))) {\r\n                                work_load = Integer.parseInt(shift_data.get(\"work_load\"));\r\n                            }\r\n                        }\r\n                        record.set(\"should_attendance_days\", attendance_ratio);\r\n                        //迟到时长 (分钟)\r\n                        int late_minutes = 0;\r\n                        // 早退时长 (分钟)\r\n                        int leave_early_minutes = 0;\r\n                        //班次信息\r\n                        String shift_message = \"\";\r\n                        if (!ObjectUtils.isEmpty(attendance_schedule.get(\"work_time\"))){\r\n                            List<IEntityDTO> details_list = recordDetailRuntime.createEntityList();\r\n                            List<Entity> work_time_list = attendance_schedule.get(\"work_time\") as List<Entity>;\r\n                            // 给班次排序\r\n                            work_time_list.sort { it.get(\"order_value\") }\r\n                            // 给跨天班次打标记并返回打卡记录\r\n                            List<Map<String, Object>> clock_list = setNextDayFlag(work_time_list, member_id, dateFormat.format(attendance_schedule.get(\"checkin_date\")), dbSchema);\r\n                            Entity ruleData = attendance_schedule.get(\"rule_data\");\r\n                            Entity shiftData = attendance_schedule.get(\"shift_data\");\r\n                            int work_item_index = 1;\r\n                            for (Entity work_time : work_time_list){\r\n                                String start = String.valueOf(work_time.get(\"start_base_time\"));\r\n                                String end = String.valueOf(work_time.get(\"end_base_time\"));\r\n                                shift_message += work_time.get(\"shift_name\") + \":\" + start + \"-\" + end;\r\n                                if (!ObjectUtils.isEmpty(start) && !ObjectUtils.isEmpty(end)) {\r\n                                    // 解析字符串为 LocalTime（仅提取时分）\r\n                                    LocalTime start_time = LocalTime.parse(start, time_formatter).withSecond(0).withNano(0);\r\n                                    LocalTime end_time = LocalTime.parse(end, time_formatter).withSecond(0).withNano(0);\r\n                                    // 解析班次\r\n                                    Map<String, LocalDateTime> workTimeMap = parseWorkTime(attendance_schedule, work_time);\r\n                                    // 处理打卡记录\r\n                                    Map<String, List<LocalDateTime>> checkTimesMap = processClockRecord(workTimeMap, clock_list, attendance_schedule.get(\"schedule_type\"));\r\n                                    // 上班details\r\n                                    IEntityDTO start_detail = processCheckinDetail(ruleData, recordDetailRuntime, work_time, applications, record.get(\"id\"), checkTimesMap, work_item_index,0);\r\n                                    details_list.add(start_detail);\r\n                                    all_details_list.add(start_detail);\r\n                                    IEntityDTO end_detail = recordDetailRuntime.createEntity();\r\n                                    if (checkTimesMap) {\r\n                                        // 下班details\r\n                                        end_detail = processCheckinDetail(ruleData, recordDetailRuntime, work_time, applications, record.get(\"id\") , checkTimesMap, work_item_index, 1);\r\n                                        details_list.add(end_detail);\r\n                                        all_details_list.add(end_detail);\r\n                                    }\r\n                                    // 实际出勤时长\r\n                                    calculateActualAttendance(attendance_schedule, record, work_time, start_detail, end_detail, attendance_ratio, work_load);\r\n                                    // 是否迟到\r\n                                    if (Objects.equals(\"LATE\", start_detail.get(\"checkin_result\"))){\r\n                                        LocalTime start_checkin_time = LocalTime.parse(String.valueOf(start_detail.get(\"checkin_time\")), originalFormat);\r\n                                        late_minutes += calculateMins(start_time, start_checkin_time);\r\n                                    }\r\n                                    // 是否早退\r\n                                    if (Objects.equals(\"LEAVE_EARLY\", end_detail.get(\"checkin_result\"))){\r\n                                        LocalTime end_checkin_time = LocalTime.parse(String.valueOf(end_detail.get(\"checkin_time\")), originalFormat);\r\n                                        leave_early_minutes += calculateMins(end_checkin_time, end_time);\r\n                                    }\r\n                                    if (work_time_list.indexOf(work_time) == work_time_list.size() - 1) {\r\n                                        // 最后一个班次，计算加班\r\n                                        calculateOvertime(record, shiftData, workTimeMap, checkTimesMap);\r\n                                    }\r\n                                    // 计算应出勤时长\r\n                                    double should_attendance_hours = calculateShouldAttendance(record, attendance_schedule, work_time);\r\n                                    // 处理申请数据\r\n                                    processCheckinApplications(applications, attendance_schedule, record, start, should_attendance_hours);\r\n                                }\r\n                                work_item_index++\r\n                            }\r\n                            record.set(\"late_minutes\", late_minutes)\r\n                            record.set(\"leave_early_minutes\", leave_early_minutes)\r\n                            record.set(\"shift_message\", shift_message)\r\n                            if (details_list.size() > 0){\r\n                                boolean normal_status = true;\r\n                                boolean late_status = false;\r\n                                boolean leave_early_status = false;\r\n                                boolean missing_status = false;\r\n                                boolean absent_status = false;\r\n                                int late_times = 0;\r\n                                int leave_early_times = 0;\r\n                                int checkin_missing_times = 0;\r\n                                for (IEntityDTO details : details_list) {\r\n                                    String checkin_result = details.get(\"checkin_result\")\r\n                                    if (Objects.equals(checkin_result, \"LATE\")){\r\n                                        normal_status = false;\r\n                                        late_status = true;\r\n                                        late_times++;\r\n                                    } else if (Objects.equals(checkin_result, \"LEAVE_EARLY\")){\r\n                                        normal_status = false;\r\n                                        leave_early_status = true;\r\n                                        leave_early_times++;\r\n                                    } else if (checkin_result.contains(\"MISSING\")){\r\n                                        normal_status = false;\r\n                                        missing_status = true;\r\n                                        checkin_missing_times++;\r\n                                    } else if (checkin_result.contains(\"ABSENT\")){\r\n                                        //缺勤也计缺卡\r\n                                        checkin_missing_times++;\r\n                                        normal_status = false;\r\n                                        absent_status = true;\r\n                                    }\r\n                                }\r\n                                record.set(\"late_times\", late_times);\r\n                                record.set(\"leave_early_times\", leave_early_times);\r\n                                record.set(\"checkin_missing_times\", checkin_missing_times);\r\n                                if (normal_status){\r\n                                    record.set(\"checkin_result\", \"NORMAL\");\r\n                                } else {\r\n                                    if (late_status){\r\n                                        record.set(\"checkin_result\", \"LATE\");\r\n                                    }\r\n                                    if (leave_early_status){\r\n                                        record.set(\"checkin_result\", \"LEAVE_EARLY\");\r\n                                    }\r\n                                    if (late_status && leave_early_status) {\r\n                                        record.set(\"checkin_result\", \"LATE_AND_LEAVE_EARLY\");\r\n                                    }\r\n                                    if (absent_status){\r\n                                        record.set(\"checkin_result\", \"ABSENT\");\r\n                                    }\r\n                                    if (missing_status){\r\n                                        record.set(\"checkin_result\", \"MISSING\");\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (details_list.size() == 0 && ObjectUtils.isEmpty(record.get(\"checkin_result\"))){\r\n                                record.set(\"checkin_result\", \"ABSENT\");\r\n                            }\r\n                        }\r\n                        record_list.add(record)\r\n                    }\r\n                }\r\n            }\r\n            return [record_list, all_details_list];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建基础考勤记录\r\n     */\r\n    private IEntityDTO createAttendanceRecord(IEntityDTO attendance_schedule, IEntityDTO employee, attendanceRecordRuntime) {\r\n        IEntityDTO record = attendanceRecordRuntime.createEntity();\r\n        String record_id = KeyValueUtils.genUniqueId();\r\n        record.set(\"id\", record_id);\r\n        record.set(\"member_id\", attendance_schedule.get(\"member_id\"));\r\n        record.set(\"checkin_date\", attendance_schedule.get(\"checkin_date\"));\r\n        record.set(\"rule_id\", attendance_schedule.get(\"rule_id\"));\r\n        record.set(\"title\", employee.get(\"title\"));\r\n        record.set(\"member_num\", employee.get(\"employee_num\"));\r\n        record.set(\"dept_id\", employee.get(\"department_id\"));\r\n        record.set(\"dept_name\", employee.get(\"department_name\"));\r\n        record.set(\"member_name\", employee.get(\"name\"));\r\n        record.set(\"overtime_hours\", 0);\r\n        record.set(\"should_attendance_hours\", 0)\r\n        record.set(\"working_hours\", 0)\r\n        record.set(\"working_mins\", 0)\r\n        record.set(\"actual_attendance_days\", 0)\r\n        return record;\r\n    }\r\n\r\n    /**\r\n     * 计算加班\r\n     */\r\n    private void calculateOvertime(record, shiftData, Map<String, LocalDateTime> workTimeMap, Map<String, List<LocalDateTime>> checkTimesMap) {\r\n        long overtime_hours = record.get(\"overtime_hours\");\r\n        LocalDateTime end = workTimeMap.get(\"end_base_time\");\r\n        if (!ObjectUtils.isEmpty(shiftData.get(\"overtime_valid\")) && shiftData.get(\"overtime_valid\") == 1) {\r\n            long start_overtime = shiftData.get(\"start_overtime\");\r\n            long invalid_overtime = shiftData.get(\"invalid_overtime\");\r\n            LocalDateTime invalidTime = null;\r\n            LocalDateTime normalTime = null;\r\n            if (!ObjectUtils.isEmpty(checkTimesMap) && !ObjectUtils.isEmpty(checkTimesMap.get(\"invalid_check_times\")) && checkTimesMap.get(\"invalid_check_times\").size() > 0) {\r\n                invalidTime = Collections.max(checkTimesMap.get(\"invalid_check_times\"));\r\n            }\r\n            if (!ObjectUtils.isEmpty(checkTimesMap) && !ObjectUtils.isEmpty(checkTimesMap.get(\"normal_end_check_times\")) && checkTimesMap.get(\"normal_end_check_times\").size() > 0) {\r\n                normalTime = Collections.max(checkTimesMap.get(\"normal_end_check_times\"));\r\n            }\r\n            LocalDateTime latestTime = compareAndReturnMax(invalidTime, normalTime);\r\n            // 判断是否符合加班条件\r\n            if (!ObjectUtils.isEmpty(latestTime)) {\r\n                if (compareLocalDateTimes(latestTime, end.plusMinutes(start_overtime)) == 1 && calculateMinutes(end, latestTime) > invalid_overtime) {\r\n                    overtime_hours += calculateTimes(end, latestTime);\r\n                }\r\n            }\r\n        }\r\n        record.set(\"overtime_hours\", overtime_hours);\r\n    }\r\n\r\n    /**\r\n     * 计算应出勤时长\r\n     */\r\n    private double calculateShouldAttendance(record, attendance_schedule, work_time) {\r\n        double should_attendance_hours = record.get(\"should_attendance_hours\");\r\n        String checkinDate = String.valueOf(attendance_schedule.get(\"checkin_date\")).substring(0, 11);\r\n        String start = checkinDate + String.valueOf(work_time.get(\"start_base_time\"));\r\n        String end = checkinDate + String.valueOf(work_time.get(\"end_base_time\"));\r\n        LocalDateTime start_time = LocalDateTime.parse(start, originalFormat2).withSecond(0).withNano(0);\r\n        LocalDateTime end_time = LocalDateTime.parse(end, originalFormat2).withSecond(0).withNano(0);\r\n        // 次日班次\r\n        if (work_time.get(\"isNextDay\") == 1) {\r\n            start_time = start_time.plusDays(1);\r\n            end_time = end_time.plusDays(1);\r\n        } else if (work_time.get(\"isNextDay\") == 2) {\r\n            end_time = end_time.plusDays(1);\r\n        }\r\n        should_attendance_hours += calculateTimes(start_time, end_time);\r\n        record.set(\"should_attendance_hours\", should_attendance_hours);\r\n        return should_attendance_hours;\r\n    }\r\n\r\n    /**\r\n     * 计算实际出勤时长\r\n     */\r\n    private void calculateActualAttendance(IEntityDTO attendance_schedule, IEntityDTO record, workTime, IEntityDTO start_detail, IEntityDTO end_detail, attendance_ratio, work_load) {\r\n\r\n        Entity ruleData = attendance_schedule.get(\"rule_data\");\r\n        // 实际出勤小时\r\n        double working_hours = record.get(\"working_hours\");\r\n        // 实际出勤分钟\r\n        double working_mins = record.get(\"working_mins\");\r\n        // 实际出勤天数\r\n        double actual_attendance_days = record.get(\"actual_attendance_days\");\r\n\r\n        if (!ObjectUtils.isEmpty(start_detail) && !ObjectUtils.isEmpty(end_detail) && !ObjectUtils.isEmpty(start_detail.get(\"checkin_time\")) && !ObjectUtils.isEmpty(end_detail.get(\"checkin_time\"))) {\r\n            LocalDateTime start_check_time = LocalDateTime.parse(String.valueOf(start_detail.get(\"checkin_time\")), originalFormat);\r\n            LocalDateTime end_check_time = LocalDateTime.parse(String.valueOf(end_detail.get(\"checkin_time\")), originalFormat);\r\n            working_hours += calculateTimes(start_check_time, end_check_time);\r\n            working_mins += calculateMinutes(start_check_time, end_check_time);\r\n        }\r\n        if (!ObjectUtils.isEmpty(workTime.get(\"rest_enable\")) && workTime.get(\"rest_enable\") == 1) {\r\n            String checkinDate = String.valueOf(attendance_schedule.get(\"checkin_date\")).substring(0, 11);\r\n            String start = checkinDate + String.valueOf(workTime.get(\"rest_start\"));\r\n            String end = checkinDate + String.valueOf(workTime.get(\"end_start\"));\r\n            LocalDateTime restStart = LocalDateTime.parse(start, originalFormat2);\r\n            LocalDateTime restEnd = LocalDateTime.parse(end, originalFormat2);\r\n            if (compareLocalDateTimes(restStart, restEnd) == 1) {\r\n                restEnd.plusDays(1);\r\n            }\r\n            working_hours -= calculateTimes(restStart, restEnd);\r\n            working_mins -= calculateMinutes(restStart, restEnd);\r\n        }\r\n        // 处理自由班打卡规则\r\n        if (!ObjectUtils.isEmpty(ruleData) && ruleData.get(\"schedule_type\") == \"free\") {\r\n            // 打卡两次及以上\r\n            if (ruleData.get(\"free_ratio\") == 2) {\r\n                if (working_mins <= ruleData.get(\"free_min_minutes\")) {\r\n                    working_hours = 0;\r\n                }\r\n            }\r\n        }\r\n        record.set(\"working_hours\", working_hours)\r\n\r\n        // 计算实际出勤天数(实际出勤工时 / 规则上的总工时  * 应出勤天数)\r\n        if (working_hours != 0 && work_load != 0) {\r\n            actual_attendance_days = ((working_hours * 60) / work_load) * attendance_ratio;\r\n            // 四舍五入保留一位\r\n            double rounded = Math.round(actual_attendance_days * 10.0) / 10.0;\r\n            record.set(\"actual_attendance_days\", rounded)\r\n        }\r\n        record.set(\"actual_attendance_days\", actual_attendance_days);\r\n    }\r\n\r\n    /**\r\n     * 处理申请数据\r\n     */\r\n    private void processCheckinApplications(applications, attendance_schedule, record, start, should_attendance_hours) {\r\n        SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n        if(!ObjectUtils.isEmpty(applications)){\r\n            for (Map<String, Object> item : applications) {\r\n                String endTime = String.valueOf(item.get(\"DATE_TO\"));\r\n                String baseStart = dateFormat.format(attendance_schedule.get(\"checkin_date\")).toString() + \" \" + start;\r\n                LocalDateTime  baseStartTime = LocalDateTime.parse(baseStart, originalFormat2).withSecond(0).withNano(0);\r\n                LocalDateTime  end_Time = LocalDateTime.parse(endTime, originalFormat).withSecond(0).withNano(0);\r\n                double checkinApplicationDuration = calculateTimes(baseStartTime, end_Time);\r\n                if (checkinApplicationDuration >= should_attendance_hours) {\r\n                    record.set(\"leave_duration\", should_attendance_hours);\r\n                    record.set(\"leave_type\", item.get(\"LEAVE_TYPE\"));\r\n                } else {\r\n                    record.set(\"leave_duration\", checkinApplicationDuration);\r\n                    record.set(\"leave_type\", item.get(\"LEAVE_TYPE\"));\r\n                }\r\n                //todo Odoo其他申请类型暂未确认\r\n//                if (item.get(\"APPLY_TYPE\") == \"LEAVE\") {\r\n//                    if (checkinApplicationDuration >= should_attendance_hours) {\r\n//                        record.set(\"leave_duration\", should_attendance_hours);\r\n//                        record.set(\"leave_type\", item.get(\"LEAVE_TYPE\"));\r\n//                    } else {\r\n//                        record.set(\"leave_duration\", checkinApplicationDuration);\r\n//                        record.set(\"leave_type\", item.get(\"LEAVE_TYPE\"));\r\n//                    }\r\n//                } else if (item.get(\"APPLY_TYPE\") == \"BUSINESS_TRIP\"){\r\n//                    if (checkinApplicationDuration >= should_attendance_hours) {\r\n//                        record.set(\"on_business_days\", 1);\r\n//                    }\r\n//                } else if (item.get(\"APPLY_TYPE\") == \"GO_OUT\"){\r\n//                    if (checkinApplicationDuration >= should_attendance_hours) {\r\n//                        record.set(\"out_hours\", should_attendance_hours);\r\n//                    } else {\r\n//                        record.set(\"out_hours\", checkinApplicationDuration);\r\n//                    }\r\n//                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 解析班次\r\n     */\r\n    private Map<String, LocalDateTime> parseWorkTime(IEntityDTO attendance_schedule, Entity work_time) {\r\n        String checkinDate = String.valueOf(attendance_schedule.get(\"checkin_date\")).substring(0, 11);\r\n        String start = checkinDate + String.valueOf(work_time.get(\"start_base_time\"));\r\n        String end = checkinDate + String.valueOf(work_time.get(\"end_base_time\"));\r\n        LocalDateTime start_time = LocalDateTime.parse(start, originalFormat2).withSecond(0).withNano(0);\r\n        LocalDateTime end_time = LocalDateTime.parse(end, originalFormat2).withSecond(0).withNano(0);\r\n        // 次日班次\r\n        if (work_time.get(\"isNextDay\") == 1) {\r\n            start_time = start_time.plusDays(1);\r\n            end_time = end_time.plusDays(1);\r\n        } else if (work_time.get(\"isNextDay\") == 2) {\r\n            end_time = end_time.plusDays(1);\r\n        }\r\n        // 上班晚 30分钟 记为迟到(计弹性打卡时间)\r\n        LocalDateTime lateStartTimeLimit = start_time.plusMinutes(work_time.get(\"late_for_late\"));\r\n        if (!ObjectUtils.isEmpty(attendance_schedule.get(\"rule_data\"))) {\r\n            Map<String, Object> rule_data = attendance_schedule.get(\"rule_data\") as Map<String, Object>;\r\n            if (!ObjectUtils.isEmpty(rule_data.get(\"elastic_valid\")) && rule_data.get(\"elastic_valid\") == 1) {\r\n                if (rule_data.get(\"elastic_minutes\") > work_time.get(\"late_for_late\")) {\r\n                    lateStartTimeLimit = start_time.plusMinutes(rule_data.get(\"elastic_minutes\"));\r\n                }\r\n            }\r\n        }\r\n        // 上班晚 n分钟 记为缺卡\r\n        LocalDateTime missingStartTimeLimit = start_time.plusMinutes(work_time.get(\"late_for_absenteeism\") ?: 0);\r\n        // 最早提前 n分钟 记为正常打卡\r\n        LocalDateTime earliestStartTimeLimit = start_time.minusMinutes(work_time.get(\"earliest_checkin\") ?: 0);\r\n        // 下班时间最晚 n分钟 记为正常打卡\r\n        LocalDateTime latestEndTimeLimit = end_time.plusMinutes(work_time.get(\"latest_checkout\") ?: 0);\r\n        // 下班早 n分钟 记为早退\r\n        LocalDateTime earlyLeaveEndTimeLimit = end_time.minusMinutes(work_time.get(\"early_for_early\") ?: 0);\r\n        // 下班早 n分钟 记为缺卡\r\n        LocalDateTime missingEndTimeLimit = end_time.minusMinutes(work_time.get(\"early_for_absenteeism\") ?: 0);\r\n        Map<String, LocalDateTime> map = new HashMap<>();\r\n        map.put(\"missingStartTimeLimit\", missingStartTimeLimit);\r\n        map.put(\"earliestStartTimeLimit\", earliestStartTimeLimit);\r\n        map.put(\"latestEndTimeLimit\", latestEndTimeLimit);\r\n        map.put(\"earlyLeaveEndTimeLimit\", earlyLeaveEndTimeLimit);\r\n        map.put(\"missingEndTimeLimit\", missingEndTimeLimit);\r\n        map.put(\"lateStartTimeLimit\", lateStartTimeLimit);\r\n        // 上下班时间（特供灵活打卡、自由班）\r\n        map.put(\"start_base_time\", start_time);\r\n        map.put(\"end_base_time\", end_time);\r\n        return map;\r\n    }\r\n\r\n    /**\r\n     * 处理打卡记录\r\n     */\r\n    private Map<String, List<LocalDateTime>> processClockRecord(Map<String, LocalDateTime> workTimeMap, clock_list, String schedule_type) {\r\n        // 上班正常打卡时间\r\n        List<LocalDateTime> normal_start_check_times = new ArrayList<>();\r\n        // 上班迟到打卡时间\r\n        List<LocalDateTime> late_start_check_times = new ArrayList<>();\r\n        // 上下班缺卡打卡时间\r\n        List<LocalDateTime> missing_check_times = new ArrayList<>();\r\n        // 下班正常打卡时间\r\n        List<LocalDateTime> normal_end_check_times = new ArrayList<>();\r\n        // 下班早退打卡时间\r\n        List<LocalDateTime> early_end_check_times = new ArrayList<>();\r\n        // 超出有效打卡时间范围: 无效打卡\r\n        List<LocalDateTime> invalid_check_times = new ArrayList<>();\r\n        // 上下班区间内打卡（特供灵活打卡、自由班）\r\n        List<LocalDateTime> between_check_times = new ArrayList<>();\r\n        for (Map<String, Object> clock : clock_list) {\r\n            String check_in_date = String.valueOf(clock.get(\"CHECKIN_TIME\"));\r\n            if (!ObjectUtils.isEmpty(check_in_date)){\r\n                LocalDateTime check_in_local_date = formatTimeStr(check_in_date);\r\n                LocalDateTime check_in_time = LocalDateTime.parse(check_in_date, originalFormat).withSecond(0).withNano(0);\r\n                if (isTimeInRange01(check_in_time, workTimeMap.get(\"earliestStartTimeLimit\"), workTimeMap.get(\"lateStartTimeLimit\"))){\r\n                    //上班正常 打卡时间范围  判断是否在 earliestStartTimeLimit ~ lateStartTimeLimit 包含最早最晚时间\r\n                    normal_start_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange02(check_in_time, workTimeMap.get(\"lateStartTimeLimit\"), workTimeMap.get(\"missingStartTimeLimit\"))){\r\n                    //上班迟到 打卡时间范围  判断是否在lateStartTimeLimit后 ~ missingStartTimeLimit 不包含最早 但包含最晚\r\n                    late_start_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange01(check_in_time, workTimeMap.get(\"earlyLeaveEndTimeLimit\"), workTimeMap.get(\"latestEndTimeLimit\"))){\r\n                    //下班正常 打卡时间范围  判断是否在 earlyLeaveEndTimeLimit ~ latestEndTimeLimit 包含最早最晚时间\r\n                    normal_end_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange03(check_in_time, workTimeMap.get(\"missingEndTimeLimit\"), workTimeMap.get(\"earlyLeaveEndTimeLimit\"))){\r\n                    //下班早退 打卡时间范围  判断是否在 missingEndTimeLimit 后 ~ earlyLeaveEndTimeLimit 不包含最早 但包含最晚\r\n                    early_end_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange04(check_in_time, workTimeMap.get(\"missingStartTimeLimit\"), workTimeMap.get(\"missingEndTimeLimit\"))){\r\n                    //上下班缺卡 打卡时间范围  判断是否在 missingStartTimeLimit ~ missingEndTimeLimit 不包含最早 不包含最晚\r\n                    missing_check_times.add(check_in_local_date)\r\n                } else {\r\n                    invalid_check_times.add(check_in_local_date)\r\n                }\r\n                // 特殊规则使用\r\n                if ((schedule_type == \"flexible\" || schedule_type == \"free\") && isTimeInRange01(check_in_time, workTimeMap.get(\"earliestStartTimeLimit\"), workTimeMap.get(\"latestEndTimeLimit\"))) {\r\n                    //上下班区间 打卡时间范围  判断是否在 start_base_time ~ end_base_time 包含最早最晚时间\r\n                    between_check_times.add(check_in_local_date)\r\n                }\r\n            }\r\n        }\r\n        Map<String, List<LocalDateTime>> map = new HashMap<>();\r\n\r\n        map.put(\"normal_start_check_times\", normal_start_check_times);\r\n        map.put(\"late_start_check_times\", late_start_check_times);\r\n        map.put(\"missing_check_times\", missing_check_times);\r\n        map.put(\"normal_end_check_times\", normal_end_check_times);\r\n        map.put(\"early_end_check_times\", early_end_check_times);\r\n        map.put(\"invalid_check_times\", invalid_check_times);\r\n        map.put(\"between_check_times\", between_check_times);\r\n        // 找到时间最小的两条记录，并移除，排除打卡记录被重复利用问题\r\n        removeMinTimeRecords(clock_list);\r\n        return map;\r\n    }\r\n\r\n    /**\r\n     * 处理打卡详情记录\r\n     */\r\n    private IEntityDTO processCheckinDetail(Entity ruleData, recordDetailRuntime, Entity workTime, applications, String recordId, Map<String, List<LocalDateTime>> map, int index, tag) {\r\n        String start = String.valueOf(workTime.get(\"start_base_time\"));\r\n        String end = String.valueOf(workTime.get(\"end_base_time\"));\r\n        String id = KeyValueUtils.genUniqueId();\r\n        IEntityDTO detail = recordDetailRuntime.createEntity();\r\n        detail.set(\"id\", id);\r\n        detail.set(\"record_id\", recordId);\r\n        if (!ObjectUtils.isEmpty(applications)) {\r\n            for (Map<String, Object> application : applications) {\r\n                String startTime = String.valueOf(application.get(\"DATE_FROM\"));\r\n                String endTime = String.valueOf(application.get(\"DATE_TO\"));\r\n                LocalDateTime workTimeStart = LocalDateTime.parse(startTime.substring(0, 10) + \" \" + start, originalFormat2).withSecond(0).withNano(0);\r\n                LocalDateTime workTimeEnd = LocalDateTime.parse(startTime.substring(0, 10) + \" \" + end, originalFormat2).withSecond(0).withNano(0);\r\n                LocalDateTime applicationStart = LocalDateTime.parse(startTime, originalFormat).withSecond(0).withNano(0);\r\n                LocalDateTime applicationEnd = LocalDateTime.parse(endTime, originalFormat).withSecond(0).withNano(0);\r\n                if (isTimeInRange5(workTimeStart, workTimeEnd, applicationStart, applicationEnd)) {\r\n                    detail.set(\"checkin_result\", application.get(\"LEAVE_TYPE\"));\r\n                }\r\n                if (tag == 0) {\r\n                    detail.set(\"detail_index\", \"start\");\r\n                    detail.set(\"should_checkin_time\", start);\r\n                } else {\r\n                    detail.set(\"detail_index\", \"end\");\r\n                    detail.set(\"should_checkin_time\", end);\r\n                }\r\n            }\r\n        } else {\r\n            boolean normal = false;\r\n            if (tag == 0) {\r\n                detail.set(\"detail_index\", \"start_\" + index);\r\n                detail.set(\"should_checkin_time\", start);\r\n                // 处理灵活打卡规则-上下班时间内打卡一次\r\n                if (!ObjectUtils.isEmpty(ruleData) && ruleData.get(\"requirement\") == \"only_once\" && map.get(\"between_check_times\").size() > 0) {\r\n                    detail.set(\"checkin_time\", start);\r\n                    detail.set(\"checkin_result\", \"NORMAL\");\r\n                    return detail;\r\n                } else if (ruleData.get(\"requirement\") == \"only_once\") {\r\n                    detail.set(\"checkin_result\", \"ABSENT\");\r\n                    return detail;\r\n                }\r\n\r\n                // 处理灵活打卡规则-只打下班卡\r\n                if (!ObjectUtils.isEmpty(ruleData) && ruleData.get(\"requirement\") == \"only_checkout\") {\r\n                    detail.set(\"checkin_time\", start);\r\n                    detail.set(\"checkin_result\", \"NORMAL\");\r\n                } else {\r\n                    if (!ObjectUtils.isEmpty(map.get(\"normal_start_check_times\"))){\r\n                        // 获取最早时间\r\n                        LocalDateTime earliestTime = Collections.min(map.get(\"normal_start_check_times\"));\r\n                        detail.set(\"checkin_time\", earliestTime);\r\n                        detail.set(\"checkin_result\", \"NORMAL\");\r\n                        normal = true;\r\n                    }\r\n                    if (!normal){\r\n                        boolean abnormal = false;\r\n                        // 迟到打卡\r\n                        if (!ObjectUtils.isEmpty(map.get(\"late_start_check_times\"))){\r\n                            // 获取最早时间\r\n                            LocalDateTime earliestTime = Collections.min(map.get(\"late_start_check_times\"));\r\n                            detail.set(\"checkin_time\", earliestTime);\r\n                            detail.set(\"checkin_result\", \"LATE\");\r\n                            abnormal = true;\r\n                        }\r\n                        // 缺卡\r\n                        if (!abnormal && !ObjectUtils.isEmpty(map.get(\"missing_check_times\"))){\r\n                            LocalDateTime earliestTime = Collections.min(map.get(\"missing_check_times\"));\r\n                            detail.set(\"checkin_time\", earliestTime);\r\n                            detail.set(\"checkin_result\", \"ON_MISSING\");\r\n                        }\r\n                        // 无效打卡\r\n                        if (!abnormal && !ObjectUtils.isEmpty(map.get(\"invalid_check_times\"))) {\r\n                            LocalDateTime earliestTime = Collections.min(map.get(\"invalid_check_times\"));\r\n                            detail.set(\"checkin_time\", earliestTime);\r\n                            detail.set(\"checkin_result\", \"ON_MISSING\");\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                detail.set(\"detail_index\", \"end_\" + index);\r\n                detail.set(\"should_checkin_time\", end);\r\n                // 处理灵活打卡规则-上下班时间内打卡一次\r\n                if (!ObjectUtils.isEmpty(ruleData) && ruleData.get(\"requirement\") == \"only_once\" && map.get(\"between_check_times\").size() > 0) {\r\n                    detail.set(\"checkin_time\", end);\r\n                    detail.set(\"checkin_result\", \"NORMAL\");\r\n                    return detail;\r\n                } else if (ruleData.get(\"requirement\") == \"only_once\") {\r\n                    detail.set(\"checkin_result\", \"ABSENT\");\r\n                    return detail;\r\n                }\r\n\r\n                // 处理灵活打卡规则-只打上班卡\r\n                if (!ObjectUtils.isEmpty(ruleData) && ruleData.get(\"requirement\") == \"only_checkout\") {\r\n                    detail.set(\"checkin_time\", end);\r\n                    detail.set(\"checkin_result\", \"NORMAL\");\r\n                } else {\r\n                    if (!ObjectUtils.isEmpty(map.get(\"normal_end_check_times\"))){\r\n                        // 获取晚时间\r\n                        LocalDateTime latestTime = Collections.max(map.get(\"normal_end_check_times\"));\r\n                        detail.set(\"checkin_time\", latestTime);\r\n                        detail.set(\"checkin_result\", \"NORMAL\");\r\n                        normal = true;\r\n                    }\r\n                    if (!normal){\r\n                        boolean abnormal = false;\r\n                        // 早退\r\n                        if (!ObjectUtils.isEmpty(map.get(\"early_end_check_times\"))){\r\n                            LocalDateTime latestTime = Collections.max(map.get(\"early_end_check_times\"));\r\n                            detail.set(\"checkin_time\", latestTime);\r\n                            detail.set(\"checkin_result\", \"LEAVE_EARLY\");\r\n                            abnormal = true;\r\n                        }\r\n                        // 缺卡\r\n                        if (!abnormal && !ObjectUtils.isEmpty(map.get(\"missing_check_times\"))){\r\n                            LocalDateTime latestTime = Collections.max(map.get(\"missing_check_times\"));\r\n                            detail.set(\"checkin_time\", latestTime);\r\n                            detail.set(\"checkin_result\", \"OFF_MISSING\");\r\n                        }\r\n                        // 无效打卡\r\n                        if (!abnormal && !ObjectUtils.isEmpty(map.get(\"invalid_check_times\"))) {\r\n                            LocalDateTime latestTime = Collections.max(map.get(\"invalid_check_times\"))\r\n                            if (detail.get(\"checkin_time\")){\r\n                                LocalDateTime checkin_time = (Timestamp)detail.get(\"checkin_time\").toLocalDateTime()\r\n                                if (latestTime.isAfter(checkin_time)){\r\n                                    detail.set(\"checkin_time\", latestTime);\r\n                                }\r\n                                detail.set(\"checkin_result\", \"OFF_MISSING\");\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (ObjectUtils.isEmpty(detail.get(\"checkin_result\"))){\r\n                detail.set(\"checkin_result\", \"ABSENT\");\r\n            }\r\n        }\r\n        return detail;\r\n    }\r\n\r\n    /**\r\n     * 批量保存数据\r\n     */\r\n    private void batchSaveData(IDataEntityRuntime attendanceRecordRuntime, List<IEntityDTO> records,\r\n                               IDataEntityRuntime recordDetailRuntime, List<IEntityDTO> details) {\r\n        if (!records.isEmpty()) {\r\n            attendanceRecordRuntime.rawCreate(records, true)\r\n        }\r\n        if (!details.isEmpty()) {\r\n            recordDetailRuntime.rawCreate(details, true)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 找到最小时间的两条记录，并移除\r\n     */\r\n    private static void removeMinTimeRecords(List<Map<String, Object>> data) {\r\n        // 如果 data 为 null 或者数据量少于 1 条，直接返回\r\n        if (data == null || data.size() < 1) return;\r\n        // 如果只有一条或两条记录，直接移除\r\n        if (data.size() == 1 || data.size() == 2) {\r\n            data.clear(); // 清空所有记录\r\n            return;\r\n        }\r\n        // 找到CHECKIN_TIME最小的两条记录\r\n        Map<String, Object> minTimeRecord = data.get(0);\r\n        String minTime = (String) minTimeRecord.get(\"CHECKIN_TIME\");\r\n        Map<String, Object> secondMinTimeRecord = null;\r\n        String secondMinTime = null;\r\n        // 遍历，找到最小和第二小的记录\r\n        for (Map<String, Object> record : data) {\r\n            String checkinTime = (String) record.get(\"CHECKIN_TIME\");\r\n\r\n            if (checkinTime.compareTo(minTime) < 0) {\r\n                // 更新最小时间记录\r\n                secondMinTimeRecord = minTimeRecord;\r\n                secondMinTime = minTime;\r\n                minTime = checkinTime;\r\n                minTimeRecord = record;\r\n            } else if (secondMinTime == null || checkinTime.compareTo(secondMinTime) < 0) {\r\n                // 更新第二小时间记录\r\n                secondMinTime = checkinTime;\r\n                secondMinTimeRecord = record;\r\n            }\r\n        }\r\n        // 移除最小和第二小的记录\r\n        data.remove(minTimeRecord);\r\n        data.remove(secondMinTimeRecord);\r\n    }\r\n\r\n    /**\r\n     * 遍历列表，检查时间，修改 isNextDay 属性，并返回打卡记录\r\n     */\r\n    private List<Map<String, Object>> setNextDayFlag(List<Entity> work_time_list, String memberId, String checkinDate, ISysDBSchemeRuntime dbSchema) {\r\n        String sqlStr = \"select CHECK_IN ,CHECK_OUT  from  hr_attendance ha where EMPLOYEE_ID  = ?\";\r\n        def _param = []\r\n        _param.add(memberId);\r\n        _param.add(checkinDate);\r\n        for (int i = 0; i < work_time_list.size(); i++) {\r\n            Entity currentEntity = work_time_list[i];\r\n            String start = String.valueOf(currentEntity.get(\"start_base_time\"));\r\n            String end = String.valueOf(currentEntity.get(\"end_base_time\"));\r\n            LocalTime start_time = LocalTime.parse(start, time_formatter).withSecond(0).withNano(0);\r\n            LocalTime end_time = LocalTime.parse(end, time_formatter).withSecond(0).withNano(0);\r\n            // 比较 start_base_time 和 end_base_time 的值\r\n            if (compareTimes(start_time, end_time) == 1) {\r\n                LocalDate nextDayDate = LocalDate.parse(checkinDate, formatter).plusDays(1);\r\n                sqlStr += \" AND DATE(CHECK_IN) >= ? AND DATE(CHECK_IN) <= ?\";\r\n                _param.add(nextDayDate);\r\n                // 如果 start_base_time 大于 end_base_time，则设置当前和后续对象的 isNextDay 为 1\r\n                for (int j = i; j < work_time_list.size(); j++) {\r\n                    if (j == i) {\r\n                        work_time_list[j].set(\"isNextDay\", 2);\r\n                    } else {\r\n                        work_time_list[j].set(\"isNextDay\", 1);\r\n                    }\r\n                }\r\n            } else {\r\n                sqlStr += \" AND DATE(CHECK_IN) = ?\";\r\n            }\r\n            break;\r\n        }\r\n        return getClockList(dbSchema, sqlStr, _param);\r\n    }\r\n\r\n    /**\r\n     * 根据班次信息获取打卡记录\r\n     */\r\n    private static List<Map<String, Object>> getClockList(ISysDBSchemeRuntime dbSchema, sqlStr, _param) {\r\n        List<Map<String, Object>> originalList = dbSchema.executeSelectSQL(sqlStr, _param);\r\n\r\n        if (originalList.isEmpty()) {\r\n            return Collections.emptyList();\r\n        }\r\n\r\n        // 创建新列表存储转换后的结果\r\n        List<Map<String, Object>> resultList = new ArrayList<>();\r\n\r\n        for (Map<String, Object> clock : originalList) {\r\n            // 处理签到时间\r\n            if (clock.get(\"CHECK_IN\") != null) {\r\n                Map<String, Object> checkIn = new HashMap<>();\r\n                checkIn.put(\"CHECKIN_TIME\", clock.get(\"CHECK_IN\"));\r\n                resultList.add(checkIn);\r\n            }\r\n\r\n            // 处理签退时间\r\n            if (clock.get(\"CHECK_OUT\") != null) {\r\n                Map<String, Object> checkOut = new HashMap<>();\r\n                checkOut.put(\"CHECKIN_TIME\", clock.get(\"CHECK_OUT\"));\r\n                resultList.add(checkOut);\r\n            }\r\n        }\r\n\r\n        return resultList;\r\n    }\r\n\r\n    /**\r\n     * 判断map当且仅有一个长度为1\r\n     */\r\n    private static boolean checkSingleListLength(Map<String, List<LocalDateTime>> checkTimesMap) {\r\n        int count = 0; // 统计 List 长度为 1 的数量\r\n        // 遍历 Map 中的每个键值对\r\n        for (Map.Entry<String, List<LocalDateTime>> entry : checkTimesMap.entrySet()) {\r\n            List<LocalDateTime> timeList = entry.getValue();\r\n            // 判断 list 的长度是否为 1\r\n            if (timeList != null && timeList.size() > 0) {\r\n                count += timeList.size() ;\r\n            }\r\n        }\r\n        // 如果只有一个 List 长度为 1 的条目\r\n        if (count == 1) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private static LocalDateTime compareAndReturnMax(LocalDateTime time1, LocalDateTime time2) {\r\n        // 处理时间为null的情况\r\n        if (time1 == null && time2 == null) {\r\n            return null; // 如果两个时间都是null，返回null\r\n        }\r\n        if (time1 == null) {\r\n            return time2; // 如果time1是null，返回time2\r\n        }\r\n        if (time2 == null) {\r\n            return time1; // 如果time2是null，返回time1\r\n        }\r\n\r\n        // 如果都不为null，比较大小\r\n        if (time1.isBefore(time2)) {\r\n            return time2; // 返回较大的时间\r\n        } else if (time1.isAfter(time2)) {\r\n            return time1; // 返回较大的时间\r\n        } else {\r\n            return time1; // 如果相等，返回任意一个\r\n        }\r\n    }\r\n\r\n\r\n\r\n    private static int compareLocalDateTimes(LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        if (earliestTime.isBefore(latestTime)) {\r\n            return -1; // earliestTime 小于 latestTime\r\n        } else if (earliestTime.isAfter(latestTime)) {\r\n            return 1;  // earliestTime 大于 latestTime\r\n        } else {\r\n            return 0;  // earliestTime 等于 latestTime\r\n        }\r\n    }\r\n\r\n\r\n    // 判断 earliestTime 是否小于 latestTime\r\n    private static int compareTimes(LocalTime earliestTime, LocalTime latestTime) {\r\n        if (earliestTime.isBefore(latestTime)) {\r\n            return -1; // earliestTime 小于 latestTime\r\n        } else if (earliestTime.isAfter(latestTime)) {\r\n            return 1;  // earliestTime 大于 latestTime\r\n        } else {\r\n            return 0;  // earliestTime 等于 latestTime\r\n        }\r\n    }\r\n\r\n    // 判断时间是否在最早和最晚时间之间（包含最早和最晚）\r\n    private static boolean isTimeInRange1(LocalTime punchTime, LocalTime earliestTime, LocalTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早和最晚时间之间（包含最早和最晚）\r\n    private static boolean isTimeInRange01(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且不超过最晚时间（包含最晚, 不包含最早）\r\n    private static boolean isTimeInRange2(LocalTime punchTime, LocalTime earliestTime, LocalTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且不超过最晚时间（包含最晚, 不包含最早）\r\n    private static boolean isTimeInRange02(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在晚于(包含)最早时间，且晚于最晚时间（不包含最晚, 包含最早）\r\n    private static boolean isTimeInRange3(LocalTime punchTime, LocalTime earliestTime, LocalTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && punchTime.isBefore(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在晚于(包含)最早时间，且晚于最晚时间（不包含最晚, 包含最早）\r\n    private static boolean isTimeInRange03(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && punchTime.isBefore(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且在最晚时间之前（不包含最早和最晚）\r\n    private static boolean isTimeInRange4(LocalTime punchTime, LocalTime earliestTime, LocalTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && punchTime.isBefore(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且在最晚时间之前（不包含最早和最晚）\r\n    private static boolean isTimeInRange04(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && punchTime.isBefore(latestTime);\r\n    }\r\n\r\n    // 判断时间段1，是否在时间段2之间（包含临界值）\r\n    private static boolean isTimeInRange5(LocalDateTime workTimeStart, LocalDateTime workTimeEnd, LocalDateTime applicationStart, LocalDateTime applicationEnd) {\r\n        return applicationStart.isBefore(workTimeStart) && applicationEnd.isAfter(workTimeEnd);\r\n    }\r\n\r\n    private static Object calculateHours(LocalTime startTime, LocalTime endTime) {\r\n        // 计算两个时间之间的持续时间\r\n        Duration duration = Duration.between(startTime, endTime);\r\n        // 将持续时间转换为小时数（以浮动时间表示）\r\n        double hours = duration.toMinutes() / 60.0;\r\n        // 如果是整数，返回整数\r\n        if (hours % 1 == 0) {\r\n            return (long) hours;  // 如果是整数，返回long类型\r\n        } else {\r\n            return hours;  // 保持浮动时间\r\n        }\r\n    }\r\n\r\n    private static double calculateMinutes(LocalDateTime startTime, LocalDateTime endTime) {\r\n        // 计算两个时间之间的持续时间\r\n        Duration duration = Duration.between(startTime, endTime);\r\n        // 将持续时间转换为分钟数\r\n        double minutes = duration.toMinutes();\r\n        // 如果分钟数是整数，返回整数类型\r\n        if (minutes % 1 == 0) {\r\n            return (long) minutes;  // 如果是整数，返回long类型\r\n        } else {\r\n            return minutes;  // 保持浮动时间\r\n        }\r\n    }\r\n\r\n\r\n    private static double calculateTimes(LocalDateTime startTime, LocalDateTime endTime) {\r\n        // 计算两个时间之间的持续时间\r\n        Duration duration = Duration.between(startTime, endTime);\r\n        // 将持续时间转换为小时数（以浮动时间表示，保留一位小数）\r\n        double hours = Math.round((duration.toMinutes() / 60.0) * 10) / 10.0;\r\n        // 如果是整数，返回整数\r\n        if (hours % 1 == 0) {\r\n            return (long) hours;  // 如果是整数，返回long类型\r\n        } else {\r\n            return hours;  // 保持浮动时间\r\n        }\r\n    }\r\n\r\n    private static long calculateMins(LocalTime startTime, LocalTime endTime) {\r\n        Duration duration = Duration.between(startTime, endTime);\r\n        return duration.toMinutes();\r\n    }\r\n\r\n    private static LocalDateTime formatTimeStr(String timeStr){\r\n        // 创建 DateTimeFormatter 对象，定义格式模式\r\n        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss.S\");\r\n        // 使用 DateTimeFormatter 解析字符串为 LocalDateTime 对象\r\n        return LocalDateTime.parse(timeStr, formatter);\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "ClockInRecord",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/ClockInRecord.json",
    "memo" : "打卡记录自定义导出",
    "name" : "ClockInRecordPOIDEDataExportRuntimeEx",
    "pluginCode" : "ClockInRecord",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport.ClockInRecordPOIDEDataExportRuntimeEx",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport\r\n\r\nimport groovy.transform.CompileStatic;\r\nimport net.ibizsys.central.plugin.poi.dataentity.dataexport.POIDEDataExportRuntime\r\n\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.model.dataentity.dataexport.IPSDEDataExportItem\r\nimport net.ibizsys.runtime.security.UserContext\r\nimport org.apache.poi.ss.usermodel.Cell;\r\nimport org.apache.poi.ss.usermodel.Row;\r\nimport org.apache.poi.ss.usermodel.Sheet;\r\nimport org.apache.poi.ss.usermodel.Workbook;\r\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.util.MultiValueMap\r\nimport org.springframework.util.ObjectUtils;\r\nimport java.text.SimpleDateFormat;\r\n\r\n@CompileStatic\r\nclass ClockInRecordPOIDEDataExportRuntimeEx extends POIDEDataExportRuntime {\r\n\r\n    @Override\r\n    protected void onExportStream(Object objData, OutputStream outputStram) throws Throwable {\r\n        Workbook workbook = new XSSFWorkbook();\r\n        Throwable var4 = null;\r\n        try {\r\n            List<IPSDEDataExportItem> exportItems = this.getPSDEDataExport().getPSDEDataExportItems();\r\n            if (ObjectUtils.isEmpty(exportItems)) {\r\n                throw new Exception(\"未指定导出列\");\r\n            }\r\n\r\n            MultiValueMap<String, String> parameters = UserContext.getCurrent().getWebContext().getParameters();\r\n            // 时间范围\r\n            List<String> dateRangeList = convertStringToList(parameters.get(\"date_range\")?.toString());\r\n            List<String> dateRangeWeekList = new ArrayList<>();\r\n            List<String> dateRange = new ArrayList<>();\r\n            if (!ObjectUtils.isEmpty(dateRangeList) && dateRangeList.size() > 0) {\r\n                dateRangeWeekList = generateDateWeekRange(dateRangeList.get(0), dateRangeList.get(1));\r\n                dateRange = generateDateRange(dateRangeList.get(0), dateRangeList.get(1));\r\n            }\r\n\r\n            Sheet sheet = workbook.createSheet();\r\n            Row row = sheet.createRow(0);\r\n\r\n            for(int i = 0; i < exportItems.size(); ++i) {\r\n                IPSDEDataExportItem iPSDEDataExportItem = (IPSDEDataExportItem)exportItems.get(i);\r\n                Cell cell0 = row.createCell(i);\r\n                cell0.setCellValue(iPSDEDataExportItem.getCaption());\r\n            }\r\n\r\n            // 新建日历表格头\r\n            for(int i = 0; i < dateRangeWeekList.size(); ++i) {\r\n                Cell cell0 = row.createCell(i + exportItems.size());\r\n                cell0.setCellValue(dateRangeWeekList[i]);\r\n            }\r\n\r\n            List<IEntityDTO> data = new ArrayList<>();\r\n            if (objData instanceof Page) {\r\n                data = ((Page)objData).getContent();\r\n            } else if (objData instanceof List) {\r\n                data = (List<IEntityDTO>) objData;\r\n            }\r\n            \r\n            // 平铺日历数据\r\n            for (Object item : data) {\r\n                IEntityDTO it = item as IEntityDTO;\r\n                if (!ObjectUtils.isEmpty(it.get(\"attendance_data\"))) {\r\n                    Map<String, Object> attendanceData = it.get(\"attendance_data\") as Map<String, Object>;\r\n                    Set<String> keys = attendanceData.keySet();\r\n                    for (String key : keys) {\r\n                        Map<String, Object> record = attendanceData.get(key) as Map<String, Object>;\r\n                        if (!ObjectUtils.isEmpty(record) && !ObjectUtils.isEmpty(record.get(\"details\"))) {\r\n                            List<IEntityDTO> details = record.get(\"details\") as List<IEntityDTO>;\r\n                            String checkinTime = \"\";\r\n                            for (IEntityDTO item2 : details) {\r\n                                checkinTime += item2.get(\"checkin_time\").toString() + \"\\n\";\r\n                            }\r\n                            it.set(key, checkinTime);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            for(int i = 0; i < data.size(); ++i) {\r\n                IEntityDTO entityDTO = (IEntityDTO)data.get(i);\r\n                Row dataRow = sheet.createRow(i + 1);\r\n                for(int k = 0; k < exportItems.size(); ++k) {\r\n                    IPSDEDataExportItem iPSDEDataExportItem = (IPSDEDataExportItem)exportItems.get(k);\r\n                    Object objValue = entityDTO.get(iPSDEDataExportItem.getName());\r\n                    Cell cell0 = dataRow.createCell(k);\r\n                    if (objValue != null) {\r\n                        cell0.setCellValue(this.convertValue(iPSDEDataExportItem, objValue));\r\n                    }\r\n                }\r\n                // 填充日历数据\r\n                for(int k = 0; k < dateRange.size(); ++k) {\r\n                    Object objValue = entityDTO.get(dateRange[k]);\r\n                    Cell cell0 = dataRow.createCell(k + exportItems.size());\r\n                    if (objValue != null) {\r\n                        cell0.setCellValue(objValue.toString());\r\n                    }\r\n                }\r\n            }\r\n            workbook.write(outputStram);\r\n        } catch (Throwable var25) {\r\n            var4 = var25;\r\n            throw var25;\r\n        } finally {\r\n            if (workbook != null) {\r\n                if (var4 != null) {\r\n                    try {\r\n                        workbook.close();\r\n                    } catch (Throwable var24) {\r\n                        var4.addSuppressed(var24);\r\n                    }\r\n                } else {\r\n                    workbook.close();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // 字符串转List方法\r\n    private static List<String> convertStringToList(String input) {\r\n        if (input == null || input.trim().isEmpty() || input == \"[null]\") {\r\n            return new ArrayList<>();\r\n        }\r\n        // 去除方括号并按逗号分割\r\n        String cleaned = input.substring(1, input.length() - 1).trim();\r\n        String[] parts = cleaned.split(\",\");\r\n\r\n        List<String> result = new ArrayList<>();\r\n        for (String part : parts) {\r\n            if (!\"name\".equals(part.trim())) {\r\n                result.add(part.trim());\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private static List<String> generateDateWeekRange(String startDate, String endDate) throws Exception {\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n        SimpleDateFormat dayOfWeekFormat = new SimpleDateFormat(\"EEEE\", Locale.CHINA);\r\n        Date start = sdf.parse(startDate);\r\n        Date end = sdf.parse(endDate);\r\n        List<String> dateArray = new ArrayList<>();\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.setTime(start);\r\n        while (!calendar.getTime().after(end)) {\r\n            String formattedDate = sdf.format(calendar.getTime()) + \" \" + dayOfWeekFormat.format(calendar.getTime());\r\n            dateArray.add(formattedDate);\r\n            calendar.add(Calendar.DATE, 1);\r\n        }\r\n        return dateArray;\r\n    }\r\n\r\n    private static List<String> generateDateRange(String startDate, String endDate) throws Exception {\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n        Date start = sdf.parse(startDate);\r\n        Date end = sdf.parse(endDate);\r\n        List<String> dateArray = new ArrayList<>();\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.setTime(start);\r\n        while (!calendar.getTime().after(end)) {\r\n            dateArray.add(sdf.format(calendar.getTime()));\r\n            calendar.add(Calendar.DATE, 1);\r\n        }\r\n        return dateArray;\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "ComputeWorkHourDEActionRuntime",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/ComputeWorkHourDEActionRuntime.json",
    "memo" : "计算工作时间、加班时间",
    "name" : "ComputeWorkHourDEActionRuntime",
    "pluginCode" : "ComputeWorkHourDEActionRuntime",
    "pluginType" : "DEACTION",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.ComputeWorkHourDEActionRuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\nimport net.ibizsys.central.cloud.core.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.dataentity.action.DEActionRuntimeBase\r\n\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.central.util.ISearchContextDTO\r\nimport net.ibizsys.runtime.util.Entity\r\nimport org.springframework.util.ObjectUtils\r\n\r\nimport java.sql.Timestamp\r\nimport java.text.SimpleDateFormat\r\nimport java.time.Duration\r\nimport java.time.LocalDate\r\nimport java.time.LocalDateTime\r\nimport java.time.LocalTime\r\nimport java.time.format.DateTimeFormatter\r\n\r\nclass ComputeWorkHourDEActionRuntime extends DEActionRuntimeBase{\r\n\r\n    // 定义日期格式\r\n    private static final DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");\r\n    private static final DateTimeFormatter time_formatter = DateTimeFormatter.ofPattern(\"HH:mm:ss\");\r\n    private static final DateTimeFormatter originalFormat = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss.S\");\r\n    private static final DateTimeFormatter originalFormat2 = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\");\r\n    private static final SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n\r\n    @Override\r\n    protected Object onExecute(IEntityDTO iEntityDTO) throws Throwable {\r\n        iEntityDTO.set(\"worked_hours\", 0.0)\r\n        iEntityDTO.set(\"overtime_hours\", 0.0)\r\n        if(!iEntityDTO.get(\"check_out\")){\r\n            return iEntityDTO\r\n        }\r\n        // 获取相关实体运行时\r\n        IDataEntityRuntime attendance_scheduleRuntime = systemRuntime.getDataEntityRuntime(\"attendance_schedule\");\r\n\r\n        Timestamp originalTimestamp = (Timestamp) iEntityDTO.get(\"check_in\");\r\n        LocalDateTime startOfDay = originalTimestamp.toLocalDateTime()\r\n                .toLocalDate()\r\n                .atStartOfDay()\r\n        Timestamp formattedTimestamp = Timestamp.valueOf(startOfDay);\r\n\r\n        // 查询排班记录\r\n        ISearchContextDTO attendance_scheduleSearchContext = attendance_scheduleRuntime.createSearchContext().all();\r\n        attendance_scheduleSearchContext.eq(\"member_id\", iEntityDTO.get(\"employee_id\"))\r\n        attendance_scheduleSearchContext.eq(\"checkin_date\", formattedTimestamp);\r\n        List<IEntityDTO> attendance_schedules = attendance_scheduleRuntime.selectDataQuery(\"all\", attendance_scheduleSearchContext);\r\n        if (!ObjectUtils.isEmpty(attendance_schedules)) {\r\n            computeWorkHour(iEntityDTO, attendance_schedules[0], formattedTimestamp)\r\n        }\r\n        return iEntityDTO\r\n    }\r\n\r\n    private void computeWorkHour(iEntityDTO, attendance_schedule, checkin_date) {\r\n        //是否工作日\r\n        Integer workday = attendance_schedule.getInteger(\"workday\", 0);\r\n        if (workday == 1) {\r\n            if (!ObjectUtils.isEmpty(checkin_date)){\r\n                //班次信息\r\n                String shift_message = \"\";\r\n                if (!ObjectUtils.isEmpty(attendance_schedule.get(\"work_time\"))){\r\n                    List<Entity> work_time_list = attendance_schedule.get(\"work_time\") as List<Entity>;\r\n                    // 给班次排序\r\n                    work_time_list.sort { it.get(\"order_value\") }\r\n                    // 给跨天班次打标记并返回打卡记录\r\n                    List<Map<String, Object>> clock_list = setNextDayFlag(work_time_list, dateFormat.format(checkin_date), iEntityDTO);\r\n\r\n                    Entity shiftData = attendance_schedule.get(\"shift_data\");\r\n                    int work_item_index = 1;\r\n                    for (Entity work_time : work_time_list){\r\n                        String start = String.valueOf(work_time.get(\"start_base_time\"));\r\n                        String end = String.valueOf(work_time.get(\"end_base_time\"));\r\n                        shift_message += work_time.get(\"shift_name\") + \":\" + start + \"-\" + end;\r\n                        if (!ObjectUtils.isEmpty(start) && !ObjectUtils.isEmpty(end) && !ObjectUtils.isEmpty(clock_list)) {\r\n                            // 解析班次\r\n                            Map<String, LocalDateTime> workTimeMap = parseWorkTime(attendance_schedule, work_time);\r\n                            // 处理打卡记录\r\n                            Map<String, List<LocalDateTime>> checkTimesMap = processClockRecord(workTimeMap, clock_list, attendance_schedule.get(\"schedule_type\"));\r\n                            if (!ObjectUtils.isEmpty(checkTimesMap)) {\r\n                                // 实际出勤时长\r\n                                calculateActualAttendance(attendance_schedule, iEntityDTO, work_time);\r\n                                if (work_time_list.indexOf(work_time) == work_time_list.size() - 1) {\r\n                                    // 最后一个班次，计算加班\r\n                                    calculateOvertime(iEntityDTO, shiftData, workTimeMap, checkTimesMap);\r\n                                }\r\n                            }\r\n                        }\r\n                        work_item_index++\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            // 实际出勤时长\r\n            calculateActualAttendance(attendance_schedule, iEntityDTO, null);\r\n            // 如果员工当天本不工作（如周末），所有工作时长均计为加班\r\n            iEntityDTO.set(\"overtime_hours\", iEntityDTO.get(\"worked_hours\"));\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * 计算实际出勤时长\r\n     */\r\n    private void calculateActualAttendance(IEntityDTO attendance_schedule, IEntityDTO iEntityDTO, workTime) {\r\n\r\n        // 实际出勤小时\r\n        double worked_hours = iEntityDTO.get(\"worked_hours\");\r\n\r\n\r\n        if (!ObjectUtils.isEmpty(iEntityDTO.get(\"check_in\")) && !ObjectUtils.isEmpty(iEntityDTO.get(\"check_out\"))) {\r\n            Timestamp checkInTimestamp = (Timestamp) iEntityDTO.get(\"check_in\");\r\n            Timestamp checkOutTimestamp = (Timestamp) iEntityDTO.get(\"check_out\");\r\n\r\n            LocalDateTime start_check_time = checkInTimestamp.toLocalDateTime();\r\n            LocalDateTime end_check_time = checkOutTimestamp.toLocalDateTime();\r\n            worked_hours += calculateTimes(start_check_time, end_check_time);\r\n        }\r\n        if (workTime && !ObjectUtils.isEmpty(workTime.get(\"rest_enable\")) && workTime.get(\"rest_enable\") == 1) {\r\n            String checkinDate = String.valueOf(attendance_schedule.get(\"checkin_date\")).substring(0, 11);\r\n            String start = checkinDate + String.valueOf(workTime.get(\"rest_start\"));\r\n            String end = checkinDate + String.valueOf(workTime.get(\"end_start\"));\r\n            LocalDateTime restStart = LocalDateTime.parse(start, originalFormat2);\r\n            LocalDateTime restEnd = LocalDateTime.parse(end, originalFormat2);\r\n            if (compareLocalDateTimes(restStart, restEnd) == 1) {\r\n                restEnd.plusDays(1);\r\n            }\r\n            worked_hours -= calculateTimes(restStart, restEnd);\r\n        }\r\n        iEntityDTO.set(\"worked_hours\", worked_hours)\r\n\r\n    }\r\n\r\n    /**\r\n     * 计算加班\r\n     */\r\n    private void calculateOvertime(iEntityDTO, shiftData, Map<String, LocalDateTime> workTimeMap, Map<String, List<LocalDateTime>> checkTimesMap) {\r\n        double overtime_hours = iEntityDTO.get(\"overtime_hours\");\r\n        Timestamp checkInTimestamp = (Timestamp) iEntityDTO.get(\"check_in\");\r\n        LocalDateTime start_check_time = checkInTimestamp.toLocalDateTime();\r\n\r\n        LocalDateTime end = workTimeMap.get(\"end_base_time\");\r\n        if (!ObjectUtils.isEmpty(shiftData.get(\"overtime_valid\")) && shiftData.get(\"overtime_valid\") == 1) {\r\n            long start_overtime = shiftData.get(\"start_overtime\");\r\n            long invalid_overtime = shiftData.get(\"invalid_overtime\");\r\n            LocalDateTime invalidTime = null;\r\n            LocalDateTime normalTime = null;\r\n            if (!ObjectUtils.isEmpty(checkTimesMap.get(\"invalid_check_times\")) && checkTimesMap.get(\"invalid_check_times\").size() > 0) {\r\n                invalidTime = Collections.max(checkTimesMap.get(\"invalid_check_times\"));\r\n            }\r\n            if (!ObjectUtils.isEmpty(checkTimesMap.get(\"normal_end_check_times\")) && checkTimesMap.get(\"normal_end_check_times\").size() > 0) {\r\n                normalTime = Collections.max(checkTimesMap.get(\"normal_end_check_times\"));\r\n            }\r\n            LocalDateTime latestTime = compareAndReturnMax(invalidTime, normalTime);\r\n            // 判断是否符合加班条件\r\n            if (!ObjectUtils.isEmpty(latestTime)) {\r\n                if (compareLocalDateTimes(start_check_time, end.plusMinutes(start_overtime)) == 1) {\r\n                    overtime_hours += calculateTimes(start_check_time, latestTime);\r\n                }else if (compareLocalDateTimes(latestTime, end.plusMinutes(start_overtime)) == 1 && calculateMinutes(end, latestTime) > invalid_overtime) {\r\n                    overtime_hours += calculateTimes(end, latestTime);\r\n                }\r\n            }\r\n        }\r\n        iEntityDTO.set(\"overtime_hours\", overtime_hours);\r\n    }\r\n\r\n\r\n    /**\r\n     * 解析班次\r\n     */\r\n    private Map<String, LocalDateTime> parseWorkTime(IEntityDTO attendance_schedule, Entity work_time) {\r\n        String checkinDate = String.valueOf(attendance_schedule.get(\"checkin_date\")).substring(0, 11);\r\n        String start = checkinDate + String.valueOf(work_time.get(\"start_base_time\"));\r\n        String end = checkinDate + String.valueOf(work_time.get(\"end_base_time\"));\r\n        LocalDateTime start_time = LocalDateTime.parse(start, originalFormat2).withSecond(0).withNano(0);\r\n        LocalDateTime end_time = LocalDateTime.parse(end, originalFormat2).withSecond(0).withNano(0);\r\n        // 次日班次\r\n        if (work_time.get(\"isNextDay\") == 1) {\r\n            start_time = start_time.plusDays(1);\r\n            end_time = end_time.plusDays(1);\r\n        } else if (work_time.get(\"isNextDay\") == 2) {\r\n            end_time = end_time.plusDays(1);\r\n        }\r\n        // 上班晚 30分钟 记为迟到(计弹性打卡时间)\r\n        LocalDateTime lateStartTimeLimit = start_time.plusMinutes(work_time.get(\"late_for_late\"));\r\n        if (!ObjectUtils.isEmpty(attendance_schedule.get(\"rule_data\"))) {\r\n            Map<String, Object> rule_data = attendance_schedule.get(\"rule_data\") as Map<String, Object>;\r\n            if (!ObjectUtils.isEmpty(rule_data.get(\"elastic_valid\")) && rule_data.get(\"elastic_valid\") == 1) {\r\n                if (rule_data.get(\"elastic_minutes\") > work_time.get(\"late_for_late\")) {\r\n                    lateStartTimeLimit = start_time.plusMinutes(rule_data.get(\"elastic_minutes\"));\r\n                }\r\n            }\r\n        }\r\n        // 上班晚 n分钟 记为缺卡\r\n        LocalDateTime missingStartTimeLimit = start_time.plusMinutes(work_time.get(\"late_for_absenteeism\") ?: 0);\r\n        // 最早提前 n分钟 记为正常打卡\r\n        LocalDateTime earliestStartTimeLimit = start_time.minusMinutes(work_time.get(\"earliest_checkin\") ?: 0);\r\n        // 下班时间最晚 n分钟 记为正常打卡\r\n        LocalDateTime latestEndTimeLimit = end_time.plusMinutes(work_time.get(\"latest_checkout\") ?: 0);\r\n        // 下班早 n分钟 记为早退\r\n        LocalDateTime earlyLeaveEndTimeLimit = end_time.minusMinutes(work_time.get(\"early_for_early\") ?: 0);\r\n        // 下班早 n分钟 记为缺卡\r\n        LocalDateTime missingEndTimeLimit = end_time.minusMinutes(work_time.get(\"early_for_absenteeism\") ?: 0);\r\n        Map<String, LocalDateTime> map = new HashMap<>();\r\n        map.put(\"missingStartTimeLimit\", missingStartTimeLimit);\r\n        map.put(\"earliestStartTimeLimit\", earliestStartTimeLimit);\r\n        map.put(\"latestEndTimeLimit\", latestEndTimeLimit);\r\n        map.put(\"earlyLeaveEndTimeLimit\", earlyLeaveEndTimeLimit);\r\n        map.put(\"missingEndTimeLimit\", missingEndTimeLimit);\r\n        map.put(\"lateStartTimeLimit\", lateStartTimeLimit);\r\n        // 上下班时间（特供灵活打卡、自由班）\r\n        map.put(\"start_base_time\", start_time);\r\n        map.put(\"end_base_time\", end_time);\r\n        return map;\r\n    }\r\n\r\n    /**\r\n     * 处理打卡记录\r\n     */\r\n    private Map<String, List<LocalDateTime>> processClockRecord(Map<String, LocalDateTime> workTimeMap, clock_list, String schedule_type) {\r\n        // 上班正常打卡时间\r\n        List<LocalDateTime> normal_start_check_times = new ArrayList<>();\r\n        // 上班迟到打卡时间\r\n        List<LocalDateTime> late_start_check_times = new ArrayList<>();\r\n        // 上下班缺卡打卡时间\r\n        List<LocalDateTime> missing_check_times = new ArrayList<>();\r\n        // 下班正常打卡时间\r\n        List<LocalDateTime> normal_end_check_times = new ArrayList<>();\r\n        // 下班早退打卡时间\r\n        List<LocalDateTime> early_end_check_times = new ArrayList<>();\r\n        // 超出有效打卡时间范围: 无效打卡\r\n        List<LocalDateTime> invalid_check_times = new ArrayList<>();\r\n        // 上下班区间内打卡（特供灵活打卡、自由班）\r\n        List<LocalDateTime> between_check_times = new ArrayList<>();\r\n        for (Map<String, Object> clock : clock_list) {\r\n            String check_in_date = String.valueOf(clock.get(\"CHECKIN_TIME\"));\r\n            if (!ObjectUtils.isEmpty(check_in_date)){\r\n                LocalDateTime check_in_local_date = formatTimeStr(check_in_date);\r\n                LocalDateTime check_in_time = LocalDateTime.parse(check_in_date, originalFormat).withSecond(0).withNano(0);\r\n                if (isTimeInRange01(check_in_time, workTimeMap.get(\"earliestStartTimeLimit\"), workTimeMap.get(\"lateStartTimeLimit\"))){\r\n                    //上班正常 打卡时间范围  判断是否在 earliestStartTimeLimit ~ lateStartTimeLimit 包含最早最晚时间\r\n                    normal_start_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange02(check_in_time, workTimeMap.get(\"lateStartTimeLimit\"), workTimeMap.get(\"missingStartTimeLimit\"))){\r\n                    //上班迟到 打卡时间范围  判断是否在lateStartTimeLimit后 ~ missingStartTimeLimit 不包含最早 但包含最晚\r\n                    late_start_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange01(check_in_time, workTimeMap.get(\"earlyLeaveEndTimeLimit\"), workTimeMap.get(\"latestEndTimeLimit\"))){\r\n                    //下班正常 打卡时间范围  判断是否在 earlyLeaveEndTimeLimit ~ latestEndTimeLimit 包含最早最晚时间\r\n                    normal_end_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange03(check_in_time, workTimeMap.get(\"missingEndTimeLimit\"), workTimeMap.get(\"earlyLeaveEndTimeLimit\"))){\r\n                    //下班早退 打卡时间范围  判断是否在 missingEndTimeLimit 后 ~ earlyLeaveEndTimeLimit 不包含最早 但包含最晚\r\n                    early_end_check_times.add(check_in_local_date)\r\n                } else if (isTimeInRange04(check_in_time, workTimeMap.get(\"missingStartTimeLimit\"), workTimeMap.get(\"missingEndTimeLimit\"))){\r\n                    //上下班缺卡 打卡时间范围  判断是否在 missingStartTimeLimit ~ missingEndTimeLimit 不包含最早 不包含最晚\r\n                    missing_check_times.add(check_in_local_date)\r\n                } else {\r\n                    invalid_check_times.add(check_in_local_date)\r\n                }\r\n                // 特殊规则使用\r\n                if ((schedule_type == \"flexible\" || schedule_type == \"free\") && isTimeInRange01(check_in_time, workTimeMap.get(\"earliestStartTimeLimit\"), workTimeMap.get(\"latestEndTimeLimit\"))) {\r\n                    //上下班区间 打卡时间范围  判断是否在 start_base_time ~ end_base_time 包含最早最晚时间\r\n                    between_check_times.add(check_in_local_date)\r\n                }\r\n            }\r\n        }\r\n        Map<String, List<LocalDateTime>> map = new HashMap<>();\r\n\r\n        map.put(\"normal_start_check_times\", normal_start_check_times);\r\n        map.put(\"late_start_check_times\", late_start_check_times);\r\n        map.put(\"missing_check_times\", missing_check_times);\r\n        map.put(\"normal_end_check_times\", normal_end_check_times);\r\n        map.put(\"early_end_check_times\", early_end_check_times);\r\n        map.put(\"invalid_check_times\", invalid_check_times);\r\n        map.put(\"between_check_times\", between_check_times);\r\n        // 找到时间最小的两条记录，并移除，排除打卡记录被重复利用问题\r\n        removeMinTimeRecords(clock_list);\r\n        return map;\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * 找到最小时间的两条记录，并移除\r\n     */\r\n    private static void removeMinTimeRecords(List<Map<String, Object>> data) {\r\n        // 如果 data 为 null 或者数据量少于 1 条，直接返回\r\n        if (data == null || data.size() < 1) return;\r\n        // 如果只有一条或两条记录，直接移除\r\n        if (data.size() == 1 || data.size() == 2) {\r\n            data.clear(); // 清空所有记录\r\n            return;\r\n        }\r\n        // 找到CHECKIN_TIME最小的两条记录\r\n        Map<String, Object> minTimeRecord = data.get(0);\r\n        String minTime = (String) minTimeRecord.get(\"CHECKIN_TIME\");\r\n        Map<String, Object> secondMinTimeRecord = null;\r\n        String secondMinTime = null;\r\n        // 遍历，找到最小和第二小的记录\r\n        for (Map<String, Object> record : data) {\r\n            String checkinTime = (String) record.get(\"CHECKIN_TIME\");\r\n\r\n            if (checkinTime.compareTo(minTime) < 0) {\r\n                // 更新最小时间记录\r\n                secondMinTimeRecord = minTimeRecord;\r\n                secondMinTime = minTime;\r\n                minTime = checkinTime;\r\n                minTimeRecord = record;\r\n            } else if (secondMinTime == null || checkinTime.compareTo(secondMinTime) < 0) {\r\n                // 更新第二小时间记录\r\n                secondMinTime = checkinTime;\r\n                secondMinTimeRecord = record;\r\n            }\r\n        }\r\n        // 移除最小和第二小的记录\r\n        data.remove(minTimeRecord);\r\n        data.remove(secondMinTimeRecord);\r\n    }\r\n\r\n    /**\r\n     * 遍历列表，检查时间，修改 isNextDay 属性，并返回打卡记录\r\n     */\r\n    private List<Map<String, Object>> setNextDayFlag(List<Entity> work_time_list, String checkinDate, IEntityDTO iEntityDTO) {\r\n        for (int i = 0; i < work_time_list.size(); i++) {\r\n            Entity currentEntity = work_time_list[i];\r\n            String start = String.valueOf(currentEntity.get(\"start_base_time\"));\r\n            String end = String.valueOf(currentEntity.get(\"end_base_time\"));\r\n            LocalTime start_time = LocalTime.parse(start, time_formatter).withSecond(0).withNano(0);\r\n            LocalTime end_time = LocalTime.parse(end, time_formatter).withSecond(0).withNano(0);\r\n            // 比较 start_base_time 和 end_base_time 的值\r\n            if (compareTimes(start_time, end_time) == 1) {\r\n                LocalDate nextDayDate = LocalDate.parse(checkinDate, formatter).plusDays(1);\r\n                // 如果 start_base_time 大于 end_base_time，则设置当前和后续对象的 isNextDay 为 1\r\n                for (int j = i; j < work_time_list.size(); j++) {\r\n                    if (j == i) {\r\n                        work_time_list[j].set(\"isNextDay\", 2);\r\n                    } else {\r\n                        work_time_list[j].set(\"isNextDay\", 1);\r\n                    }\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        return getClockList(iEntityDTO);\r\n    }\r\n\r\n    /**\r\n     * 构造打卡记录\r\n     */\r\n    private static List<Map<String, Object>> getClockList(iEntityDTO) {\r\n\r\n        // 创建新列表存储转换后的结果\r\n        List<Map<String, Object>> resultList = new ArrayList<>();\r\n\r\n        // 处理签到时间\r\n        if (iEntityDTO.get(\"CHECK_IN\") != null) {\r\n            Map<String, Object> checkIn = new HashMap<>();\r\n            checkIn.put(\"CHECKIN_TIME\", iEntityDTO.get(\"CHECK_IN\"));\r\n            resultList.add(checkIn);\r\n        }\r\n\r\n        // 处理签退时间\r\n        if (iEntityDTO.get(\"CHECK_OUT\") != null) {\r\n            Map<String, Object> checkOut = new HashMap<>();\r\n            checkOut.put(\"CHECKIN_TIME\", iEntityDTO.get(\"CHECK_OUT\"));\r\n            resultList.add(checkOut);\r\n        }\r\n\r\n        return resultList;\r\n    }\r\n\r\n\r\n    private static LocalDateTime compareAndReturnMax(LocalDateTime time1, LocalDateTime time2) {\r\n        // 处理时间为null的情况\r\n        if (time1 == null && time2 == null) {\r\n            return null; // 如果两个时间都是null，返回null\r\n        }\r\n        if (time1 == null) {\r\n            return time2; // 如果time1是null，返回time2\r\n        }\r\n        if (time2 == null) {\r\n            return time1; // 如果time2是null，返回time1\r\n        }\r\n\r\n        // 如果都不为null，比较大小\r\n        if (time1.isBefore(time2)) {\r\n            return time2; // 返回较大的时间\r\n        } else if (time1.isAfter(time2)) {\r\n            return time1; // 返回较大的时间\r\n        } else {\r\n            return time1; // 如果相等，返回任意一个\r\n        }\r\n    }\r\n\r\n\r\n\r\n    private static int compareLocalDateTimes(LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        if (earliestTime.isBefore(latestTime)) {\r\n            return -1; // earliestTime 小于 latestTime\r\n        } else if (earliestTime.isAfter(latestTime)) {\r\n            return 1;  // earliestTime 大于 latestTime\r\n        } else {\r\n            return 0;  // earliestTime 等于 latestTime\r\n        }\r\n    }\r\n\r\n\r\n    // 判断 earliestTime 是否小于 latestTime\r\n    private static int compareTimes(LocalTime earliestTime, LocalTime latestTime) {\r\n        if (earliestTime.isBefore(latestTime)) {\r\n            return -1; // earliestTime 小于 latestTime\r\n        } else if (earliestTime.isAfter(latestTime)) {\r\n            return 1;  // earliestTime 大于 latestTime\r\n        } else {\r\n            return 0;  // earliestTime 等于 latestTime\r\n        }\r\n    }\r\n\r\n    // 判断时间是否在最早和最晚时间之间（包含最早和最晚）\r\n    private static boolean isTimeInRange1(LocalTime punchTime, LocalTime earliestTime, LocalTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早和最晚时间之间（包含最早和最晚）\r\n    private static boolean isTimeInRange01(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且不超过最晚时间（包含最晚, 不包含最早）\r\n    private static boolean isTimeInRange2(LocalTime punchTime, LocalTime earliestTime, LocalTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且不超过最晚时间（包含最晚, 不包含最早）\r\n    private static boolean isTimeInRange02(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && !punchTime.isAfter(latestTime);\r\n    }\r\n\r\n\r\n    // 判断时间是否在晚于(包含)最早时间，且晚于最晚时间（不包含最晚, 包含最早）\r\n    private static boolean isTimeInRange03(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return !punchTime.isBefore(earliestTime) && punchTime.isBefore(latestTime);\r\n    }\r\n\r\n    // 判断时间是否在最早时间之后，且在最晚时间之前（不包含最早和最晚）\r\n    private static boolean isTimeInRange04(LocalDateTime punchTime, LocalDateTime earliestTime, LocalDateTime latestTime) {\r\n        return punchTime.isAfter(earliestTime) && punchTime.isBefore(latestTime);\r\n    }\r\n\r\n\r\n    private static double calculateMinutes(LocalDateTime startTime, LocalDateTime endTime) {\r\n        // 计算两个时间之间的持续时间\r\n        Duration duration = Duration.between(startTime, endTime);\r\n        // 将持续时间转换为分钟数\r\n        double minutes = duration.toMinutes();\r\n        // 如果分钟数是整数，返回整数类型\r\n        if (minutes % 1 == 0) {\r\n            return (long) minutes;  // 如果是整数，返回long类型\r\n        } else {\r\n            return minutes;  // 保持浮动时间\r\n        }\r\n    }\r\n\r\n\r\n    private static double calculateTimes(LocalDateTime startTime, LocalDateTime endTime) {\r\n        Duration duration = Duration.between(startTime, endTime);\r\n//        long hours = duration.toHours();\r\n//        long minutes = duration.toMinutes() % 60;\r\n//        return hours + minutes / 100.0;\r\n        double totalHours = duration.toMinutes() / 60.0;\r\n        return totalHours;\r\n    }\r\n\r\n\r\n\r\n    private static LocalDateTime formatTimeStr(String timeStr){\r\n        // 创建 DateTimeFormatter 对象，定义格式模式\r\n        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss.S\");\r\n        // 使用 DateTimeFormatter 解析字符串为 LocalDateTime 对象\r\n        return LocalDateTime.parse(timeStr, formatter);\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "DailyStatistics",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/DailyStatistics.json",
    "memo" : "每日统计自定义导出",
    "name" : "DailyStatisticsPOIDEDataExportRuntimeEx",
    "pluginCode" : "DailyStatistics",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport.DailyStatisticsPOIDEDataExportRuntimeEx",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport\r\n\r\nimport groovy.transform.CompileStatic\r\nimport net.ibizsys.central.plugin.poi.dataentity.dataexport.POIDEDataExportRuntime\r\n\r\nimport net.ibizsys.central.util.IEntityDTO;\r\nimport net.ibizsys.model.dataentity.dataexport.IPSDEDataExportItem\r\nimport net.ibizsys.runtime.security.UserContext\r\nimport org.apache.poi.ss.usermodel.Cell;\r\nimport org.apache.poi.ss.usermodel.Row;\r\nimport org.apache.poi.ss.usermodel.Sheet;\r\nimport org.apache.poi.ss.usermodel.Workbook;\r\nimport org.apache.poi.ss.util.CellRangeAddress;\r\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.util.MultiValueMap;\r\nimport org.springframework.util.ObjectUtils\r\n\r\nimport java.text.SimpleDateFormat;\r\n\r\n@CompileStatic\r\nclass DailyStatisticsPOIDEDataExportRuntimeEx extends POIDEDataExportRuntime {\r\n\r\n\r\n    @Override\r\n    protected void onExportStream(Object objData, OutputStream outputStram) throws Throwable {\r\n        Workbook workbook = new XSSFWorkbook();\r\n        Throwable var4 = null;\r\n\r\n        try {\r\n            List<IPSDEDataExportItem> exportItems = this.getPSDEDataExport().getPSDEDataExportItems();\r\n\r\n            if (ObjectUtils.isEmpty(exportItems)) {\r\n                throw new Exception(\"未指定导出列\");\r\n            }\r\n            MultiValueMap<String, String> parameters = UserContext.getCurrent().getWebContext().getParameters();\r\n\r\n            // 基础信息\r\n            List<String> baseInfoList = convertStringToList(parameters.get(\"base_info\")?.toString())\r\n            // 打卡信息\r\n            List<String> indexNumList = convertStringToList(parameters.get(\"index_num\")?.toString())\r\n            List<String> resultList = new ArrayList<>()\r\n            // 遍历 indexNumList\r\n            for (String item : indexNumList) {\r\n                resultList.add(\"start_\" + item);\r\n                resultList.add(\"end_\" + item);\r\n            }\r\n            List<String> checkInInfoList = convertStringToList(parameters.get(\"check_in_info\")?.toString())\r\n            resultList.addAll(checkInInfoList)\r\n            // 时长统计\r\n            List<String> durationStatisticsList = convertStringToList(parameters.get(\"duration_statistics\")?.toString())\r\n            // 异常统计\r\n            List<String> abnormalList = convertStringToList(parameters.get(\"abnormal_statistics\")?.toString())\r\n\r\n            Sheet sheet = workbook.createSheet()\r\n\r\n            // 创建动态表头\r\n            createHeaders(sheet, baseInfoList, resultList, durationStatisticsList, abnormalList, exportItems);\r\n\r\n            // 获取动态属性列\r\n            Row headerRow = sheet.getRow(2);\r\n            List<String> propertyNames = getPropertyNames(headerRow);\r\n\r\n            // 创建Excel表格数据\r\n            List<IEntityDTO> data = ((Page) objData).getContent();\r\n\r\n            // 平铺打卡数据\r\n            SimpleDateFormat sdf = new SimpleDateFormat(\"HH:mm:ss\");\r\n            for (Object item : data) {\r\n                IEntityDTO it = item as IEntityDTO;\r\n                if (!ObjectUtils.isEmpty(it.get(\"details\"))) {\r\n                    List<IEntityDTO> details = it.get(\"details\") as List<IEntityDTO>;\r\n                    for (IEntityDTO item2 : details) {\r\n                        if (!ObjectUtils.isEmpty(item2.get(\"checkin_time\"))) {\r\n                            it.set(item2.get(\"detail_index\"), sdf.format(item2.get(\"checkin_time\")));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            int startRowIndex = 3; // 数据从第4行开始（0-based索引）\r\n            fillDataRows(sheet, data, propertyNames, startRowIndex);\r\n\r\n            // 删除标识行\r\n            deleteRowSimple(sheet, 2)\r\n\r\n            workbook.write(outputStram);\r\n        } catch (Throwable var25) {\r\n            var4 = var25;\r\n            throw var25;\r\n        } finally {\r\n            if (workbook != null) {\r\n                if (var4 != null) {\r\n                    try {\r\n                        workbook.close();\r\n                    } catch (Throwable var24) {\r\n                        var4.addSuppressed(var24);\r\n                    }\r\n                } else {\r\n                    workbook.close();\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // 字符串转List方法\r\n    private static List<String> convertStringToList(String input) {\r\n        if (input == \"[]\" || input == \"[null]\" || input == \"\" || input == null || input.trim().isEmpty()) {\r\n            return new ArrayList<>();\r\n        }\r\n\r\n        // 去除方括号并按逗号分割\r\n        String cleaned = input.substring(1, input.length() - 1).trim();\r\n        String[] parts = cleaned.split(\",\");\r\n\r\n        List<String> result = new ArrayList<>();\r\n        for (String part : parts) {\r\n            if (!\"name\".equals(part.trim())) {\r\n                result.add(part.trim());\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // 创建复杂的列头结构\r\n    private static void createHeaders(Sheet sheet, List<String> baseInfoList,\r\n                                                  List<String> resultList,\r\n                                                  List<String> durationStatisticsList,\r\n                                                  List<String> abnormalList,\r\n                                                  List<IPSDEDataExportItem> exportItems) {\r\n        // 创建两行表头\r\n        Row row0 = sheet.createRow(0);\r\n        Row row1 = sheet.createRow(1);\r\n        Row row2 = sheet.createRow(2);\r\n        int colIndex = 0;\r\n        // 基本信息分组\r\n        if (baseInfoList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"基本信息\", baseInfoList, exportItems);\r\n        }\r\n        // 打卡信息分组\r\n        if (resultList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"打卡信息\", resultList, exportItems);\r\n        }\r\n        // 时长统计分组\r\n        if (durationStatisticsList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"时长统计\", durationStatisticsList, exportItems);\r\n        }\r\n        // 异常统计分组\r\n        if (abnormalList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"异常统计\", abnormalList, exportItems);\r\n        }\r\n    }\r\n\r\n    // 安全合并单元格（防止无效合并区域）\r\n    private static void addSafeMergedRegion(Sheet sheet, int firstRow, int lastRow,\r\n                                            int firstCol, int lastCol) {\r\n        // 确保是有效的合并区域（至少包含两个单元格）\r\n        int rowSpan = lastRow - firstRow + 1;\r\n        int colSpan = lastCol - firstCol + 1;\r\n\r\n        if (rowSpan >= 2 || colSpan >= 2) {\r\n            sheet.addMergedRegion(new CellRangeAddress(firstRow, lastRow, firstCol, lastCol));\r\n        }\r\n    }\r\n\r\n    // 创建分组列头（修复单列问题）\r\n    private static int createGroupHeader(Sheet sheet, Row row0, Row row1, Row row2,\r\n                                         int startCol, String groupName,\r\n                                         List<String> headers, List<IPSDEDataExportItem> exportItems) {\r\n        if (headers.isEmpty()) {\r\n            return startCol;\r\n        }\r\n\r\n        int endCol = startCol + headers.size() - 1;\r\n\r\n        // 创建分组标题单元格（存在分组列就创建）\r\n        Cell groupCell = row0.createCell(startCol);\r\n        groupCell.setCellValue(groupName);\r\n\r\n        // 处理多列情况\r\n        if (headers.size() > 1) {\r\n            // 横向合并分组标题\r\n            sheet.addMergedRegion(new CellRangeAddress(0, 0, startCol, endCol));\r\n\r\n            // 创建分组内的列头\r\n            for (int i = 0; i < headers.size(); i++) {\r\n                Cell headerCell = row1.createCell(startCol + i);\r\n                Cell headerCell2 = row2.createCell(startCol + i);\r\n                String header = headers.get(i);\r\n                String headerName = getHeaderName(header, exportItems)\r\n                headerCell.setCellValue(headerName);\r\n                headerCell2.setCellValue(header)\r\n            }\r\n        }\r\n        // 处理单列情况\r\n        else if (headers.size() == 1) {\r\n            // 1. 分组标题显示在第一行（不合并）\r\n            // 2. 列头显示在第二行\r\n            // 创建列头单元格\r\n            Cell headerCell = row1.createCell(startCol);\r\n            String header = headers.get(0);\r\n            String headerName = getHeaderName(header, exportItems)\r\n            headerCell.setCellValue(headerName);\r\n            Cell headerCell2 = row2.createCell(startCol);\r\n            headerCell2.setCellValue(header)\r\n        }\r\n\r\n        return endCol + 1;\r\n    }\r\n\r\n    private static String getHeaderName(String header, List<IPSDEDataExportItem> exportItems) {\r\n        String headerName = \"\"\r\n        for (IPSDEDataExportItem item : exportItems) {\r\n            if (item.getName().equals(header)) {\r\n                headerName = item.getCaption()\r\n            }\r\n        }\r\n        return headerName\r\n    }\r\n\r\n    // 填充数据行\r\n    private static void fillDataRows(Sheet sheet, List<IEntityDTO> data, List<String> propertyNames, int startRowIndex) {\r\n        if (data == null || data.isEmpty()) return;\r\n        for (int i = 0; i < data.size(); i++) {\r\n            IEntityDTO entity = data.get(i);\r\n            // 创建每行数据\r\n            Row dataRow = sheet.createRow(startRowIndex + i);\r\n            // 填充每个单元格\r\n            for (int col = 0; col < propertyNames.size(); col++) {\r\n                String propertyName = propertyNames.get(col);\r\n                String propertyValue = entity.get(propertyName);\r\n                Cell cell = dataRow.createCell(col);\r\n                // 设置单元格值\r\n                cell.setCellValue(propertyValue);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 获取第三行的属性名列表\r\n    private static List<String> getPropertyNames(Row headerRow) {\r\n        List<String> propertyNames = new ArrayList<>();\r\n        int lastCellNum = headerRow.getLastCellNum();\r\n\r\n        for (int i = 0; i < lastCellNum; i++) {\r\n            Cell cell = headerRow.getCell(i);\r\n            if (cell != null) {\r\n                propertyNames.add(cell.getStringCellValue());\r\n            } else {\r\n                propertyNames.add(\"\"); // 空值处理\r\n            }\r\n        }\r\n        return propertyNames;\r\n    }\r\n\r\n    private static void deleteRowSimple(Sheet sheet, int rowIndex) {\r\n        int lastRowNum = sheet.getLastRowNum();\r\n        // 验证行索引\r\n        if (rowIndex < 0 || rowIndex > lastRowNum) {\r\n            throw new IllegalArgumentException(\"行索引超出范围: \" + rowIndex);\r\n        }\r\n        // 如果是最后一行，直接删除\r\n        if (rowIndex == lastRowNum) {\r\n            Row row = sheet.getRow(rowIndex);\r\n            if (row != null) {\r\n                sheet.removeRow(row);\r\n            }\r\n        }\r\n        // 如果是中间行，向上移动后续行\r\n        else {\r\n            sheet.shiftRows(rowIndex + 1, lastRowNum, -1);\r\n        }\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "EmployeeDEDataSetRuntime",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/EmployeeDEDataSetRuntime.json",
    "memo" : "获取部门下所有人员",
    "name" : "EmployeeDEDataSetRuntime",
    "pluginCode" : "EmployeeDEDataSetRuntime",
    "pluginType" : "DEDATASET",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.EmployeeDEDataSetRuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\nimport net.ibizsys.central.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.dataentity.ds.DEDataSetRuntimeBase\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.central.util.ISearchContext\r\nimport net.ibizsys.central.util.ISearchContextDTO\r\nimport net.ibizsys.model.dataentity.ds.IPSDEDataSet\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.data.domain.Pageable\r\n\r\nclass EmployeeDEDataSetRuntime extends DEDataSetRuntimeBase {\r\n\r\n    @Override\r\n    protected Object onFetch(ISearchContext iSearchContext) throws Throwable {\r\n        ISearchContextDTO context = (ISearchContextDTO) iSearchContext\r\n\r\n        // 1. 获取部门及其所有子部门ID\r\n        def rootDeptId = context.get(\"n_dept_id_eq\");\r\n        if (!rootDeptId){\r\n            return new CustomPageImpl<IEntityDTO>([], context.getPageable(), 0, 0)\r\n        }\r\n        List<String> allDeptIds = getAllSubDeptIds(rootDeptId)\r\n\r\n        // 2. 构建人员查询条件\r\n        IDataEntityRuntime employeeRuntime = this.getSystemRuntime().getDataEntityRuntime(\"employee\");\r\n        ISearchContextDTO employeeSearchContextDTO = employeeRuntime.createSearchContext();\r\n        employeeSearchContextDTO.eq('status', 1)\r\n        def deptStr = allDeptIds ? allDeptIds.join(\",\") : \"\"\r\n\r\n        employeeSearchContextDTO.in('dept_id', deptStr)\r\n        employeeSearchContextDTO.setPageable(context.getPageable())\r\n        Object[] args = [employeeSearchContextDTO];\r\n\r\n        // 3. 执行查询\r\n        Page<?> rawPage = (Page<?>) employeeRuntime.fetchDataSet(\"user\", null, args);\r\n\r\n        // 4. 转换结果\r\n        return employeeRuntime.getEntityDTOPage(\r\n                rawPage,\r\n                employeeRuntime.getDefaultPSDEDataSet(),\r\n                employeeSearchContextDTO.getPageable()\r\n        )\r\n    }\r\n\r\n    // 递归获取所有子部门ID（含自身）\r\n    private List<String> getAllSubDeptIds(String rootDeptId) {\r\n        def deptRuntime = getSystemRuntime().getDataEntityRuntime(\"department\")\r\n        ISearchContextDTO searchContextDTO = deptRuntime.createSearchContext();\r\n        searchContextDTO.count(false).limit(10000)\r\n        //获取所有部门\r\n        IPSDEDataSet iPSDEDataSet = deptRuntime.getPSDEDataSet(\"dept\");\r\n        List<IEntityDTO> allDepts = deptRuntime.selectDataSet(iPSDEDataSet, searchContextDTO);\r\n\r\n        List<String> result = new ArrayList<>()\r\n        collectSubDeptIds(rootDeptId, allDepts, result)\r\n        return result\r\n    }\r\n\r\n    private void collectSubDeptIds(String deptId, List<IEntityDTO> allDepts, List<String> result) {\r\n        // 先添加当前部门\r\n        result.add(deptId)\r\n        // 查找所有子部门\r\n        List<IEntityDTO> children = allDepts.findAll { it.get(\"parent_id\") == deptId }\r\n        // 递归处理子部门\r\n        children.each { child ->\r\n            collectSubDeptIds(child.id, allDepts, result)\r\n        }\r\n    }\r\n    \r\n\r\n    @Override\r\n    public boolean isValid(Object[] args) {\r\n        return true;\r\n    }\r\n\r\n    \r\n    class CustomPageImpl<T> extends net.ibizsys.central.util.PageImpl<T> {\r\n        private final long total;\r\n\r\n        public CustomPageImpl(List<T> content, Pageable pageable, long total, int totalPages) {\r\n            super(content, pageable, total, totalPages);\r\n            this.total = total;\r\n        }\r\n\r\n        @Override\r\n        long getTotalElements() {\r\n            return total;\r\n        }\r\n    }\r\n\r\n\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "GLOBAL_WEBCLIENT",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/GLOBAL_WEBCLIENT.json",
    "name" : "HttpsWebFluxClient",
    "pluginCode" : "GLOBAL_WEBCLIENT",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.client.HttpsWebFluxClient",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.client\r\n\r\nimport io.netty.handler.ssl.SslContext\r\nimport io.netty.handler.ssl.SslContextBuilder\r\nimport io.netty.handler.ssl.util.InsecureTrustManagerFactory\r\nimport net.ibizsys.central.plugin.spring.service.client.WebFluxClient\r\nimport net.ibizsys.central.service.client.WebClientBase\r\nimport org.apache.commons.logging.Log\r\nimport org.apache.commons.logging.LogFactory\r\nimport org.springframework.http.client.reactive.ReactorClientHttpConnector\r\nimport org.springframework.http.codec.json.Jackson2JsonDecoder\r\nimport org.springframework.http.codec.json.Jackson2JsonEncoder\r\nimport org.springframework.util.StringUtils\r\nimport org.springframework.web.reactive.function.client.WebClient\r\nimport reactor.netty.http.client.HttpClient\r\n\r\n/**\r\n * https时忽略 ssl \r\n */\r\nclass HttpsWebFluxClient extends WebFluxClient {\r\n\r\n    private final Log log = LogFactory.getLog(HttpsWebFluxClient.class)\r\n    private WebClient webClient = null;\r\n    private WebClient webClient2 = null;\r\n\r\n    @Override\r\n    protected WebClient getWebClient(String strUri) {\r\n\r\n        if (StringUtils.hasLength(this.getServiceUrl())) {\r\n            if (this.webClient == null) {\r\n                if (this.getServiceUrl().indexOf(\"lb://\") == 0) {\r\n                    this.webClient = WebClient.builder().codecs({ configurer ->\r\n                        configurer.defaultCodecs().jackson2JsonDecoder(new Jackson2JsonDecoder(WebClientBase.MAPPER));\r\n                        configurer.defaultCodecs().jackson2JsonEncoder(new Jackson2JsonEncoder(WebClientBase.OUTMAPPER));\r\n                        configurer.defaultCodecs().maxInMemorySize(getMaxInMemorySize());\r\n                    }).filter(getExchangeFilterFunction()).baseUrl(this.getServiceUrl()).build();\r\n                } else {\r\n\r\n                    SslContext sslContext = SslContextBuilder\r\n                            .forClient()\r\n                            .trustManager(InsecureTrustManagerFactory.INSTANCE)\r\n                            .build();\r\n\r\n                    HttpClient httpClient = HttpClient.create().secure { t -> t.sslContext(sslContext) };\r\n\r\n                    this.webClient = WebClient.builder().codecs({ configurer ->\r\n                        configurer.defaultCodecs().jackson2JsonDecoder(new Jackson2JsonDecoder(WebClientBase.MAPPER));\r\n                        configurer.defaultCodecs().jackson2JsonEncoder(new Jackson2JsonEncoder(WebClientBase.OUTMAPPER));\r\n                        configurer.defaultCodecs().maxInMemorySize(getMaxInMemorySize());\r\n                    }).baseUrl(this.getServiceUrl()).clientConnector(new ReactorClientHttpConnector(httpClient)).build();\r\n                }\r\n            }\r\n            return this.webClient;\r\n        } else if (StringUtils.hasLength(strUri) && strUri.indexOf(\"lb://\") == 0) {\r\n            if (this.webClient == null) {\r\n                this.webClient = WebClient.builder().codecs({ configurer ->\r\n                    configurer.defaultCodecs().jackson2JsonDecoder(new Jackson2JsonDecoder(WebClientBase.MAPPER));\r\n                    configurer.defaultCodecs().jackson2JsonEncoder(new Jackson2JsonEncoder(WebClientBase.OUTMAPPER));\r\n                    configurer.defaultCodecs().maxInMemorySize(getMaxInMemorySize());\r\n                }).filter(getExchangeFilterFunction()).build();\r\n            }\r\n            return this.webClient;\r\n        } else {\r\n            if (this.webClient2 == null) {\r\n\r\n                SslContext sslContext = SslContextBuilder\r\n                        .forClient()\r\n                        .trustManager(InsecureTrustManagerFactory.INSTANCE)\r\n                        .build();\r\n\r\n                HttpClient httpClient = HttpClient.create().secure { t -> t.sslContext(sslContext) };\r\n\r\n                this.webClient2 = WebClient.builder().codecs({ configurer ->\r\n                    configurer.defaultCodecs().jackson2JsonDecoder(new Jackson2JsonDecoder(WebClientBase.MAPPER));\r\n                    configurer.defaultCodecs().jackson2JsonEncoder(new Jackson2JsonEncoder(WebClientBase.OUTMAPPER));\r\n                    configurer.defaultCodecs().maxInMemorySize(getMaxInMemorySize());\r\n                }).clientConnector(new ReactorClientHttpConnector(httpClient)).build();\r\n            }\r\n            return this.webClient2;\r\n        }\r\n    }\r\n}\r\n",
    "runtimeObject" : true
  }, {
    "codeName" : "JudgingDEActionRuntime",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/JudgingDEActionRuntime.json",
    "memo" : "判断人员是否已存在",
    "name" : "JudgingDEActionRuntime",
    "pluginCode" : "JudgingDEActionRuntime",
    "pluginType" : "DEACTION",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.JudgingDEActionRuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\nimport net.ibizsys.central.cloud.core.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.database.ISysDBSchemeRuntime\r\nimport net.ibizsys.central.dataentity.action.DEActionRuntimeBase\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.central.util.ISearchContextDTO\r\nimport net.ibizsys.model.dataentity.ds.IPSDEDataSet\r\nimport net.ibizsys.runtime.util.JsonUtils\r\nimport org.springframework.util.ObjectUtils\r\n\r\nclass JudgingDEActionRuntime extends DEActionRuntimeBase {\r\n\r\n\r\n    @Override\r\n    protected Object onExecute(IEntityDTO iEntityDTO) throws Throwable {\r\n        IEntityDTO ret = this.getDataEntityRuntime().createEntity();\r\n        // 初始化运行时对象\r\n        ISysDBSchemeRuntime dbSchema = this.getDataEntityRuntime().getSysDBSchemeRuntimeMust()\r\n        IDataEntityRuntime shiftMemberRuntime = systemRuntime.getDataEntityRuntime(\"attendance_group_shift_member\")\r\n\r\n        def cur_members = JsonUtils.asList(iEntityDTO.get(\"cur_members\"))\r\n        def other_members = JsonUtils.asList(iEntityDTO.get(\"other_members\"))\r\n        def summaryResult = new ArrayList()\r\n        def groupByResult = new ArrayList()\r\n        if (!ObjectUtils.isEmpty(cur_members)) {\r\n            //校验所选人/部门是否在其他生效规则中\r\n            for (cur_member in cur_members) {\r\n\r\n                def _param = []\r\n                _param.add(iEntityDTO.get(\"attendance_rule\") ?: \"\")\r\n                _param.add(cur_member.get(\"id\"))\r\n\r\n                def sql = \"select g.name, g.rule_id, r.name as rule_name from attendance_group_shift_member g left join attendance_rule r on rule_id = r.ID where rule_id != ? and user_id = ? and exists ( select 1 from attendance_activate_rule rule where rule.id = g.rule_id)\";\r\n                List<Map<String, Object>> memberResult = dbSchema.executeSelectSQL(sql, _param) as List<Map<String, Object>>;\r\n                if (!ObjectUtils.isEmpty(memberResult)) {\r\n                    summaryResult.addAll(memberResult)\r\n                }\r\n            }\r\n            if (!ObjectUtils.isEmpty(summaryResult)) {\r\n                def grouped = summaryResult.groupBy { it.RULE_ID }\r\n                grouped.each { ruleId, items ->\r\n                    IEntityDTO temp = shiftMemberRuntime.createEntity();\r\n                    def names = items.collect { it.get(\"NAME\") }.findAll { it != null }\r\n                    temp.set(\"name\", names.join('、'))\r\n                    temp.set(\"rule_id\", ruleId)\r\n                    temp.set(\"rule_name\", items[0].get(\"RULE_NAME\"))\r\n                    groupByResult.add(temp)\r\n                }\r\n                def namesWithRules = groupByResult.collect { item ->\r\n                    \"${item.name}已在考勤规则${item.get(\"rule_name\")}内\"\r\n                }\r\n                // 拼接最终消息\r\n                def msg = \"${namesWithRules.join('、')},是否将其移入当前考勤规则？\"\r\n                ret.set(\"msg\", msg.toString())\r\n                ret.set(\"isAdd\", true)\r\n                return ret;\r\n            }\r\n\r\n            if (!ObjectUtils.isEmpty(other_members)) {\r\n                //新增组间冲突校验逻辑\r\n                def groups = JsonUtils.asList(iEntityDTO.get(\"groups\"))\r\n                def deptRuntime = getSystemRuntime().getDataEntityRuntime(\"department\")\r\n                ISearchContextDTO searchContextDTO = deptRuntime.createSearchContext();\r\n                searchContextDTO.count(false).limit(10000)\r\n                //获取所有部门\r\n                IPSDEDataSet iPSDEDataSet = deptRuntime.getPSDEDataSet(\"dept\");\r\n                List<IEntityDTO> deptList = deptRuntime.selectDataSet(iPSDEDataSet, searchContextDTO);\r\n                // 创建快速查找集合\r\n                def otherIds = other_members.collect { it.get(\"user_id\") } as Set\r\n                def conflictGroups = new HashSet()\r\n                cur_members.each { cur_member ->\r\n                    def parentId = cur_member.get(\"parent_id\")\r\n                    // 1、确保所选的人/部门不在其他组部门下\r\n                    if (parentId) {\r\n                        def currentId = parentId\r\n                        boolean conflictFound = false\r\n                        // 逐级向上查找，找到第一个冲突即停止\r\n                        while (currentId && !conflictFound) {\r\n                            // 获取部门信息\r\n                            def dept = deptList.find { it.id == currentId }\r\n                            if (dept && otherIds.contains(dept.id)) {\r\n                                // 记录冲突组\r\n                                def member = other_members.find { it.user_id == dept.id }\r\n                                def group = groups.find { it.id == member.get(\"group_id\") }\r\n                                conflictGroups.add(group?.get(\"order_num\"))\r\n                                conflictFound = true\r\n                            } else {\r\n                                // 继续向上查找\r\n                                currentId = dept?.get(\"parent_id\")\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                    // 2、确保所选的部门下没有其他组人员/部门\r\n                    if (cur_member.get(\"type\") == \"dept\") {\r\n                        def rootDeptId = cur_member.get(\"id\")\r\n\r\n                        // 递归获取所有子部门ID（含自身）\r\n                        List<String> allSubDeptIds = [rootDeptId]\r\n                        def subDeptIds = getSubDeptIds(rootDeptId, deptList)\r\n                        allSubDeptIds.addAll(subDeptIds)\r\n\r\n                        // 检查其他组成员是否在这些部门中\r\n                        other_members.each { member ->\r\n                            def userId = member.get(\"parent_id\")\r\n                            if (allSubDeptIds.contains(userId)) {\r\n                                def group = groups.find { it.id == member.get(\"group_id\") }\r\n                                conflictGroups.add(group?.get(\"order_num\"))\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                }\r\n\r\n                // 生成提示信息\r\n                if (!conflictGroups.isEmpty()) {\r\n                    def msg = \"与第${conflictGroups.join('、')}组考勤人员有重合，请修改考勤人员？\"\r\n                    ret.set(\"msg\", msg)\r\n                    ret.set(\"isAdd\", false)\r\n                    return ret;\r\n                }\r\n\r\n            }\r\n        }\r\n        return ret;\r\n\r\n    }\r\n\r\n    // 辅助方法：递归获取子部门ID\r\n    private List<String> getSubDeptIds(String deptId, List<IEntityDTO> deptList) {\r\n        List<String> subDepts = []\r\n        deptList.each { dept ->\r\n            if (dept.get(\"parent_id\") == deptId) {\r\n                subDepts.add(dept.id)\r\n                subDepts.addAll(getSubDeptIds(dept.id, deptList))\r\n            }\r\n        }\r\n        return subDepts\r\n    }\r\n\r\n\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "PersonalSummary",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/PersonalSummary.json",
    "memo" : "个人统计自定义导出",
    "name" : "PersonalSummaryPOIDEDataExportRuntimeEx",
    "pluginCode" : "PersonalSummary",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport.PersonalSummaryPOIDEDataExportRuntimeEx",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport\r\n\r\nimport groovy.transform.CompileStatic;\r\nimport net.ibizsys.central.plugin.poi.dataentity.dataexport.POIDEDataExportRuntime\r\n\r\nimport net.ibizsys.central.util.IEntityDTO;\r\nimport net.ibizsys.model.dataentity.dataexport.IPSDEDataExportItem\r\nimport net.ibizsys.runtime.security.UserContext\r\nimport org.apache.poi.ss.usermodel.Cell;\r\nimport org.apache.poi.ss.usermodel.Row;\r\nimport org.apache.poi.ss.usermodel.Sheet;\r\nimport org.apache.poi.ss.usermodel.Workbook;\r\nimport org.apache.poi.ss.util.CellRangeAddress;\r\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.util.MultiValueMap;\r\nimport org.springframework.util.ObjectUtils;\r\nimport java.text.SimpleDateFormat;\r\n\r\n@CompileStatic\r\nclass PersonalSummaryPOIDEDataExportRuntimeEx extends POIDEDataExportRuntime {\r\n\r\n    @Override\r\n    protected void onExportStream(Object objData, OutputStream outputStram) throws Throwable {\r\n        Workbook workbook = new XSSFWorkbook();\r\n        Throwable var4 = null;\r\n        try {\r\n            List<IPSDEDataExportItem> exportItems = this.getPSDEDataExport().getPSDEDataExportItems();\r\n\r\n            if (ObjectUtils.isEmpty(exportItems)) {\r\n                throw new Exception(\"未指定导出列\");\r\n            }\r\n            MultiValueMap<String, String> parameters = UserContext.getCurrent().getWebContext().getParameters();\r\n            // 基础信息\r\n            List<String> baseInfoList = convertStringToList(parameters.get(\"base_info\")?.toString())\r\n            // 出勤统计\r\n            List<String> attendanceList = convertStringToList(parameters.get(\"attendance\")?.toString())\r\n            // 异常统计\r\n            List<String> abnormalList = convertStringToList(parameters.get(\"abnormal\")?.toString())\r\n            // 请假统计\r\n            List<String> leaveList = convertStringToList(parameters.get(\"leave\")?.toString())\r\n            // 每日统计\r\n            String daily = parameters.get(\"daily\");\r\n            // 时间范围\r\n            List<String> dateRangeList = convertStringToList(parameters.get(\"date_range\")?.toString())\r\n            List<String> dateRangeWeekList = generateDateWeekRange(dateRangeList.get(0), dateRangeList.get(1));\r\n            Sheet sheet = workbook.createSheet()\r\n            // 创建动态表头\r\n            createHeaders(sheet, baseInfoList, attendanceList, abnormalList,\r\n                    leaveList, daily, dateRangeWeekList, exportItems);\r\n            // 获取动态属性列\r\n            Row headerRow = sheet.getRow(2);\r\n            List<String> propertyNames = getPropertyNames(headerRow);\r\n            if (daily == \"[daily]\") {\r\n                // 添加日历属性名称\r\n                List<String> dateRange = generateDateRange(dateRangeList.get(0), dateRangeList.get(1));\r\n                propertyNames.addAll(dateRange);\r\n            }\r\n            // 创建Excel表格数据\r\n            List<IEntityDTO> data = ((Page) objData).getContent();\r\n\r\n            // 平铺日历数据\r\n            SimpleDateFormat sdf = new SimpleDateFormat(\"HH:mm:ss\");\r\n            for (Object item : data) {\r\n                IEntityDTO it = item as IEntityDTO;\r\n                if (!ObjectUtils.isEmpty(it.get(\"attendance_data\"))) {\r\n                    Map<String, Object> attendanceData = it.get(\"attendance_data\") as Map<String, Object>;\r\n                    Set<String> keys = attendanceData.keySet();\r\n                    for (String key : keys) {\r\n                        IEntityDTO record = attendanceData.get(key) as IEntityDTO;\r\n                        if (!ObjectUtils.isEmpty(record) && !ObjectUtils.isEmpty(record.get(\"details\"))) {\r\n                            List<IEntityDTO> details = record.get(\"details\") as List<IEntityDTO>;\r\n                            String checkinTime = \"\";\r\n                            for (IEntityDTO item2 : details) {\r\n                                if (item2.get(\"checkin_result\") == \"NORMAL\") {\r\n                                    if (!ObjectUtils.isEmpty(item2.get(\"checkin_time\"))) {\r\n                                        checkinTime += sdf.format(item2.get(\"checkin_time\")) + \"\\n\";\r\n                                    }\r\n                                }\r\n                            }\r\n                            it.set(key, checkinTime);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            int startRowIndex = 3; // 数据从第4行开始（0-based索引）\r\n            fillDataRows(sheet, data, propertyNames, startRowIndex);\r\n            // 删除标识行\r\n            deleteRowSimple(sheet, 2)\r\n            workbook.write(outputStram);\r\n        } catch (Throwable var25) {\r\n            var4 = var25;\r\n            throw var25;\r\n        } finally {\r\n            if (workbook != null) {\r\n                if (var4 != null) {\r\n                    try {\r\n                        workbook.close();\r\n                    } catch (Throwable var24) {\r\n                        var4.addSuppressed(var24);\r\n                    }\r\n                } else {\r\n                    workbook.close();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // 字符串转List方法\r\n    private static List<String> convertStringToList(String input) {\r\n        if (input == \"[]\" || input == \"[null]\" || input == \"\" || input == null || input.trim().isEmpty()) {\r\n            return new ArrayList<>();\r\n        }\r\n        // 去除方括号并按逗号分割\r\n        String cleaned = input.substring(1, input.length() - 1).trim();\r\n        String[] parts = cleaned.split(\",\");\r\n\r\n        List<String> result = new ArrayList<>();\r\n        for (String part : parts) {\r\n            if (!\"name\".equals(part.trim())) {\r\n                result.add(part.trim());\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // 创建复杂的列头结构\r\n    private static void createHeaders(Sheet sheet, List<String> baseInfoList,\r\n                                      List<String> attendanceList,\r\n                                      List<String> abnormalList,\r\n                                      List<String> leaveList,\r\n                                      String daily,\r\n                                      List<String> dateRangeList,\r\n                                      List<IPSDEDataExportItem> exportItems) {\r\n        // 创建两行表头\r\n        Row row0 = sheet.createRow(0);\r\n        Row row1 = sheet.createRow(1);\r\n        Row row2 = sheet.createRow(2);\r\n        int colIndex = 0;\r\n        // 基本信息分组\r\n        if (baseInfoList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"基本信息\", baseInfoList, exportItems);\r\n        }\r\n        // 出勤统计分组\r\n        if (attendanceList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"出勤统计\", attendanceList, exportItems);\r\n        }\r\n        // 异常统计分组\r\n        if (abnormalList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"异常统计\", abnormalList, exportItems);\r\n        }\r\n        // 请假统计分组\r\n        if (leaveList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"请假统计\", leaveList, exportItems);\r\n        }\r\n        if (daily == \"[daily]\") {\r\n            // 每日统计分组\r\n            if (dateRangeList.size() > 0) {\r\n                colIndex = createDateRangeHeader(sheet, row0, row1, row2, colIndex,\r\n                        \"每日统计\", dateRangeList);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 安全合并单元格（防止无效合并区域）\r\n    private static void addSafeMergedRegion(Sheet sheet, int firstRow, int lastRow,\r\n                                            int firstCol, int lastCol) {\r\n        // 确保是有效的合并区域（至少包含两个单元格）\r\n        int rowSpan = lastRow - firstRow + 1;\r\n        int colSpan = lastCol - firstCol + 1;\r\n\r\n        if (rowSpan >= 2 || colSpan >= 2) {\r\n            sheet.addMergedRegion(new CellRangeAddress(firstRow, lastRow, firstCol, lastCol));\r\n        }\r\n    }\r\n\r\n    private static int createDateRangeHeader(Sheet sheet, Row row0, Row row1, Row row2,\r\n                                         int startCol, String groupName,\r\n                                         List<String> headers) {\r\n        if (headers.isEmpty()) {\r\n            return startCol;\r\n        }\r\n        int endCol = startCol + headers.size() - 1;\r\n        // 创建分组标题单元格（存在分组列就创建）\r\n        Cell groupCell = row0.createCell(startCol);\r\n        groupCell.setCellValue(groupName);\r\n        // 处理多列情况\r\n        if (headers.size() > 1) {\r\n            // 横向合并分组标题\r\n            sheet.addMergedRegion(new CellRangeAddress(0, 0, startCol, endCol));\r\n            // 创建分组内的列头\r\n            for (int i = 0; i < headers.size(); i++) {\r\n                Cell headerCell = row1.createCell(startCol + i);\r\n                Cell headerCell2 = row2.createCell(startCol + i);\r\n                String header = headers.get(i).substring(0, 10);\r\n                String headerName = headers.get(i);\r\n                headerCell.setCellValue(headerName);\r\n                headerCell2.setCellValue(header)\r\n            }\r\n        }\r\n        // 处理单列情况\r\n        else if (headers.size() == 1) {\r\n            // 1. 分组标题显示在第一行（不合并）\r\n            // 2. 列头显示在第二行\r\n            // 创建列头单元格\r\n            Cell headerCell = row1.createCell(startCol);\r\n            String header = headers.get(0).substring(0, 10);\r\n            String headerName = headers.get(0);\r\n            headerCell.setCellValue(headerName);\r\n            Cell headerCell2 = row2.createCell(startCol);\r\n            headerCell2.setCellValue(header)\r\n        }\r\n        return endCol + 1;\r\n    }\r\n\r\n    // 创建分组列头（修复单列问题）\r\n    private static int createGroupHeader(Sheet sheet, Row row0, Row row1, Row row2,\r\n                                         int startCol, String groupName,\r\n                                         List<String> headers, List<IPSDEDataExportItem> exportItems) {\r\n        if (headers.isEmpty()) {\r\n            return startCol;\r\n        }\r\n        int endCol = startCol + headers.size() - 1;\r\n        // 创建分组标题单元格（存在分组列就创建）\r\n        Cell groupCell = row0.createCell(startCol);\r\n        groupCell.setCellValue(groupName);\r\n        // 处理多列情况\r\n        if (headers.size() > 1) {\r\n            // 横向合并分组标题\r\n            sheet.addMergedRegion(new CellRangeAddress(0, 0, startCol, endCol));\r\n            // 创建分组内的列头\r\n            for (int i = 0; i < headers.size(); i++) {\r\n                Cell headerCell = row1.createCell(startCol + i);\r\n                Cell headerCell2 = row2.createCell(startCol + i);\r\n                String header = headers.get(i);\r\n                String headerName = getHeaderName(header, exportItems)\r\n                headerCell.setCellValue(headerName);\r\n                headerCell2.setCellValue(header)\r\n            }\r\n        }\r\n        // 处理单列情况\r\n        else if (headers.size() == 1) {\r\n            // 1. 分组标题显示在第一行（不合并）\r\n            // 2. 列头显示在第二行\r\n            // 创建列头单元格\r\n            Cell headerCell = row1.createCell(startCol);\r\n            String header = headers.get(0);\r\n            String headerName = getHeaderName(header, exportItems)\r\n            headerCell.setCellValue(headerName);\r\n            Cell headerCell2 = row2.createCell(startCol);\r\n            headerCell2.setCellValue(header)\r\n        }\r\n        return endCol + 1;\r\n    }\r\n\r\n    private static String getHeaderName(String header, List<IPSDEDataExportItem> exportItems) {\r\n        String headerName = \"\"\r\n        for (IPSDEDataExportItem item : exportItems) {\r\n            if (item.getName().equals(header)) {\r\n                headerName = item.getCaption()\r\n            }\r\n        }\r\n        return headerName\r\n    }\r\n\r\n    // 填充数据行\r\n    private void fillDataRows(Sheet sheet, List<IEntityDTO> data, List<String> propertyNames, int startRowIndex) {\r\n        if (data == null || data.isEmpty()) return;\r\n        for (int i = 0; i < data.size(); i++) {\r\n            IEntityDTO entity = data.get(i);\r\n            // 创建每行数据\r\n            Row dataRow = sheet.createRow(startRowIndex + i);\r\n            // 填充每个单元格\r\n            for (int col = 0; col < propertyNames.size(); col++) {\r\n                String propertyName = propertyNames.get(col);\r\n                String propertyValue = entity.get(propertyName);\r\n                Cell cell = dataRow.createCell(col);\r\n                // 设置单元格值\r\n                cell.setCellValue(propertyValue);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 获取第三行的属性名列表\r\n    private static List<String> getPropertyNames(Row headerRow) {\r\n        List<String> propertyNames = new ArrayList<>();\r\n        int lastCellNum = headerRow.getLastCellNum();\r\n\r\n        for (int i = 0; i < lastCellNum; i++) {\r\n            Cell cell = headerRow.getCell(i);\r\n            if (cell != null) {\r\n                propertyNames.add(cell.getStringCellValue());\r\n            } else {\r\n                propertyNames.add(\"\"); // 空值处理\r\n            }\r\n        }\r\n        return propertyNames;\r\n    }\r\n\r\n    private static void deleteRowSimple(Sheet sheet, int rowIndex) {\r\n        int lastRowNum = sheet.getLastRowNum();\r\n        // 验证行索引\r\n        if (rowIndex < 0 || rowIndex > lastRowNum) {\r\n            throw new IllegalArgumentException(\"行索引超出范围: \" + rowIndex);\r\n        }\r\n        // 如果是最后一行，直接删除\r\n        if (rowIndex == lastRowNum) {\r\n            Row row = sheet.getRow(rowIndex);\r\n            if (row != null) {\r\n                sheet.removeRow(row);\r\n            }\r\n        }\r\n        // 如果是中间行，向上移动后续行\r\n        else {\r\n            sheet.shiftRows(rowIndex + 1, lastRowNum, -1);\r\n        }\r\n    }\r\n\r\n    private static List<String> generateDateWeekRange(String startDate, String endDate) throws Exception {\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n        SimpleDateFormat dayOfWeekFormat = new SimpleDateFormat(\"EEEE\", Locale.CHINA);\r\n\r\n        Date start = sdf.parse(startDate);\r\n        Date end = sdf.parse(endDate);\r\n\r\n        List<String> dateArray = new ArrayList<>();\r\n\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.setTime(start);\r\n\r\n        while (!calendar.getTime().after(end)) {\r\n            String formattedDate = sdf.format(calendar.getTime()) + \" \" + dayOfWeekFormat.format(calendar.getTime());\r\n            dateArray.add(formattedDate);\r\n            calendar.add(Calendar.DATE, 1);\r\n        }\r\n\r\n        return dateArray;\r\n    }\r\n\r\n    private static List<String> generateDateRange(String startDate, String endDate) throws Exception {\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n\r\n        Date start = sdf.parse(startDate);\r\n        Date end = sdf.parse(endDate);\r\n\r\n        List<String> dateArray = new ArrayList<>();\r\n\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.setTime(start);\r\n\r\n        while (!calendar.getTime().after(end)) {\r\n            dateArray.add(sdf.format(calendar.getTime()));\r\n            calendar.add(Calendar.DATE, 1);\r\n        }\r\n\r\n        return dateArray;\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "Schedule",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/Schedule.json",
    "memo" : "排班视图自定义导出",
    "name" : "SchedulePOIDEDataExportRuntimeEx",
    "pluginCode" : "Schedule",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport.SchedulePOIDEDataExportRuntimeEx",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport\r\n\r\nimport groovy.transform.CompileStatic;\r\nimport net.ibizsys.central.plugin.poi.dataentity.dataexport.POIDEDataExportRuntime\r\n\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.model.dataentity.dataexport.IPSDEDataExportItem\r\nimport net.ibizsys.runtime.security.UserContext\r\nimport org.apache.poi.ss.usermodel.Cell;\r\nimport org.apache.poi.ss.usermodel.Row;\r\nimport org.apache.poi.ss.usermodel.Sheet;\r\nimport org.apache.poi.ss.usermodel.Workbook;\r\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.util.MultiValueMap\r\nimport org.springframework.util.ObjectUtils\r\n\r\n\r\n\r\n@CompileStatic\r\nclass SchedulePOIDEDataExportRuntimeEx extends POIDEDataExportRuntime {\r\n\r\n    @Override\r\n    protected void onExportStream(Object objData, OutputStream outputStram) throws Throwable {\r\n        Workbook workbook = new XSSFWorkbook();\r\n        Throwable var4 = null;\r\n        try {\r\n            List<IPSDEDataExportItem> exportItems = this.getPSDEDataExport().getPSDEDataExportItems();\r\n            if (ObjectUtils.isEmpty(exportItems)) {\r\n                throw new Exception(\"未指定导出列\");\r\n            }\r\n\r\n            MultiValueMap<String, String> parameters = UserContext.getCurrent().getWebContext().getParameters();\r\n            // 月份\r\n            String chooseMonth = parameters.get(\"choose_month\")?.toString();\r\n            chooseMonth = chooseMonth.substring(1, chooseMonth.length() - 1);\r\n            // 获取当月的每日数据\r\n            List<String> monthlyData = getMonthlyData(chooseMonth);\r\n\r\n            Sheet sheet = workbook.createSheet();\r\n            Row row = sheet.createRow(0);\r\n            \r\n            for(int i = 0; i < exportItems.size(); ++i) {\r\n                IPSDEDataExportItem iPSDEDataExportItem = (IPSDEDataExportItem)exportItems.get(i);\r\n                Cell cell0 = row.createCell(i);\r\n                cell0.setCellValue(iPSDEDataExportItem.getCaption());\r\n            }\r\n\r\n            // 新建日历表格头\r\n            for(int i = 0; i < monthlyData.size(); ++i) {\r\n                Cell cell0 = row.createCell(i + exportItems.size());\r\n                cell0.setCellValue(monthlyData[i]);\r\n            }\r\n\r\n            List<IEntityDTO> data = ((Page)objData).getContent();\r\n            Map<String, List<IEntityDTO>> groupedMembers = groupMembersById(data);\r\n            int i = 0;\r\n            for(String key : groupedMembers.keySet()) {\r\n                ++i;\r\n                List<IEntityDTO> items = groupedMembers.get(key).sort { it.get(\"checkin_date\") }\r\n                Row dataRow = sheet.createRow(i);\r\n                for(int k = 0; k < exportItems.size(); ++k) {\r\n                    IPSDEDataExportItem iPSDEDataExportItem = (IPSDEDataExportItem)exportItems.get(k);\r\n                    Object objValue = items[0].get(iPSDEDataExportItem.getName());\r\n                    Cell cell0 = dataRow.createCell(k);\r\n                    if (objValue != null) {\r\n                        cell0.setCellValue(this.convertValue(iPSDEDataExportItem, objValue));\r\n                    }\r\n                }\r\n                // 填充日历数据\r\n                for(int k = 0; k < monthlyData.size(); ++k) {\r\n                    IEntityDTO item = items[k];\r\n                    // 1、shifts为空,当天无考勤数据，显示“/”\r\n                    if (item == null || ObjectUtils.isEmpty(item.get(\"shifts\"))) {\r\n                        Cell cell0 = dataRow.createCell(k + exportItems.size());\r\n                        cell0.setCellValue(\"/\");\r\n                        continue;\r\n                    }\r\n                    // 2、规则类型是否为免考勤，免考勤的话显示“免考勤”\r\n                    if (!ObjectUtils.isEmpty(item.get(\"rule_data\"))) {\r\n                        IEntityDTO ruleData = item.get(\"rule_data\") as IEntityDTO;\r\n                        if (ruleData.get(\"schedule_type\") == \"no_required\") {\r\n                            Cell cell0 = dataRow.createCell(k + exportItems.size());\r\n                            cell0.setCellValue(\"免考勤\");\r\n                            continue;\r\n                        }\r\n                    }\r\n                    // 3、规则类型是否为自由班，自由班的话显示\"/\"\r\n                    if (!ObjectUtils.isEmpty(item.get(\"rule_data\"))) {\r\n                        IEntityDTO ruleData = item.get(\"rule_data\") as IEntityDTO;\r\n                        if (ruleData.get(\"schedule_type\") == \"free\") {\r\n                            Cell cell0 = dataRow.createCell(k + exportItems.size());\r\n                            cell0.setCellValue(\"/\");\r\n                            continue;\r\n                        }\r\n                    }\r\n                    // 4、判断是否工作日\r\n                    if (item.get(\"workday\") == 0 || ObjectUtils.isEmpty(item.get(\"shift_data\"))) {\r\n                        Cell cell0 = dataRow.createCell(k + exportItems.size());\r\n                        cell0.setCellValue(\"休息\");\r\n                    } else {\r\n                        if (!ObjectUtils.isEmpty(item.get(\"shift_data\"))) {\r\n                            IEntityDTO shiftData = item.get(\"shift_data\") as IEntityDTO;\r\n                            Cell cell0 = dataRow.createCell(k + exportItems.size());\r\n                            cell0.setCellValue(shiftData.get(\"name\").toString());\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            workbook.write(outputStram);\r\n        } catch (Throwable var25) {\r\n            var4 = var25;\r\n            throw var25;\r\n        } finally {\r\n            if (workbook != null) {\r\n                if (var4 != null) {\r\n                    try {\r\n                        workbook.close();\r\n                    } catch (Throwable var24) {\r\n                        var4.addSuppressed(var24);\r\n                    }\r\n                } else {\r\n                    workbook.close();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private static List<String> getMonthlyData(String yearMonth) {\r\n        // 分割输入的字符串\r\n        String[] parts = yearMonth.split(\"-\");\r\n        int year = Integer.parseInt(parts[0]);\r\n        int month = Integer.parseInt(parts[1]);\r\n        // 创建一个日历实例，并设置为该月的第一天\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.set(year, month - 1, 1);  // 月份是从0开始的，所以减去1\r\n        // 获取该月的天数\r\n        int daysInMonth = calendar.getActualMaximum(Calendar.DAY_OF_MONTH);\r\n        // 创建一个字符串列表来存储结果\r\n        List<String> dailyData = new ArrayList<>();\r\n        // 遍历每一天\r\n        for (int day = 1; day <= daysInMonth; day++) {\r\n            calendar.set(year, month - 1, day);\r\n            // 获取星期几（1=星期日，2=星期一，...，7=星期六）\r\n            int dayOfWeek = calendar.get(Calendar.DAY_OF_WEEK);\r\n            // 根据星期几返回中文的星期\r\n            String weekday = \"\";\r\n            switch (dayOfWeek) {\r\n                case Calendar.SUNDAY:\r\n                    weekday = \"日\"; break;\r\n                case Calendar.MONDAY:\r\n                    weekday = \"一\"; break;\r\n                case Calendar.TUESDAY:\r\n                    weekday = \"二\"; break;\r\n                case Calendar.WEDNESDAY:\r\n                    weekday = \"三\"; break;\r\n                case Calendar.THURSDAY:\r\n                    weekday = \"四\"; break;\r\n                case Calendar.FRIDAY:\r\n                    weekday = \"五\"; break;\r\n                case Calendar.SATURDAY:\r\n                    weekday = \"六\"; break;\r\n            }\r\n            // 生成格式并加入列表\r\n            dailyData.add(day + weekday);\r\n        }\r\n        return dailyData;  // 返回生成的数据列表\r\n    }\r\n\r\n    private static Map<String, List<IEntityDTO>> groupMembersById(List<IEntityDTO> members) {\r\n        Map<String, List<IEntityDTO>> groupedMembers = new HashMap<>();\r\n        // 遍历成员列表\r\n        for (IEntityDTO member : members) {\r\n            String memberId = member.get(\"member_id\");\r\n            // 使用 getOrDefault 进行获取或创建新列表\r\n            List<IEntityDTO> memberList = groupedMembers.getOrDefault(memberId, new ArrayList<>());\r\n            memberList.add(member);\r\n            groupedMembers.put(memberId, memberList); // 更新 map 中的列表\r\n        }\r\n        return groupedMembers; // 返回分组后的结果\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "ScheduleDEDataSetRuntime",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/ScheduleDEDataSetRuntime.json",
    "name" : "ScheduleDEDataSetRuntime",
    "pluginCode" : "ScheduleDEDataSetRuntime",
    "pluginType" : "DEDATASET",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.ScheduleDEDataSetRuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\n\r\nimport net.ibizsys.central.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.dataentity.ds.DEDataSetRuntimeBase\r\nimport net.ibizsys.central.util.ISearchContext\r\nimport net.ibizsys.model.dataentity.ds.IPSDEDataSet\r\nimport net.ibizsys.runtime.util.JsonUtils;\r\nimport org.springframework.data.domain.Page;\r\nimport net.ibizsys.central.util.IEntityDTO;\r\nimport net.ibizsys.central.util.ISearchContextDTO;\r\nimport org.springframework.data.domain.Pageable;\r\n\r\nclass ScheduleDEDataSetRuntime extends DEDataSetRuntimeBase {\r\n\r\n    @Override\r\n    protected Object onFetch(ISearchContext iSearchContext) throws Throwable {\r\n        ISearchContextDTO iSearchContextDTO = (ISearchContextDTO) iSearchContext;\r\n        // 获取employee实体\r\n        IDataEntityRuntime employeeRuntime = this.getSystemRuntime().getDataEntityRuntime(\"employee\");\r\n        ISearchContextDTO employeeSearchContextDTO = employeeRuntime.createSearchContext();\r\n        employeeSearchContextDTO.eq('status', 1);\r\n        def person_range = iSearchContextDTO.get(\"n_member_id_in\");\r\n\r\n        //解析特定条件\r\n        if (person_range != null && person_range != \"\") {\r\n            def depts = []\r\n            def persons = []\r\n            person_range.each { item ->\r\n                if (item.type == \"dept\") {\r\n                    depts.add(item.id)\r\n                } else {\r\n                    persons.add(item.id)\r\n                }\r\n            }\r\n            def deptStr = depts ? depts.join(\",\") : \"\"\r\n            def personStr = persons ? persons.join(\",\") : \"\"\r\n            if (deptStr != \"\" && personStr != \"\") {\r\n                employeeSearchContextDTO.and().or().in('dept_id', deptStr).in('id', personStr)\r\n            } else if (deptStr != \"\" && personStr == \"\") {\r\n                employeeSearchContextDTO.in('dept_id', deptStr)\r\n            } else {\r\n                employeeSearchContextDTO.in('id', personStr)\r\n            }\r\n        }\r\n\r\n        if (this.getDataEntityRuntime().getSystemPersistentAdapter() == null) {\r\n            throw new Exception(\"实体未提供系统持久化设置器\");\r\n        }\r\n\r\n        employeeSearchContextDTO.setPageable(iSearchContextDTO.getPageable());\r\n        employeeSearchContextDTO.sort(\"name,desc\");\r\n        Object[] args = [employeeSearchContextDTO];\r\n        Page<?> ret = (Page<?>) employeeRuntime.fetchDataSet(\"user\", null, args);\r\n        Page<IEntityDTO> page = employeeRuntime.getEntityDTOPage(ret, employeeRuntime.getDefaultPSDEDataSet(), employeeSearchContextDTO.getPageable());\r\n        return new CustomPageImpl<IEntityDTO>(fillScheduleData(page.getContent(), iSearchContextDTO), employeeSearchContextDTO.getPageable(), ret.getTotalElements(), page.getTotalPages());\r\n    }\r\n\r\n\r\n    @Override\r\n    public boolean isValid(Object[] args) {\r\n        return true;\r\n    }\r\n\r\n    protected List<IEntityDTO> fillScheduleData(List<IEntityDTO> dtos, ISearchContextDTO iSearchContextDTO) {\r\n        ISearchContextDTO attendance_scheduleSearchContextDTO = this.getDataEntityRuntime().createSearchContext();\r\n        List<IEntityDTO> lastScheduleDTOList = new ArrayList<IEntityDTO>();\r\n        List<String> persons = new ArrayList<String>();\r\n        // 查询排班\r\n        for (IEntityDTO dto : dtos) {\r\n            persons.add(dto.getString(\"id\", \"\"));\r\n        }\r\n        def personStr = persons ? persons.join(\",\") : \"\"\r\n\r\n        attendance_scheduleSearchContextDTO.count(false).limit(10000).in(\"member_id\", personStr);\r\n\r\n        // 考勤规则过滤\r\n        boolean inputRule = (iSearchContextDTO.get(\"n_rule_id_eq\") != null && iSearchContextDTO.get(\"n_rule_id_eq\") != \"\")\r\n        if (inputRule) {\r\n            attendance_scheduleSearchContextDTO.eq(\"rule_id\", iSearchContextDTO.get(\"n_rule_id_eq\"));\r\n        }\r\n        if (iSearchContextDTO.get(\"choose_month\") != null && iSearchContextDTO.get(\"choose_month\") != \"\") {\r\n            attendance_scheduleSearchContextDTO.custom(\" DATE_FORMAT(t1.CHECKIN_DATE, '%Y-%m') = '\"+ iSearchContextDTO.get(\"choose_month\") +\"'\")\r\n        }\r\n\r\n        IPSDEDataSet iPSDEDataSet = this.getDataEntityRuntime().getPSDEDataSet(\"Default\");\r\n        List<IEntityDTO> attendance_scheduleDTOList = this.getDataEntityRuntime().selectDataSet(iPSDEDataSet, attendance_scheduleSearchContextDTO)?:this.getDataEntityRuntime().createEntityList();\r\n        //固定排班、灵活打卡、大小周需区分\r\n        attendance_scheduleDTOList.forEach { s ->\r\n            if (s.get(\"schedule_type\").equals(\"fixed\") || s.get(\"schedule_type\").equals(\"flexible\") || s.get(\"schedule_type\").equals(\"alternate_week\")){\r\n                def shifts = s.get(\"shifts\")\r\n                def shift_data = JsonUtils.asMap(s.get(\"shift_data\"))\r\n                if (shifts && shift_data){\r\n                    def matchedShift = shifts.find { it.id == shift_data.get(\"id\") }\r\n                    s.set(\"shifts\", [matchedShift])\r\n                }\r\n                //休息\r\n                if(shifts && !shift_data){\r\n                    shifts.each {it ->\r\n                        def shift_data1 = JsonUtils.asMap(it.get(\"shift_data\"))\r\n                        if (shift_data1.get(\"default_flag\") == 1){\r\n                            s.set(\"shifts\", [it])\r\n                        }\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n        if (inputRule){\r\n            //以规则为维度\r\n            lastScheduleDTOList.addAll(attendance_scheduleDTOList)\r\n        }else {\r\n            //以人员为维度\r\n            if (attendance_scheduleDTOList.size() > 0) {\r\n                lastScheduleDTOList.addAll(attendance_scheduleDTOList)\r\n                for (IEntityDTO employee : dtos) {\r\n                    boolean userExistsSchedule = false;\r\n                    for (IEntityDTO attendance_schedule : lastScheduleDTOList) {\r\n                        if (employee.getString(\"id\", \"\") == attendance_schedule.getString(\"member_id\", \"\")) {\r\n                            userExistsSchedule = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!userExistsSchedule) {\r\n                        IEntityDTO entityDTO = this.getDataEntityRuntime().createEntity();\r\n                        entityDTO.put(\"member_id\", employee.getString(\"id\", \"\"));\r\n                        entityDTO.put(\"member_name\", employee.getString(\"name\", \"\"));\r\n                        lastScheduleDTOList.add(entityDTO);\r\n                    }\r\n                }\r\n            }else {\r\n                for (IEntityDTO employee : dtos) {\r\n                    IEntityDTO entityDTO = this.getDataEntityRuntime().createEntity();\r\n                    entityDTO.put(\"member_id\", employee.getString(\"id\", \"\"));\r\n                    entityDTO.put(\"member_name\", employee.getString(\"name\", \"\"));\r\n                    lastScheduleDTOList.add(entityDTO);\r\n                }\r\n            }\r\n        }\r\n        return lastScheduleDTOList;\r\n\r\n    }\r\n\r\n\r\n    class CustomPageImpl<T> extends net.ibizsys.central.util.PageImpl<T> {\r\n        private final long total;\r\n\r\n        public CustomPageImpl(List<T> content, Pageable pageable, long total, int totalPages) {\r\n            super(content, pageable, total, totalPages);\r\n            this.total = total;\r\n        }\r\n\r\n        @Override\r\n        long getTotalElements() {\r\n            return total;\r\n        }\r\n    }\r\n\r\n\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "SyncHolidaysDEActionRuntime",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/SyncHolidaysDEActionRuntime.json",
    "name" : "SyncHolidaysDEActionRuntime",
    "pluginCode" : "SyncHolidaysDEActionRuntime",
    "pluginType" : "DEACTION",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.SyncHolidaysDEActionRuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\nimport net.ibizsys.central.cloud.core.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.database.ISysDBSchemeRuntime\r\nimport net.ibizsys.central.dataentity.action.DEActionRuntimeBase\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.runtime.util.KeyValueUtils\r\n\r\nimport java.time.LocalDate\r\nimport java.time.LocalDateTime\r\nimport java.time.format.DateTimeFormatter\r\n\r\n\r\nclass SyncHolidaysDEActionRuntime extends DEActionRuntimeBase {\r\n\r\n    private static final DateTimeFormatter dateFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");\r\n    private static final DateTimeFormatter datetimeFormatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\");\r\n\r\n    // 定义节假日映射关系\r\n    private static final Map<String, String> HOLIDAY_MAPPING = new HashMap<String, String>() {\r\n        {\r\n            put(\"元旦节\", \"new_years_day\");\r\n            put(\"春节\", \"spring_festival\");\r\n            put(\"清明节\", \"tomb_sweeping_festival\");\r\n            put(\"劳动节\", \"labor_day\");\r\n            put(\"端午节\", \"dragon_boat_festival\");\r\n            put(\"中秋节\", \"mid_autumn_festival\");\r\n            put(\"国庆节\", \"national_day\");\r\n        }\r\n    };\r\n\r\n    protected Object onExecute(IEntityDTO iEntityDTO) throws Throwable {\r\n        // 获取请求webclient对象\r\n        def webclient = sys.webclient()\r\n        def strUri = 'https://apis.tianapi.com/jiejiari/index'\r\n        def strContentType = \"application/x-www-form-urlencoded\"\r\n        def year = Calendar.getInstance().get(Calendar.YEAR).toString()\r\n\r\n        // 构建参数Map（自动处理URL编码）\r\n        def objBody = [key: 'de9f57437df2fe27fc766b0b7db40671', date: \"${year}\", type: '1']\r\n        def headers = ['Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8']\r\n\r\n        try {\r\n            // 调用请求并自动处理编码\r\n            def response = webclient.post(strUri, null, headers, null, objBody, strContentType, String.class, null);\r\n            // 解析并合并结果\r\n            def json = new groovy.json.JsonSlurper().parseText(response.getBody())\r\n            if (json?.code == 200 && json?.result?.list) {\r\n                def results = json.result.list;\r\n                // 同步至节假日表\r\n                syncHolidays(results)\r\n            }\r\n        } catch (Exception e) {\r\n            e.printStackTrace()\r\n        }\r\n        return iEntityDTO;\r\n    }\r\n\r\n    /**\r\n     *  同步至节假日表\r\n     */\r\n    private void syncHolidays(ArrayList holidays) {\r\n        ISysDBSchemeRuntime dbSchema = this.getDataEntityRuntime().getSysDBSchemeRuntimeMust()\r\n        // 删除今年已同步的数据\r\n        def del_curYear_sql =\r\n                \"delete\\n\" +\r\n                        \"from\\n\" +\r\n                        \"\\tresource_calendar_leaves\\n\" +\r\n                        \"where\\n\" +\r\n                        \"\\tDATE_FROM >= DATE_FORMAT(CURDATE(), '%Y-01-01')\\n\" +\r\n                        \"\\tand DATE_FROM < DATE_ADD(DATE_FORMAT(CURDATE(), '%Y-01-01'), interval 1 year)\\n\" +\r\n                        \"\\tand CALENDAR_ID is null\\n\" +\r\n                        \"\\tand HOLIDAY_TYPE in ('new_years_day','spring_festival','tomb_sweeping_festival','dragon_boat_festival','labor_day','dragon_boat_festival','national_day','mid_autumn_festival')\";\r\n        dbSchema.executeSQL(del_curYear_sql, []);\r\n\r\n        //  获取相关实体运行时\r\n        IDataEntityRuntime leavesRuntime = systemRuntime.getDataEntityRuntime(\"resource_calendar_leaves\");\r\n        List<IEntityDTO> newLeaves = leavesRuntime.createEntityList();\r\n        for (Map<String, Object> holiday : (holidays as List<Map<String, Object>>)) {\r\n            // 构造节假日\r\n            IEntityDTO leaveData = createLeaveData(holiday, leavesRuntime);\r\n            newLeaves.add(leaveData);\r\n        }\r\n        if (!newLeaves.isEmpty()) {\r\n            leavesRuntime.rawCreate(newLeaves, true)\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     *  创建基础节假日数据\r\n     */\r\n    private IEntityDTO createLeaveData(Map<String, Object> holiday, leavesRuntime) {\r\n        IEntityDTO leaveData = leavesRuntime.createEntity();\r\n        String pKey = KeyValueUtils.genUniqueId();\r\n        leaveData.set(\"id\", pKey);\r\n\r\n        // 进行节假日映射\r\n        String tianXingName = (String) holiday.get(\"name\");\r\n        String holidayType = HOLIDAY_MAPPING.getOrDefault(tianXingName, tianXingName);\r\n        leaveData.set(\"holiday_type\", holidayType);\r\n        leaveData.set(\"name\", tianXingName);\r\n\r\n        // 节假日数组\r\n        String[] vacation  = holiday.get(\"vacation\").split(\"[|]\");\r\n        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH-mm-ss\");\r\n        LocalDateTime dateFrom = LocalDate.parse(vacation[0], dateFormatter).atStartOfDay();\r\n        LocalDateTime dateTo = LocalDate.parse(vacation[vacation.length-1], dateFormatter).atTime(23, 59, 59);\r\n        leaveData.set(\"date_from\", dateFrom);\r\n        leaveData.set(\"date_to\", dateTo);\r\n\r\n        return leaveData;\r\n    }\r\n\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "UserObjectDERuntime",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/UserObjectDERuntime.json",
    "memo" : "UserObjectDERuntime",
    "name" : "UserObjectDERuntime",
    "pluginCode" : "UserObjectDERuntime",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.UserObjectDERuntime",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin\r\n\r\nimport net.ibizsys.central.cloud.core.dataentity.DataEntityRuntime\r\nimport net.ibizsys.central.cloud.core.dataentity.IDataEntityRuntime\r\nimport net.ibizsys.central.util.IEntityDTO\r\nimport net.ibizsys.central.util.annotation.DEAction\r\n\r\nclass UserObjectDERuntime extends DataEntityRuntime {\r\n\r\n    @DEAction(\"Get\")\r\n    protected Object doGet(String  strDEId) throws Throwable {\r\n        IDataEntityRuntime employeeRuntime = this.getSystemRuntime().getDataEntityRuntime(\"employee\");\r\n        try {\r\n            IEntityDTO employee = employeeRuntime.get(strDEId);\r\n            return employee;\r\n        } catch (Exception e) {\r\n            IDataEntityRuntime deptRuntime = this.getSystemRuntime().getDataEntityRuntime(\"department\");\r\n            IEntityDTO dept = deptRuntime.get(strDEId);\r\n            return dept;\r\n        }\r\n\r\n        return null;\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "UsrSFPlugin0521277606",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/UsrSFPlugin0521277606.json",
    "memo" : "月度统计自定义导出",
    "name" : "MonthlySummaryPOIDEDataExportRuntimeEx",
    "pluginCode" : "UsrSFPlugin0521277606",
    "pluginType" : "USER",
    "rTObjectName" : "cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport.MonthlySummaryPOIDEDataExportRuntimeEx",
    "rTObjectSource" : 1,
    "templCode" : "package cn.ibizlab.checkin.runtime.plugin.groovy.dataentity.dataexport\r\n\r\nimport groovy.transform.CompileStatic;\r\nimport net.ibizsys.central.plugin.poi.dataentity.dataexport.POIDEDataExportRuntime\r\n\r\nimport net.ibizsys.central.util.IEntityDTO;\r\nimport net.ibizsys.model.dataentity.dataexport.IPSDEDataExportItem\r\nimport net.ibizsys.runtime.security.UserContext\r\nimport org.apache.poi.ss.usermodel.Cell;\r\nimport org.apache.poi.ss.usermodel.Row;\r\nimport org.apache.poi.ss.usermodel.Sheet;\r\nimport org.apache.poi.ss.usermodel.Workbook;\r\nimport org.apache.poi.ss.util.CellRangeAddress;\r\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\r\nimport org.springframework.data.domain.Page\r\nimport org.springframework.util.MultiValueMap;\r\nimport org.springframework.util.ObjectUtils;\r\nimport java.text.SimpleDateFormat;\r\n\r\n@CompileStatic\r\nclass MonthlySummaryPOIDEDataExportRuntimeEx extends POIDEDataExportRuntime {\r\n\r\n    @Override\r\n    protected void onExportStream(Object objData, OutputStream outputStram) throws Throwable {\r\n        Workbook workbook = new XSSFWorkbook();\r\n        Throwable var4 = null;\r\n        try {\r\n            List<IPSDEDataExportItem> exportItems = this.getPSDEDataExport().getPSDEDataExportItems();\r\n\r\n            if (ObjectUtils.isEmpty(exportItems)) {\r\n                throw new Exception(\"未指定导出列\");\r\n            }\r\n            MultiValueMap<String, String> parameters = UserContext.getCurrent().getWebContext().getParameters();\r\n            // 基础信息\r\n            List<String> baseInfoList = convertStringToList(parameters.get(\"base_info\")?.toString())\r\n            // 出勤统计\r\n            List<String> attendanceList = convertStringToList(parameters.get(\"attendance\")?.toString())\r\n            // 异常统计\r\n            List<String> abnormalList = convertStringToList(parameters.get(\"abnormal\")?.toString())\r\n            // 请假统计\r\n            List<String> leaveList = convertStringToList(parameters.get(\"leave\")?.toString())\r\n            // 每日统计\r\n            String daily = parameters.get(\"daily\");\r\n            // 时间范围\r\n            List<String> dateRangeList = convertStringToList(parameters.get(\"date_range\")?.toString())\r\n            List<String> dateRangeWeekList = generateDateWeekRange(dateRangeList.get(0), dateRangeList.get(1));\r\n            Sheet sheet = workbook.createSheet()\r\n            // 创建动态表头\r\n            createHeaders(sheet, baseInfoList, attendanceList, abnormalList,\r\n                    leaveList, daily, dateRangeWeekList, exportItems);\r\n            // 获取动态属性列\r\n            Row headerRow = sheet.getRow(2);\r\n            List<String> propertyNames = getPropertyNames(headerRow);\r\n//            if (daily == \"[daily]\") {\r\n//                // 添加日历属性名称\r\n//                List<String> dateRange = generateDateRange(dateRangeList.get(0), dateRangeList.get(1));\r\n//                propertyNames.addAll(dateRange);\r\n//            }\r\n            // 创建Excel表格数据\r\n            List<IEntityDTO> data = ((Page) objData).getContent();\r\n\r\n            // 平铺日历数据\r\n            SimpleDateFormat sdf = new SimpleDateFormat(\"HH:mm:ss\");\r\n            for (Object item : data) {\r\n                IEntityDTO it = item as IEntityDTO;\r\n                if (!ObjectUtils.isEmpty(it.get(\"attendance_data\"))) {\r\n                    Map<String, Object> attendanceData = it.get(\"attendance_data\") as Map<String, Object>;\r\n                    Set<String> keys = attendanceData.keySet();\r\n                    for (String key : keys) {\r\n                        IEntityDTO record = attendanceData.get(key) as IEntityDTO;\r\n                        if (!ObjectUtils.isEmpty(record) && !ObjectUtils.isEmpty(record.get(\"details\"))) {\r\n                            List<IEntityDTO> details = record.get(\"details\") as List<IEntityDTO>;\r\n                            String checkinTime = \"\";\r\n                            for (IEntityDTO item2 : details) {\r\n                                if (item2.get(\"checkin_result\") == \"NORMAL\") {\r\n                                    if (!ObjectUtils.isEmpty(item2.get(\"checkin_time\"))) {\r\n                                        checkinTime += sdf.format(item2.get(\"checkin_time\")) + \"\\n\";\r\n                                    }\r\n                                }\r\n                            }\r\n                            it.set(key, checkinTime);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            int startRowIndex = 3; // 数据从第4行开始（0-based索引）\r\n            fillDataRows(sheet, data, propertyNames, startRowIndex);\r\n            // 删除标识行\r\n            deleteRowSimple(sheet, 2)\r\n            workbook.write(outputStram);\r\n        } catch (Throwable var25) {\r\n            var4 = var25;\r\n            throw var25;\r\n        } finally {\r\n            if (workbook != null) {\r\n                if (var4 != null) {\r\n                    try {\r\n                        workbook.close();\r\n                    } catch (Throwable var24) {\r\n                        var4.addSuppressed(var24);\r\n                    }\r\n                } else {\r\n                    workbook.close();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // 字符串转List方法\r\n    private static List<String> convertStringToList(String input) {\r\n        if (input == \"[]\" || input == \"[null]\" || input == \"\" || input == null || input.trim().isEmpty()) {\r\n            return new ArrayList<>();\r\n        }\r\n        // 去除方括号并按逗号分割\r\n        String cleaned = input.substring(1, input.length() - 1).trim();\r\n        String[] parts = cleaned.split(\",\");\r\n\r\n        List<String> result = new ArrayList<>();\r\n        for (String part : parts) {\r\n            if (!\"name\".equals(part.trim())) {\r\n                result.add(part.trim());\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // 创建复杂的列头结构\r\n    private static void createHeaders(Sheet sheet, List<String> baseInfoList,\r\n                                      List<String> attendanceList,\r\n                                      List<String> abnormalList,\r\n                                      List<String> leaveList,\r\n                                      String daily,\r\n                                      List<String> dateRangeList,\r\n                                      List<IPSDEDataExportItem> exportItems) {\r\n        // 创建两行表头\r\n        Row row0 = sheet.createRow(0);\r\n        Row row1 = sheet.createRow(1);\r\n        Row row2 = sheet.createRow(2);\r\n        int colIndex = 0;\r\n        // 基本信息分组\r\n        if (baseInfoList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"基本信息\", baseInfoList, exportItems);\r\n        }\r\n        // 出勤统计分组\r\n        if (attendanceList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"出勤统计\", attendanceList, exportItems);\r\n        }\r\n        // 异常统计分组\r\n        if (abnormalList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"异常统计\", abnormalList, exportItems);\r\n        }\r\n        // 请假统计分组\r\n        if (leaveList.size() > 0) {\r\n            colIndex = createGroupHeader(sheet, row0, row1, row2, colIndex,\r\n                    \"请假统计\", leaveList, exportItems);\r\n        }\r\n        if (daily == \"[daily]\") {\r\n            // 每日统计分组\r\n            if (dateRangeList.size() > 0) {\r\n                colIndex = createDateRangeHeader(sheet, row0, row1, row2, colIndex,\r\n                        \"每日统计\", dateRangeList);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 安全合并单元格（防止无效合并区域）\r\n    private static void addSafeMergedRegion(Sheet sheet, int firstRow, int lastRow,\r\n                                            int firstCol, int lastCol) {\r\n        // 确保是有效的合并区域（至少包含两个单元格）\r\n        int rowSpan = lastRow - firstRow + 1;\r\n        int colSpan = lastCol - firstCol + 1;\r\n\r\n        if (rowSpan >= 2 || colSpan >= 2) {\r\n            sheet.addMergedRegion(new CellRangeAddress(firstRow, lastRow, firstCol, lastCol));\r\n        }\r\n    }\r\n\r\n    private static int createDateRangeHeader(Sheet sheet, Row row0, Row row1, Row row2,\r\n                                         int startCol, String groupName,\r\n                                         List<String> headers) {\r\n        if (headers.isEmpty()) {\r\n            return startCol;\r\n        }\r\n        int endCol = startCol + headers.size() - 1;\r\n        // 创建分组标题单元格（存在分组列就创建）\r\n        Cell groupCell = row0.createCell(startCol);\r\n        groupCell.setCellValue(groupName);\r\n        // 处理多列情况\r\n        if (headers.size() > 1) {\r\n            // 横向合并分组标题\r\n            sheet.addMergedRegion(new CellRangeAddress(0, 0, startCol, endCol));\r\n            // 创建分组内的列头\r\n            for (int i = 0; i < headers.size(); i++) {\r\n                Cell headerCell = row1.createCell(startCol + i);\r\n                Cell headerCell2 = row2.createCell(startCol + i);\r\n                String header = headers.get(i).substring(0, 10);\r\n                String headerName = headers.get(i);\r\n                headerCell.setCellValue(headerName);\r\n                headerCell2.setCellValue(header)\r\n            }\r\n        }\r\n        // 处理单列情况\r\n        else if (headers.size() == 1) {\r\n            // 1. 分组标题显示在第一行（不合并）\r\n            // 2. 列头显示在第二行\r\n            // 创建列头单元格\r\n            Cell headerCell = row1.createCell(startCol);\r\n            String header = headers.get(0).substring(0, 10);\r\n            String headerName = headers.get(0);\r\n            headerCell.setCellValue(headerName);\r\n            Cell headerCell2 = row2.createCell(startCol);\r\n            headerCell2.setCellValue(header)\r\n        }\r\n        return endCol + 1;\r\n    }\r\n\r\n    // 创建分组列头（修复单列问题）\r\n    private static int createGroupHeader(Sheet sheet, Row row0, Row row1, Row row2,\r\n                                         int startCol, String groupName,\r\n                                         List<String> headers, List<IPSDEDataExportItem> exportItems) {\r\n        if (headers.isEmpty()) {\r\n            return startCol;\r\n        }\r\n        int endCol = startCol + headers.size() - 1;\r\n        // 创建分组标题单元格（存在分组列就创建）\r\n        Cell groupCell = row0.createCell(startCol);\r\n        groupCell.setCellValue(groupName);\r\n        // 处理多列情况\r\n        if (headers.size() > 1) {\r\n            // 横向合并分组标题\r\n            sheet.addMergedRegion(new CellRangeAddress(0, 0, startCol, endCol));\r\n            // 创建分组内的列头\r\n            for (int i = 0; i < headers.size(); i++) {\r\n                Cell headerCell = row1.createCell(startCol + i);\r\n                Cell headerCell2 = row2.createCell(startCol + i);\r\n                String header = headers.get(i);\r\n                String headerName = getHeaderName(header, exportItems)\r\n                headerCell.setCellValue(headerName);\r\n                headerCell2.setCellValue(header)\r\n            }\r\n        }\r\n        // 处理单列情况\r\n        else if (headers.size() == 1) {\r\n            // 1. 分组标题显示在第一行（不合并）\r\n            // 2. 列头显示在第二行\r\n            // 创建列头单元格\r\n            Cell headerCell = row1.createCell(startCol);\r\n            String header = headers.get(0);\r\n            String headerName = getHeaderName(header, exportItems)\r\n            headerCell.setCellValue(headerName);\r\n            Cell headerCell2 = row2.createCell(startCol);\r\n            headerCell2.setCellValue(header)\r\n        }\r\n        return endCol + 1;\r\n    }\r\n\r\n    private static String getHeaderName(String header, List<IPSDEDataExportItem> exportItems) {\r\n        String headerName = \"\"\r\n        for (IPSDEDataExportItem item : exportItems) {\r\n            if (item.getName().equals(header)) {\r\n                headerName = item.getCaption()\r\n            }\r\n        }\r\n        return headerName\r\n    }\r\n\r\n    // 填充数据行\r\n    private void fillDataRows(Sheet sheet, List<IEntityDTO> data, List<String> propertyNames, int startRowIndex) {\r\n        if (data == null || data.isEmpty()) return;\r\n        for (int i = 0; i < data.size(); i++) {\r\n            IEntityDTO entity = data.get(i);\r\n            // 创建每行数据\r\n            Row dataRow = sheet.createRow(startRowIndex + i);\r\n            // 填充每个单元格\r\n            for (int col = 0; col < propertyNames.size(); col++) {\r\n                String propertyName = propertyNames.get(col);\r\n                String propertyValue = entity.get(propertyName);\r\n                Cell cell = dataRow.createCell(col);\r\n                // 设置单元格值\r\n                cell.setCellValue(propertyValue);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 获取第三行的属性名列表\r\n    private static List<String> getPropertyNames(Row headerRow) {\r\n        List<String> propertyNames = new ArrayList<>();\r\n        int lastCellNum = headerRow.getLastCellNum();\r\n\r\n        for (int i = 0; i < lastCellNum; i++) {\r\n            Cell cell = headerRow.getCell(i);\r\n            if (cell != null) {\r\n                propertyNames.add(cell.getStringCellValue());\r\n            } else {\r\n                propertyNames.add(\"\"); // 空值处理\r\n            }\r\n        }\r\n        return propertyNames;\r\n    }\r\n\r\n    private static void deleteRowSimple(Sheet sheet, int rowIndex) {\r\n        int lastRowNum = sheet.getLastRowNum();\r\n        // 验证行索引\r\n        if (rowIndex < 0 || rowIndex > lastRowNum) {\r\n            throw new IllegalArgumentException(\"行索引超出范围: \" + rowIndex);\r\n        }\r\n        // 如果是最后一行，直接删除\r\n        if (rowIndex == lastRowNum) {\r\n            Row row = sheet.getRow(rowIndex);\r\n            if (row != null) {\r\n                sheet.removeRow(row);\r\n            }\r\n        }\r\n        // 如果是中间行，向上移动后续行\r\n        else {\r\n            sheet.shiftRows(rowIndex + 1, lastRowNum, -1);\r\n        }\r\n    }\r\n\r\n    private static List<String> generateDateWeekRange(String startDate, String endDate) throws Exception {\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n        SimpleDateFormat dayOfWeekFormat = new SimpleDateFormat(\"EEEE\", Locale.CHINA);\r\n\r\n        Date start = sdf.parse(startDate);\r\n        Date end = sdf.parse(endDate);\r\n\r\n        List<String> dateArray = new ArrayList<>();\r\n\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.setTime(start);\r\n\r\n        while (!calendar.getTime().after(end)) {\r\n            String formattedDate = sdf.format(calendar.getTime()) + \" \" + dayOfWeekFormat.format(calendar.getTime());\r\n            dateArray.add(formattedDate);\r\n            calendar.add(Calendar.DATE, 1);\r\n        }\r\n\r\n        return dateArray;\r\n    }\r\n\r\n    private static List<String> generateDateRange(String startDate, String endDate) throws Exception {\r\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n\r\n        Date start = sdf.parse(startDate);\r\n        Date end = sdf.parse(endDate);\r\n\r\n        List<String> dateArray = new ArrayList<>();\r\n\r\n        Calendar calendar = Calendar.getInstance();\r\n        calendar.setTime(start);\r\n\r\n        while (!calendar.getTime().after(end)) {\r\n            dateArray.add(sdf.format(calendar.getTime()));\r\n            calendar.add(Calendar.DATE, 1);\r\n        }\r\n\r\n        return dateArray;\r\n    }\r\n}",
    "runtimeObject" : true
  }, {
    "codeName" : "UsrSFPlugin1026805041",
    "dynaModelFilePath" : "PSSYSSFPLUGINS/UsrSFPlugin1026805041.json",
    "name" : "SubSysServiceAPIRuntime",
    "pluginCode" : "UsrSFPlugin1026805041",
    "pluginType" : "USER",
    "rTObjectName" : "net.ibizsys.central.service.SubSysServiceAPIRuntime",
    "rTObjectSource" : 1,
    "runtimeObject" : true
  } ],
  "getAllPSSysSFPubs" : [ {
    "modelref" : true,
    "path" : "PSSYSSFPUBS/attendance.json"
  } ],
  "getAllPSSysServiceAPIs" : [ {
    "modelref" : true,
    "path" : "PSSYSSERVICEAPIS/ServiceAPI.json"
  } ],
  "getAllPSSysUniReses" : [ {
    "name" : "年度日历",
    "resCode" : "NDRL",
    "id" : "NDRL"
  }, {
    "name" : "考勤规则",
    "resCode" : "ATTENDANCE_RULE",
    "id" : "ATTENDANCE_RULE"
  }, {
    "name" : "删除",
    "resCode" : "DELETE",
    "id" : "DELETE"
  }, {
    "name" : "月度汇总",
    "resCode" : "MONTHLYSTATISTICS",
    "id" : "MONTHLYSTATISTICS"
  }, {
    "name" : "打卡记录",
    "resCode" : "ATTENDANCE_CLOCK_IN_RECORD",
    "id" : "ATTENDANCE_CLOCK_IN_RECORD"
  }, {
    "name" : "部门统计",
    "resCode" : "ATTENDANCE_DEPARTMENT_STATISTICS",
    "id" : "ATTENDANCE_DEPARTMENT_STATISTICS"
  }, {
    "name" : "每日统计",
    "resCode" : "DAILYSTATISTICS",
    "id" : "DAILYSTATISTICS"
  }, {
    "name" : "推送至得力",
    "resCode" : "PUSH",
    "id" : "PUSH"
  }, {
    "name" : "考勤计算",
    "resCode" : "ATTENDANCE_CALCULATION",
    "id" : "ATTENDANCE_CALCULATION"
  }, {
    "name" : "假期类型",
    "resCode" : "LEAVE_TYPE",
    "id" : "LEAVE_TYPE"
  }, {
    "name" : "员工管理",
    "resCode" : "EMPLOYEE",
    "id" : "EMPLOYEE"
  }, {
    "name" : "初始化数据",
    "resCode" : "INIT_CLOCK_IN_DATA",
    "id" : "INIT_CLOCK_IN_DATA"
  }, {
    "name" : "删除得力信息",
    "resCode" : "DELETE_DELI_INFO",
    "id" : "DELETE_DELI_INFO"
  }, {
    "name" : "异常考勤",
    "resCode" : "ABNORMALATTENDANCE",
    "id" : "ABNORMALATTENDANCE"
  }, {
    "name" : "清除手动排班",
    "resCode" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE",
    "id" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
  }, {
    "name" : "批量推送至得力",
    "resCode" : "BATCH_PUSH",
    "id" : "BATCH_PUSH"
  }, {
    "name" : "部门管理",
    "resCode" : "DEPARTMENT",
    "id" : "DEPARTMENT"
  }, {
    "name" : "申请记录",
    "resCode" : "ATTENDANCE_CHECKIN_APPLICATION",
    "id" : "ATTENDANCE_CHECKIN_APPLICATION"
  }, {
    "name" : "同步数据",
    "resCode" : "SYNC_CLOCK_IN_DATA",
    "id" : "SYNC_CLOCK_IN_DATA"
  }, {
    "name" : "同步得力信息",
    "resCode" : "SYNC_DELI_INFO",
    "id" : "SYNC_DELI_INFO"
  }, {
    "name" : "排班视图",
    "resCode" : "ATTENDANCE_SCHEDULE",
    "id" : "ATTENDANCE_SCHEDULE"
  } ],
  "getAllPSSysUserRoles" : [ {
    "codeName" : "CheckinCompOutMgr",
    "dynaModelFilePath" : "PSSYSUSERROLES/CheckinCompOutMgr.json",
    "name" : "外协厂商",
    "getPSSysUserRoleDatas" : [ {
      "name" : "外协厂商-DEPARTMENT[全部数据（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department/PSDEUSERROLES/ALL_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json"
      }
    }, {
      "name" : "外协厂商-ATTENDANCE_SCHEDULE[我的厂商（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule/PSDEUSERROLES/MYGYS_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json"
      }
    }, {
      "name" : "外协厂商-ATTENDANCE_CHECKIN_APPLICATION[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json"
      }
    }, {
      "name" : "外协厂商-USER_OBJECT[我的厂商（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object/PSDEUSERROLES/MYGYS_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
      }
    }, {
      "name" : "外协厂商-ATTENDANCE_RULE[全部数据（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/ALL_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "外协厂商-ATTENDANCE_RECORD[我的厂商（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record/PSDEUSERROLES/MYGYS_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json"
      }
    }, {
      "name" : "外协厂商-ATTENDANCE_CLOCK_IN_RECORD[我的厂商（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record/PSDEUSERROLES/MYGYS_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
      }
    }, {
      "name" : "外协厂商-ATTENDANCE_STATISTICS[我的厂商（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics/PSDEUSERROLES/MYGYS_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json"
      }
    }, {
      "name" : "外协厂商-EMPLOYEE[我的厂商（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee/PSDEUSERROLES/MYGYS_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
      }
    } ],
    "getPSSysUserRoleReses" : [ {
      "name" : "外协厂商-月度汇总",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "MONTHLYSTATISTICS"
      },
      "sysUniResCode" : "MONTHLYSTATISTICS"
    }, {
      "name" : "外协厂商-排班视图",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "ATTENDANCE_SCHEDULE"
    }, {
      "name" : "外协厂商-申请记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CHECKIN_APPLICATION"
      },
      "sysUniResCode" : "ATTENDANCE_CHECKIN_APPLICATION"
    }, {
      "name" : "外协厂商-异常考勤",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ABNORMALATTENDANCE"
      },
      "sysUniResCode" : "ABNORMALATTENDANCE"
    }, {
      "name" : "外协厂商-每日统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DAILYSTATISTICS"
      },
      "sysUniResCode" : "DAILYSTATISTICS"
    }, {
      "name" : "外协厂商-打卡记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CLOCK_IN_RECORD"
      },
      "sysUniResCode" : "ATTENDANCE_CLOCK_IN_RECORD"
    } ],
    "roleTag" : "CheckinCompOutMgr",
    "roleType" : "CUSTOM",
    "uniResTags" : [ "MONTHLYSTATISTICS", "ATTENDANCE_SCHEDULE", "ATTENDANCE_CHECKIN_APPLICATION", "ABNORMALATTENDANCE", "DAILYSTATISTICS", "ATTENDANCE_CLOCK_IN_RECORD" ]
  }, {
    "codeName" : "CheckinDeptLeader",
    "dynaModelFilePath" : "PSSYSUSERROLES/CheckinDeptLeader.json",
    "name" : "部门领导",
    "getPSSysUserRoleDatas" : [ {
      "name" : "部门领导-ATTENDANCE_CLOCK_IN_RECORD[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_LEAVE_TYPE[全部数据（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type/PSDEUSERROLES/ALL_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_RECORD[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_RULE[全部数据（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/ALL_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "部门领导-DEPARTMENT[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_STATISTICS[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json"
      }
    }, {
      "name" : "部门领导-USER_OBJECT[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_CHECKIN_APPLICATION[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_SCHEDULE[我部门的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule/PSDEUSERROLES/MYDEPT_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json"
      }
    }, {
      "name" : "部门领导-EMPLOYEE[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_DEPARTMENT_STATISTICS[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics.json"
      }
    }, {
      "name" : "部门领导-ATTENDANCE_RULE[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    } ],
    "getPSSysUserRoleReses" : [ {
      "name" : "部门领导-打卡记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CLOCK_IN_RECORD"
      },
      "sysUniResCode" : "ATTENDANCE_CLOCK_IN_RECORD"
    }, {
      "name" : "部门领导-假期类型",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "LEAVE_TYPE"
      },
      "sysUniResCode" : "LEAVE_TYPE"
    }, {
      "name" : "部门领导-异常考勤",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ABNORMALATTENDANCE"
      },
      "sysUniResCode" : "ABNORMALATTENDANCE"
    }, {
      "name" : "部门领导-考勤规则",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_RULE"
      },
      "sysUniResCode" : "ATTENDANCE_RULE"
    }, {
      "name" : "部门领导-排班视图",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "ATTENDANCE_SCHEDULE"
    }, {
      "name" : "部门领导-员工管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "EMPLOYEE"
      },
      "sysUniResCode" : "EMPLOYEE"
    }, {
      "name" : "部门领导-部门管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DEPARTMENT"
      },
      "sysUniResCode" : "DEPARTMENT"
    }, {
      "name" : "部门领导-考勤计算",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CALCULATION"
      },
      "sysUniResCode" : "ATTENDANCE_CALCULATION"
    }, {
      "name" : "部门领导-年度日历",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "NDRL"
      },
      "sysUniResCode" : "NDRL"
    }, {
      "name" : "部门领导-部门统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_DEPARTMENT_STATISTICS"
      },
      "sysUniResCode" : "ATTENDANCE_DEPARTMENT_STATISTICS"
    }, {
      "name" : "部门领导-清除手动排班",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
    }, {
      "name" : "部门领导-每日统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DAILYSTATISTICS"
      },
      "sysUniResCode" : "DAILYSTATISTICS"
    }, {
      "name" : "部门领导-同步数据",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "SYNC_CLOCK_IN_DATA"
      },
      "sysUniResCode" : "SYNC_CLOCK_IN_DATA"
    }, {
      "name" : "部门领导-申请记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CHECKIN_APPLICATION"
      },
      "sysUniResCode" : "ATTENDANCE_CHECKIN_APPLICATION"
    }, {
      "name" : "部门领导-月度汇总",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "MONTHLYSTATISTICS"
      },
      "sysUniResCode" : "MONTHLYSTATISTICS"
    } ],
    "roleTag" : "CheckinDeptLeader",
    "roleType" : "CUSTOM",
    "uniResTags" : [ "ATTENDANCE_CLOCK_IN_RECORD", "LEAVE_TYPE", "ABNORMALATTENDANCE", "ATTENDANCE_RULE", "ATTENDANCE_SCHEDULE", "EMPLOYEE", "DEPARTMENT", "ATTENDANCE_CALCULATION", "NDRL", "ATTENDANCE_DEPARTMENT_STATISTICS", "CLEAR_MANUAL_ATTENDANCE_SCHEDULE", "DAILYSTATISTICS", "SYNC_CLOCK_IN_DATA", "ATTENDANCE_CHECKIN_APPLICATION", "MONTHLYSTATISTICS" ]
  }, {
    "codeName" : "CheckinGeneralStaff",
    "dynaModelFilePath" : "PSSYSUSERROLES/CheckinGeneralStaff.json",
    "name" : "普通员工",
    "getPSSysUserRoleDatas" : [ {
      "name" : "普通员工-ATTENDANCE_STATISTICS[需求人是我（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics/PSDEUSERROLES/XQRSW_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_SCHEDULE[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_CLOCK_IN_RECORD[需求人是我（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record/PSDEUSERROLES/XQRSW_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_CHECKIN_APPLICATION[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_RULE[全部数据（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/ALL_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_RECORD[需求人是我（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record/PSDEUSERROLES/XQRSW_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_RULE[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "普通员工-USER_OBJECT[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_DEPARTMENT_STATISTICS[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics.json"
      }
    }, {
      "name" : "普通员工-ATTENDANCE_LEAVE_TYPE[全部数据（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type/PSDEUSERROLES/ALL_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type.json"
      }
    }, {
      "name" : "普通员工-EMPLOYEE[需求人是我（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee/PSDEUSERROLES/XQRSW_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
      }
    }, {
      "name" : "普通员工-DEPARTMENT[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json"
      }
    } ],
    "getPSSysUserRoleReses" : [ {
      "name" : "普通员工-考勤计算",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CALCULATION"
      },
      "sysUniResCode" : "ATTENDANCE_CALCULATION"
    }, {
      "name" : "普通员工-假期类型",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "LEAVE_TYPE"
      },
      "sysUniResCode" : "LEAVE_TYPE"
    }, {
      "name" : "普通员工-异常考勤",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ABNORMALATTENDANCE"
      },
      "sysUniResCode" : "ABNORMALATTENDANCE"
    }, {
      "name" : "普通员工-申请记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CHECKIN_APPLICATION"
      },
      "sysUniResCode" : "ATTENDANCE_CHECKIN_APPLICATION"
    }, {
      "name" : "普通员工-部门统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_DEPARTMENT_STATISTICS"
      },
      "sysUniResCode" : "ATTENDANCE_DEPARTMENT_STATISTICS"
    }, {
      "name" : "普通员工-清除手动排班",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
    }, {
      "name" : "普通员工-部门管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DEPARTMENT"
      },
      "sysUniResCode" : "DEPARTMENT"
    }, {
      "name" : "普通员工-月度汇总",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "MONTHLYSTATISTICS"
      },
      "sysUniResCode" : "MONTHLYSTATISTICS"
    }, {
      "name" : "普通员工-同步数据",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "SYNC_CLOCK_IN_DATA"
      },
      "sysUniResCode" : "SYNC_CLOCK_IN_DATA"
    }, {
      "name" : "普通员工-年度日历",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "NDRL"
      },
      "sysUniResCode" : "NDRL"
    }, {
      "name" : "普通员工-排班视图",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "ATTENDANCE_SCHEDULE"
    }, {
      "name" : "普通员工-员工管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "EMPLOYEE"
      },
      "sysUniResCode" : "EMPLOYEE"
    }, {
      "name" : "普通员工-每日统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DAILYSTATISTICS"
      },
      "sysUniResCode" : "DAILYSTATISTICS"
    }, {
      "name" : "普通员工-考勤规则",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_RULE"
      },
      "sysUniResCode" : "ATTENDANCE_RULE"
    }, {
      "name" : "普通员工-打卡记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CLOCK_IN_RECORD"
      },
      "sysUniResCode" : "ATTENDANCE_CLOCK_IN_RECORD"
    } ],
    "roleTag" : "CheckinGeneralStaff",
    "roleType" : "CUSTOM",
    "uniResTags" : [ "ATTENDANCE_CALCULATION", "LEAVE_TYPE", "ABNORMALATTENDANCE", "ATTENDANCE_CHECKIN_APPLICATION", "ATTENDANCE_DEPARTMENT_STATISTICS", "CLEAR_MANUAL_ATTENDANCE_SCHEDULE", "DEPARTMENT", "MONTHLYSTATISTICS", "SYNC_CLOCK_IN_DATA", "NDRL", "ATTENDANCE_SCHEDULE", "EMPLOYEE", "DAILYSTATISTICS", "ATTENDANCE_RULE", "ATTENDANCE_CLOCK_IN_RECORD" ]
  }, {
    "codeName" : "CheckinGroupLeader",
    "dynaModelFilePath" : "PSSYSUSERROLES/CheckinGroupLeader.json",
    "name" : "班组组长",
    "getPSSysUserRoleDatas" : [ {
      "name" : "班组组长-ATTENDANCE_CHECKIN_APPLICATION[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_STATISTICS[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_RULE[全部数据（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/ALL_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "班组组长-USER_OBJECT[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_LEAVE_TYPE[全部数据（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type/PSDEUSERROLES/ALL_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_RECORD[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_RULE[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_DEPARTMENT_STATISTICS[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_SCHEDULE[我的班组（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule/PSDEUSERROLES/MYGROUP_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json"
      }
    }, {
      "name" : "班组组长-ATTENDANCE_CLOCK_IN_RECORD[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
      }
    }, {
      "name" : "班组组长-EMPLOYEE[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
      }
    }, {
      "name" : "班组组长-DEPARTMENT[我的班组（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department/PSDEUSERROLES/MYGROUP_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json"
      }
    } ],
    "getPSSysUserRoleReses" : [ {
      "name" : "班组组长-异常考勤",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ABNORMALATTENDANCE"
      },
      "sysUniResCode" : "ABNORMALATTENDANCE"
    }, {
      "name" : "班组组长-部门管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DEPARTMENT"
      },
      "sysUniResCode" : "DEPARTMENT"
    }, {
      "name" : "班组组长-考勤规则",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_RULE"
      },
      "sysUniResCode" : "ATTENDANCE_RULE"
    }, {
      "name" : "班组组长-每日统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DAILYSTATISTICS"
      },
      "sysUniResCode" : "DAILYSTATISTICS"
    }, {
      "name" : "班组组长-申请记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CHECKIN_APPLICATION"
      },
      "sysUniResCode" : "ATTENDANCE_CHECKIN_APPLICATION"
    }, {
      "name" : "班组组长-同步数据",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "SYNC_CLOCK_IN_DATA"
      },
      "sysUniResCode" : "SYNC_CLOCK_IN_DATA"
    }, {
      "name" : "班组组长-假期类型",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "LEAVE_TYPE"
      },
      "sysUniResCode" : "LEAVE_TYPE"
    }, {
      "name" : "班组组长-员工管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "EMPLOYEE"
      },
      "sysUniResCode" : "EMPLOYEE"
    }, {
      "name" : "班组组长-打卡记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CLOCK_IN_RECORD"
      },
      "sysUniResCode" : "ATTENDANCE_CLOCK_IN_RECORD"
    }, {
      "name" : "班组组长-部门统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_DEPARTMENT_STATISTICS"
      },
      "sysUniResCode" : "ATTENDANCE_DEPARTMENT_STATISTICS"
    }, {
      "name" : "班组组长-年度日历",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "NDRL"
      },
      "sysUniResCode" : "NDRL"
    }, {
      "name" : "班组组长-考勤计算",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CALCULATION"
      },
      "sysUniResCode" : "ATTENDANCE_CALCULATION"
    }, {
      "name" : "班组组长-清除手动排班",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
    }, {
      "name" : "班组组长-月度汇总",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "MONTHLYSTATISTICS"
      },
      "sysUniResCode" : "MONTHLYSTATISTICS"
    }, {
      "name" : "班组组长-排班视图",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "ATTENDANCE_SCHEDULE"
    } ],
    "roleTag" : "CheckinGroupLeader",
    "roleType" : "CUSTOM",
    "uniResTags" : [ "ABNORMALATTENDANCE", "DEPARTMENT", "ATTENDANCE_RULE", "DAILYSTATISTICS", "ATTENDANCE_CHECKIN_APPLICATION", "SYNC_CLOCK_IN_DATA", "LEAVE_TYPE", "EMPLOYEE", "ATTENDANCE_CLOCK_IN_RECORD", "ATTENDANCE_DEPARTMENT_STATISTICS", "NDRL", "ATTENDANCE_CALCULATION", "CLEAR_MANUAL_ATTENDANCE_SCHEDULE", "MONTHLYSTATISTICS", "ATTENDANCE_SCHEDULE" ]
  }, {
    "codeName" : "CheckinDeptOutMgr",
    "dynaModelFilePath" : "PSSYSUSERROLES/CheckinDeptOutMgr.json",
    "name" : "部门外协管理员",
    "getPSSysUserRoleDatas" : [ {
      "name" : "部门外协管理员-ATTENDANCE_CLOCK_IN_RECORD[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_RULE[全部数据（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/ALL_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_DEPARTMENT_STATISTICS[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_STATISTICS[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_RECORD[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_SCHEDULE[我部门的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule/PSDEUSERROLES/MYDEPT_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_RULE[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_LEAVE_TYPE[全部数据（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type/PSDEUSERROLES/ALL_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type.json"
      }
    }, {
      "name" : "部门外协管理员-ATTENDANCE_CHECKIN_APPLICATION[我创建的（读写）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application/PSDEUSERROLES/CURDRAFTMAN_RW.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json"
      }
    }, {
      "name" : "部门外协管理员-USER_OBJECT[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
      }
    }, {
      "name" : "部门外协管理员-DEPARTMENT[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json"
      }
    }, {
      "name" : "部门外协管理员-EMPLOYEE[我部门的（读）]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee/PSDEUSERROLES/MYDEPT_R.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
      }
    } ],
    "getPSSysUserRoleReses" : [ {
      "name" : "部门外协管理员-清除手动排班",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "CLEAR_MANUAL_ATTENDANCE_SCHEDULE"
    }, {
      "name" : "部门外协管理员-员工管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "EMPLOYEE"
      },
      "sysUniResCode" : "EMPLOYEE"
    }, {
      "name" : "部门外协管理员-异常考勤",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ABNORMALATTENDANCE"
      },
      "sysUniResCode" : "ABNORMALATTENDANCE"
    }, {
      "name" : "部门外协管理员-考勤规则",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_RULE"
      },
      "sysUniResCode" : "ATTENDANCE_RULE"
    }, {
      "name" : "部门外协管理员-部门统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_DEPARTMENT_STATISTICS"
      },
      "sysUniResCode" : "ATTENDANCE_DEPARTMENT_STATISTICS"
    }, {
      "name" : "部门外协管理员-申请记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CHECKIN_APPLICATION"
      },
      "sysUniResCode" : "ATTENDANCE_CHECKIN_APPLICATION"
    }, {
      "name" : "部门外协管理员-考勤计算",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CALCULATION"
      },
      "sysUniResCode" : "ATTENDANCE_CALCULATION"
    }, {
      "name" : "部门外协管理员-部门管理",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DEPARTMENT"
      },
      "sysUniResCode" : "DEPARTMENT"
    }, {
      "name" : "部门外协管理员-同步数据",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "SYNC_CLOCK_IN_DATA"
      },
      "sysUniResCode" : "SYNC_CLOCK_IN_DATA"
    }, {
      "name" : "部门外协管理员-每日统计",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "DAILYSTATISTICS"
      },
      "sysUniResCode" : "DAILYSTATISTICS"
    }, {
      "name" : "部门外协管理员-月度汇总",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "MONTHLYSTATISTICS"
      },
      "sysUniResCode" : "MONTHLYSTATISTICS"
    }, {
      "name" : "部门外协管理员-年度日历",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "NDRL"
      },
      "sysUniResCode" : "NDRL"
    }, {
      "name" : "部门外协管理员-排班视图",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_SCHEDULE"
      },
      "sysUniResCode" : "ATTENDANCE_SCHEDULE"
    }, {
      "name" : "部门外协管理员-假期类型",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "LEAVE_TYPE"
      },
      "sysUniResCode" : "LEAVE_TYPE"
    }, {
      "name" : "部门外协管理员-打卡记录",
      "getPSSysUniRes" : {
        "modelref" : true,
        "id" : "ATTENDANCE_CLOCK_IN_RECORD"
      },
      "sysUniResCode" : "ATTENDANCE_CLOCK_IN_RECORD"
    } ],
    "roleTag" : "CheckinDeptOutMgr",
    "roleType" : "CUSTOM",
    "uniResTags" : [ "CLEAR_MANUAL_ATTENDANCE_SCHEDULE", "EMPLOYEE", "ABNORMALATTENDANCE", "ATTENDANCE_RULE", "ATTENDANCE_DEPARTMENT_STATISTICS", "ATTENDANCE_CHECKIN_APPLICATION", "ATTENDANCE_CALCULATION", "DEPARTMENT", "SYNC_CLOCK_IN_DATA", "DAILYSTATISTICS", "MONTHLYSTATISTICS", "NDRL", "ATTENDANCE_SCHEDULE", "LEAVE_TYPE", "ATTENDANCE_CLOCK_IN_RECORD" ]
  }, {
    "codeName" : "attandence_admin",
    "dynaModelFilePath" : "PSSYSUSERROLES/attandence_admin.json",
    "name" : "出勤管理员",
    "getPSSysUserRoleDatas" : [ {
      "name" : "出勤管理员-HR_ATTENDANCE[出勤记录管理员]",
      "getPSDEUserRole" : {
        "modelref" : true,
        "path" : "PSMODULES/hr/PSDATAENTITIES/hr_attendance/PSDEUSERROLES/attendance_admin.json"
      },
      "getPSDataEntity" : {
        "modelref" : true,
        "path" : "PSMODULES/hr/PSDATAENTITIES/hr_attendance.json"
      }
    } ],
    "roleTag" : "attandence_admin",
    "roleType" : "CUSTOM",
    "globalRole" : true
  } ],
  "getAllPSSystemDBConfigs" : [ {
    "modelref" : true,
    "path" : "PSSYSTEMDBCFGS/MYSQL5.json"
  } ],
  "getAllPSSystemModules" : [ {
    "getAllPSCodeLists" : [ {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/leave_application_statistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/abnormal_statistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/attendance_result.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/unit_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/clock_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/Week2.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/attendance_policy.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/checkin_info.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/periodFrom.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/checkin_method_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/workday_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/attendance_statistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/Week4.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/details_result.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/DurationStatistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/search_month.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/leave_status.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/months.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/ShiftNum.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/workingNumber.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/checkin_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/holiday.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/cycle.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/approval_status.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/daily_statistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/schedule_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/manualType.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/overtime_kind.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/overtime_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/CycleWeeks.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/device_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/member_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/holidayType.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/inversion_count.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/same_restday.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/elastic_minutes.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/checkin_frequency.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/attendance_rules.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/attendance_status.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/off_time_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/workday.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/shift_status.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/AbnormalStatistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/base_info.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/Week1.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/leave_calc_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/effectConfig.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/Week3.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/leave_ask_unit.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/application_status.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/DailystatisticsBase.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/with_salary.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/leaveScopeType.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/all_schedule_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSCODELISTS/attendance_type.json"
    } ],
    "getAllPSDataEntities" : [ {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_activate_rule.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_activate_shift.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_application.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_checkin_device.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_clock_in_record.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_department_statistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_device.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_gps_location.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_group_shift.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_group_shift_member.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_leave_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_record_detail.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_rule.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_schedule.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_scope.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_shift.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_statistics.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_wifi_location.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/attendance/PSDATAENTITIES/attendance_workday.json"
    } ],
    "codeName" : "attendance",
    "dynaModelFilePath" : "PSMODULES/attendance.json",
    "name" : "考勤规则管理"
  }, {
    "getAllPSDataEntities" : [ {
      "modelref" : true,
      "path" : "PSMODULES/base/PSDATAENTITIES/res_company.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/base/PSDATAENTITIES/res_config_settings.json"
    } ],
    "codeName" : "base",
    "dynaModelFilePath" : "PSMODULES/base.json",
    "name" : "基础模块",
    "utilType" : "MAINSYSPROXY"
  }, {
    "getAllPSCodeLists" : [ {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSCODELISTS/copy_give.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSCODELISTS/employeeType.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSCODELISTS/dept.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSCODELISTS/employee.json"
    } ],
    "getAllPSDataEntities" : [ {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/department.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/employee.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/employee_management/PSDATAENTITIES/user_object.json"
    } ],
    "codeName" : "employee_management",
    "dynaModelFilePath" : "PSMODULES/employee_management.json",
    "name" : "员工管理"
  }, {
    "getAllPSCodeLists" : [ {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_certificate.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/barcode_source.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_attendance_out_mode.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_activity_exception_decoration.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_activity_state.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_report_calendar_state.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_state.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_attendance_overtime_status.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/kiosk_mode.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_leave_request_date_from_period.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/overtime_validation.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_gender.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_distance_home_work_unit.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_employee_employee_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSCODELISTS/hr_attendance_in_mode.json"
    } ],
    "getAllPSDataEntities" : [ {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSDATAENTITIES/hr_attendance.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSDATAENTITIES/hr_attendance_overtime.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSDATAENTITIES/hr_department.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSDATAENTITIES/hr_employee.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/hr/PSDATAENTITIES/hr_leave.json"
    } ],
    "codeName" : "hr",
    "dynaModelFilePath" : "PSMODULES/hr.json",
    "name" : "人力资源",
    "utilType" : "MAINSYSPROXY"
  }, {
    "codeName" : "hr_extend",
    "dynaModelFilePath" : "PSMODULES/hr_extend.json",
    "name" : "人力资源扩展"
  }, {
    "getAllPSDataEntities" : [ {
      "modelref" : true,
      "path" : "PSMODULES/mail/PSDATAENTITIES/mail_thread.json"
    } ],
    "codeName" : "mail",
    "dynaModelFilePath" : "PSMODULES/mail.json",
    "name" : "邮件",
    "utilType" : "MAINSYSPROXY"
  }, {
    "getAllPSCodeLists" : [ {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_display_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/resource_resource_resource_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_week_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/holiday_dyna.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_dayofweek.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_leaves_time_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSCODELISTS/resource_calendar_attendance_day_period.json"
    } ],
    "getAllPSDataEntities" : [ {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSDATAENTITIES/public_leave_type.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSDATAENTITIES/resource_calendar.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSDATAENTITIES/resource_calendar_attendance.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSDATAENTITIES/resource_calendar_leaves.json"
    }, {
      "modelref" : true,
      "path" : "PSMODULES/resource/PSDATAENTITIES/resource_resource.json"
    } ],
    "codeName" : "resource",
    "dynaModelFilePath" : "PSMODULES/resource.json",
    "name" : "资源",
    "utilType" : "MAINSYSPROXY"
  } ],
  "codeName" : "attendance",
  "defaultLanguage" : "ZH_CN",
  "getDefaultPSSysI18N" : {
    "modelref" : true,
    "path" : "PSSYSI18NS/DEFAULT.json"
  },
  "getDefaultPSSysSFPub" : {
    "codeName" : "attendance",
    "contentType" : "CODE",
    "defaultFlag" : true,
    "dynaModelFilePath" : "PSSYSSFPUBS/attendance.json",
    "groovySourceFolder" : "backend/attendance-core/src/main/groovy",
    "modelFolder" : "model",
    "name" : "attendance",
    "pKGCodeName" : "cn.ibizlab",
    "versionString" : "1.0.0.0",
    "codeMode" : true,
    "enableModelRT" : true,
    "mainPSSysSFPub" : true,
    "pubModel" : true
  },
  "deploySysId" : "attendance",
  "engineVer" : 241,
  "logicName" : "iBiz考勤管理",
  "name" : "attendance",
  "getPSDevSlnSysId" : "5D5BA3BE-F8C8-4CE3-A585-13F8F75FCA44",
  "vCName" : "trunk",
  "id" : "PSSYSTEM.json"
}