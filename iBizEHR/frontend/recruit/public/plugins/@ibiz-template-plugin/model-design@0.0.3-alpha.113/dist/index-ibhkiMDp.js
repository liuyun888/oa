System.register(["vue","@ibiz-template/vue3-util","vuedraggable","qx-util","qs","@ibiz-template/runtime","@ibiz-template/core","axios"],(function(e,t){"use strict";var a,i,s,n,o,l,r,d,c,m,u,p,h,g,b,f,v,y,w,$,C,I,x,O,z,M,D,E,j,S,A,T,k,L;return{setters:[function(e){a=e.defineComponent,i=e.createVNode,s=e.resolveComponent,n=e.createTextVNode,o=e.isVNode,l=e.ref,r=e.computed,d=e.onUnmounted,c=e.withDirectives,m=e.vShow,u=e.resolveDirective,p=e.watch,h=e.onMounted,g=e.nextTick,b=e.h,f=e.reactive},function(e){v=e.useNamespace,y=e.useUIStore},function(e){w=e.default},function(e){$=e.createUUID,C=e.notNilEmpty},function(e){I=e.default},function(e){x=e.getUIActionById,O=e.getEditorProvider,z=e.PluginStaticResource,M=e.ControlVO,D=e.UIActionProviderBase,E=e.convertNavData,j=e.formatMultiData,S=e.SysUIActionTag,A=e.calcDeCodeNameById,T=e.registerUIActionProvider},function(e){k=e.recursiveIterate,L=e.getToken},null],execute:function(){let N=!1,_=null,P=!1;const V="undefined"!=typeof window?window:{},B=V.document||{head:{}},U={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,a,i)=>e.addEventListener(t,a,i),rel:(e,t,a,i)=>e.removeEventListener(t,a,i),ce:(e,t)=>new CustomEvent(e,t)},R=e=>Promise.resolve(e),F=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch(e){}return!1})(),J=new WeakMap,q=e=>{const t=e.$cmpMeta$,a=e.$hostElement$,i=(t.$tagName$,()=>{});((e,t,a,i)=>{let s=K(t);const n=Se.get(s);if(e=11===e.nodeType?e:B,n)if("string"==typeof n){e=e.head||e;let t,a=J.get(e);a||J.set(e,a=new Set),a.has(s)||(t=B.createElement("style"),t.innerHTML=n,e.insertBefore(t,e.querySelector("link")),a&&a.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n])})(a.getRootNode(),t),i()},K=(e,t)=>"sc-"+e.$tagName$,W={},H=e=>"object"===(e=typeof e)||"function"===e,Y=e("h",(function(e,t){let a=null,i=null,s=!1,n=!1;const o=[],l=t=>{for(let i=0;i<t.length;i++)a=t[i],Array.isArray(a)?l(a):null!=a&&"boolean"!=typeof a&&((s="function"!=typeof e&&!H(a))&&(a=String(a)),s&&n?o[o.length-1].$text$+=a:o.push(s?X(null,a):a),n=s)};for(var r=arguments.length,d=new Array(r>2?r-2:0),c=2;c<r;c++)d[c-2]=arguments[c];if(l(d),t){t.key&&(i=t.key);{const e=t.className||t.class;e&&(t.class="object"!=typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}}const m=X(e,null);return m.$attrs$=t,o.length>0&&(m.$children$=o),m.$key$=i,m})),X=(e,t)=>{const a={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null,$attrs$:null,$key$:null};return a},G=e("H",{}),Q=(e,t,a,i,s,n)=>{if(a!==i){let o=Me(e,t),l=t.toLowerCase();if("class"===t){const t=e.classList,s=ee(a),n=ee(i);t.remove(...s.filter((e=>e&&!n.includes(e)))),t.add(...n.filter((e=>e&&!s.includes(e))))}else if("style"===t){for(const t in a)i&&null!=i[t]||(t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in i)a&&i[t]===a[t]||(t.includes("-")?e.style.setProperty(t,i[t]):e.style[t]=i[t])}else if("key"===t);else if("ref"===t)i&&i(e);else if(o||"o"!==t[0]||"n"!==t[1]){const l=H(i);if((o||l&&null!==i)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{const s=null==i?"":i;"list"===t?o=!1:null!=a&&e[t]==s||(e[t]=s)}}catch(e){}null==i||!1===i?!1===i&&""!==e.getAttribute(t)||e.removeAttribute(t):(!o||4&n||s)&&!l&&(i=!0===i?"":i,e.setAttribute(t,i))}else t="-"===t[2]?t.slice(3):Me(V,l)?l.slice(2):l[2]+t.slice(3),a&&U.rel(e,t,a,!1),i&&U.ael(e,t,i,!1)}},Z=/\s/,ee=e=>e?e.split(Z):[],te=(e,t,a,i)=>{const s=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||W,o=t.$attrs$||W;for(i in n)i in o||Q(s,i,n[i],void 0,a,t.$flags$);for(i in o)Q(s,i,n[i],o[i],a,t.$flags$)},ae=(e,t,a,i)=>{const s=t.$children$[a];let n,o,l=0;if(null!==s.$text$)n=s.$elm$=B.createTextNode(s.$text$);else{if(N||(N="svg"===s.$tag$),n=s.$elm$=B.createElementNS(N?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",s.$tag$),N&&"foreignObject"===s.$tag$&&(N=!1),te(null,s,N),s.$children$)for(l=0;l<s.$children$.length;++l)o=ae(e,s,l),o&&n.appendChild(o);"svg"===s.$tag$?N=!1:"foreignObject"===n.tagName&&(N=!0)}return n},ie=(e,t,a,i,s,n)=>{let o,l=e;for(;s<=n;++s)i[s]&&(o=ae(null,a,s),o&&(i[s].$elm$=o,l.insertBefore(o,t)))},se=(e,t,a,i,s)=>{for(;t<=a;++t)(i=e[t])&&(s=i.$elm$,le(i),s.remove())},ne=(e,t)=>e.$tag$===t.$tag$&&e.$key$===t.$key$,oe=(e,t)=>{const a=t.$elm$=e.$elm$,i=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;null===o?(N="svg"===n||"foreignObject"!==n&&N,te(e,t,N),null!==i&&null!==s?((e,t,a,i)=>{let s,n,o=0,l=0,r=0,d=0,c=t.length-1,m=t[0],u=t[c],p=i.length-1,h=i[0],g=i[p];for(;o<=c&&l<=p;)if(null==m)m=t[++o];else if(null==u)u=t[--c];else if(null==h)h=i[++l];else if(null==g)g=i[--p];else if(ne(m,h))oe(m,h),m=t[++o],h=i[++l];else if(ne(u,g))oe(u,g),u=t[--c],g=i[--p];else if(ne(m,g))oe(m,g),e.insertBefore(m.$elm$,u.$elm$.nextSibling),m=t[++o],g=i[--p];else if(ne(u,h))oe(u,h),e.insertBefore(u.$elm$,m.$elm$),u=t[--c],h=i[++l];else{for(r=-1,d=o;d<=c;++d)if(t[d]&&null!==t[d].$key$&&t[d].$key$===h.$key$){r=d;break}r>=0?(n=t[r],n.$tag$!==h.$tag$?s=ae(t&&t[l],a,r):(oe(n,h),t[r]=void 0,s=n.$elm$),h=i[++l]):(s=ae(t&&t[l],a,l),h=i[++l]),s&&m.$elm$.parentNode.insertBefore(s,m.$elm$)}o>c?ie(e,null==i[p+1]?null:i[p+1].$elm$,a,i,l,p):l>p&&se(t,o,c)})(a,i,t,s):null!==s?(null!==e.$text$&&(a.textContent=""),ie(a,null,t,s,0,s.length-1)):null!==i&&se(i,0,i.length-1),N&&"svg"===n&&(N=!1)):e.$text$!==o&&(a.data=o)},le=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(le)},re=(e,t)=>{const a=e.$hostElement$,i=e.$vnode$||X(null,null),s=(n=t)&&n.$tag$===G?t:Y(null,null,t);var n;s.$tag$=null,s.$flags$|=4,e.$vnode$=s,s.$elm$=i.$elm$=a,oe(i,s)},de=(e("a",((e,t,a)=>{const i=(e=>Oe(e).$hostElement$)(e);return{emit:e=>de(i,t,{bubbles:!!(4&a),composed:!!(2&a),cancelable:!!(1&a),detail:e})}})),(e,t,a)=>{const i=U.ce(t,a);return e.dispatchEvent(i),i}),ce=(e,t)=>{t&&!e.$onRenderResolve$&&t["s-p"]&&t["s-p"].push(new Promise((t=>e.$onRenderResolve$=t)))},me=(e,t)=>{if(e.$flags$|=16,4&e.$flags$)return void(e.$flags$|=512);ce(e,e.$ancestorComponent$);return Pe((()=>ue(e,t)))},ue=(e,t)=>{const a=(e.$cmpMeta$.$tagName$,()=>{}),i=e.$lazyInstance$;let s;return t&&(s=fe(i,"componentWillLoad")),a(),ve(s,(()=>pe(e,i,t)))},pe=async(e,t,a)=>{const i=e.$hostElement$,s=(e.$cmpMeta$.$tagName$,()=>{}),n=i["s-rc"];a&&q(e);const o=(e.$cmpMeta$.$tagName$,()=>{});he(e,t),n&&(n.map((e=>e())),i["s-rc"]=void 0),o(),s();{const t=i["s-p"],a=()=>ge(e);0===t.length?a():(Promise.all(t).then(a),e.$flags$|=4,t.length=0)}},he=(e,t,a)=>{try{_=t,t=t.render(),e.$flags$&=-17,e.$flags$|=2,re(e,t)}catch(t){De(t,e.$hostElement$)}return _=null,null},ge=(e("g",(()=>_)),e=>{e.$cmpMeta$.$tagName$;const t=e.$hostElement$,a=()=>{},i=e.$lazyInstance$,s=e.$ancestorComponent$;64&e.$flags$?a():(e.$flags$|=64,ye(t),fe(i,"componentDidLoad"),a(),e.$onReadyResolve$(t),s||be()),e.$onInstanceResolve$(t),e.$onRenderResolve$&&(e.$onRenderResolve$(),e.$onRenderResolve$=void 0),512&e.$flags$&&_e((()=>me(e,!1))),e.$flags$&=-517}),be=(e("f",(e=>{{const t=Oe(e),a=t.$hostElement$.isConnected;return a&&2==(18&t.$flags$)&&me(t,!1),a}})),e=>{ye(B.documentElement),_e((()=>de(V,"appload",{detail:{namespace:"ibiz-runtime-model"}})))}),fe=(e,t,a)=>{if(e&&e[t])try{return e[t](a)}catch(e){De(e)}},ve=(e,t)=>e&&e.then?e.then(t):t(),ye=e=>e.classList.add("hydrated"),we=(e,t,a,i)=>{const s=Oe(e),n=s.$hostElement$,o=s.$instanceValues$.get(t),l=s.$flags$,r=s.$lazyInstance$;var d,c;d=a,c=i.$members$[t][0],a=null==d||H(d)?d:4&c?"false"!==d&&(""===d||!!d):2&c?parseFloat(d):1&c?String(d):d;const m=Number.isNaN(o)&&Number.isNaN(a);if((!(8&l)||void 0===o)&&(a!==o&&!m)&&(s.$instanceValues$.set(t,a),r)){if(i.$watchers$&&128&l){const e=i.$watchers$[t];e&&e.map((e=>{try{r[e](a,o,t)}catch(e){De(e,n)}}))}2==(18&l)&&me(s,!1)}},$e=(e,t,a)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),s=e.prototype;if(i.map((e=>{let[i,[n]]=e;31&n||2&a&&32&n?Object.defineProperty(s,i,{get(){return((e,t)=>Oe(e).$instanceValues$.get(t))(this,i)},set(e){we(this,i,e,t)},configurable:!0,enumerable:!0}):1&a&&64&n&&Object.defineProperty(s,i,{value(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];const s=Oe(this);return s.$onInstancePromise$.then((()=>s.$lazyInstance$[i](...t)))}})})),1&a){const t=new Map;s.attributeChangedCallback=function(e,a,i){U.jmp((()=>{const a=t.get(e);if(this.hasOwnProperty(a))i=this[a],delete this[a];else if(s.hasOwnProperty(a)&&"number"==typeof this[a]&&this[a]==i)return;this[a]=(null!==i||"boolean"!=typeof this[a])&&i}))},e.observedAttributes=i.filter((e=>{let[t,a]=e;return 15&a[0]})).map((e=>{let[a,i]=e;const s=i[1]||a;return t.set(s,a),s}))}}return e},Ce=async(e,t,a,i,s)=>{if(0==(32&t.$flags$)){{if(t.$flags$|=32,(s=je(a)).then){const e=()=>{};s=await s,e()}s.isProxied||(a.$watchers$=s.watchers,$e(s,a,2),s.isProxied=!0);const e=(a.$tagName$,()=>{});t.$flags$|=8;try{new s(t)}catch(e){De(e)}t.$flags$&=-9,t.$flags$|=128,e()}if(s.style){let e=s.style;const t=K(a);if(!Se.has(t)){const i=(a.$tagName$,()=>{});((e,t,a)=>{let i=Se.get(e);F&&a?(i=i||new CSSStyleSheet,i.replace(t)):i=t,Se.set(e,i)})(t,e,!!(1&a.$flags$)),i()}}}const n=t.$ancestorComponent$,o=()=>me(t,!0);n&&n["s-rc"]?n["s-rc"].push(o):o()},Ie=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=()=>{},i=[],s=t.exclude||[],n=V.customElements,o=B.head,l=o.querySelector("meta[charset]"),r=B.createElement("style"),d=[];let c,m=!0;Object.assign(U,t),U.$resourcesUrl$=new URL(t.resourcesUrl||"./",B.baseURI).href,e.map((e=>{e[1].map((t=>{const a={$flags$:t[0],$tagName$:t[1],$members$:t[2],$listeners$:t[3]};a.$members$=t[2],a.$watchers$={};const o=a.$tagName$,l=class extends HTMLElement{constructor(e){super(e),ze(e=this,a)}connectedCallback(){c&&(clearTimeout(c),c=null),m?d.push(this):U.jmp((()=>(e=>{if(0==(1&U.$flags$)){const t=Oe(e),a=t.$cmpMeta$,i=(a.$tagName$,()=>{});if(!(1&t.$flags$)){t.$flags$|=1;{let a=e;for(;a=a.parentNode||a.host;)if(a["s-p"]){ce(t,t.$ancestorComponent$=a);break}}a.$members$&&Object.entries(a.$members$).map((t=>{let[a,[i]]=t;if(31&i&&e.hasOwnProperty(a)){const t=e[a];delete e[a],e[a]=t}})),Ce(0,t,a)}i()}})(this)))}disconnectedCallback(){U.jmp((()=>{return e=this,void(0==(1&U.$flags$)&&Oe(e));var e}))}componentOnReady(){return Oe(this).$onReadyPromise$}};a.$lazyBundleId$=e[0],s.includes(o)||n.get(o)||(i.push(o),n.define(o,$e(l,a,1)))}))})),r.innerHTML=i+"{visibility:hidden}.hydrated{visibility:inherit}",r.setAttribute("data-styles",""),o.insertBefore(r,l?l.nextSibling:o.firstChild),m=!1,d.length?d.map((e=>e.connectedCallback())):U.jmp((()=>c=setTimeout(be,30))),a()},xe=new WeakMap,Oe=e=>xe.get(e),ze=(e("r",((e,t)=>xe.set(t.$lazyInstance$=e,t))),(e,t)=>{const a={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return a.$onInstancePromise$=new Promise((e=>a.$onInstanceResolve$=e)),a.$onReadyPromise$=new Promise((e=>a.$onReadyResolve$=e)),e["s-p"]=[],e["s-rc"]=[],xe.set(e,a)}),Me=(e,t)=>t in e,De=(e,t)=>(0,console.error)(e,t),Ee=new Map,je=(e,a,i)=>{const s=e.$tagName$.replace(/-/g,"_"),n=e.$lazyBundleId$,o=Ee.get(n);if(o)return o[s];if(!i||!BUILD.hotModuleReplacement){const e=e=>(Ee.set(n,e),e[s]);if("ibiz-model-runtime_4"===n)return t.import("./ibiz-model-runtime_4.entry-RqgR0PuQ.js").then(e,De)}return t.import("./".concat(n,".entry.js")).then((e=>(Ee.set(n,e),e[s])),De)},Se=new Map,Ae=[],Te=[],ke=(e,t)=>a=>{e.push(a),P||(P=!0,t&&4&U.$flags$?_e(Ne):U.raf(Ne))},Le=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(e){De(e)}e.length=0},Ne=()=>{Le(Ae),Le(Te),(P=Ae.length>0)&&U.raf(Ne)},_e=e=>R().then(e),Pe=ke(Te,!0),Ve=(e,t)=>"undefined"==typeof window?Promise.resolve():R().then((()=>Ie([["ibiz-model-runtime_4",[[0,"ibiz-model-runtime",{url:[8],headers:[8],parentKey:[1,"parent-key"],configBaseUrl:[1,"config-base-url"],breadcrumbHoverIndex:[32]}],[0,"loading-mask",{visible:[32],show:[64],hide:[64]}],[0,"ibiz-model-runtime-list",{controller:[16],items:[16],index:[2],parent:[8],list:[32]}],[0,"loading-panel",{defaultShow:[4,"default-show"],visible:[32],message:[32],show:[64],hide:[64]}]]]],t)));!function(){if("undefined"!=typeof window&&void 0!==window.Reflect&&void 0!==window.customElements){var e=HTMLElement;window.HTMLElement=function(){return Reflect.construct(e,[],this.constructor)},HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}}();var Be=a({name:"IBizModelClipboard",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object},type:{type:String,default:"default"}},setup(e){const t=v("model-clipboard"),a=ibiz.modelClipboard;return{ns:t,controller:a,removeAll:async()=>{if(a.state.items.length>0){await ibiz.confirm.warning({title:"确认删除所有?",desc:"确认删除当前粘贴板的数据?"})&&a.clearAll(e.type)}},close:()=>{var t;null==(t=e.modal)||t.dismiss()}}},render(){let e;return i("div",{class:this.ns.b()},[i("div",{class:this.ns.b("header")},[i("div",{class:this.ns.b("header-title")},["".concat("advanced"===this.type?"高级":"","模型粘贴板")]),i("div",{class:this.ns.b("header-actions")},[i(s("el-button"),{size:"small",type:"info",onClick:()=>this.removeAll()},{default:()=>[n("清空")]}),i("ion-icon",{name:"close-outline",title:"关闭",onClick:()=>this.close()},null)])]),i("div",{class:this.ns.b("content")},[i(s("el-timeline"),null,(t=e=this.controller.state.items.filter((e=>e.type===this.type)).map((e=>i(s("iBizModelClipboardItem"),{key:e.uuid,context:this.context,params:this.params,data:e,onDelete:()=>this.controller.removeById(e.uuid)},null))),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!o(t)?e:{default:()=>[e]}))])]);var t}});const Ue={advanced:"CopyModel",default:"ExportModelV2"};var Re=a({name:"IBizModelClipboardItem",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},data:{type:Object,required:!0}},emits:["delete"],setup(e,{emit:t}){const a=v("model-clipboard-item"),i=ibiz.modelClipboard,s=l(!1),n=l(!1),o=r((()=>{let t="info";return e.data.isError?t="danger":e.data.isExport?t="success":s.value&&(t="warning"),t}));(async()=>{if(e.data&&!e.data.isExport){s.value=!0;for(let t=0;t<e.data.items.length;t++){const a=e.data.items[t];try{const t=await ibiz.hub.getAppDataEntity(e.data.codeName,e.context.srfappid),i=ibiz.hub.getApp(e.context.srfappid),s=await i.deService.getService(e.context,t.id),n=await s.exec(Ue[e.data.type],{...e.context,[t.deapicodeName]:a.srfkey},e.params);n.ok&&n.data&&e.data.models.push(n.data)}catch(t){e.data.isError=!0,e.data.errorInfo=t.message||"模型导出发生未知错误!",ibiz.message.error(e.data.errorInfo);break}if(n.value)break}e.data.isExport=!0,i.saveToStore(),setTimeout((()=>{s.value=!1}),300)}})();return d((()=>{n.value=!0})),{ns:a,stateType:o,isLoading:s,modelClipboardController:i,remove:()=>{t("delete")},copy:()=>{const t=document.createElement("textarea");t.style.position="absolute",t.style.left="-9999px",t.value=JSON.stringify(e.data.models.map((e=>e.model)),null,2),document.body.appendChild(t),t.select();const a=document.execCommand("copy");document.body.removeChild(t),a?ibiz.message.success("已复制模型数据至剪贴板"):ibiz.message.error("复制模型数据失败")}}},render(){return i(s("el-timeline-item"),{class:this.ns.b(),timestamp:this.data.createdDate,type:this.stateType,placement:"top"},{default:()=>[i(s("el-card"),{shadow:"hover"},{default:()=>[i("div",{class:this.ns.b("content")},[i("div",{class:this.ns.b("title")},[i(s("el-input"),{modelValue:this.data.title,"onUpdate:modelValue":e=>this.data.title=e,onChange:()=>{this.modelClipboardController.saveToStore()}},null)]),i("div",{class:this.ns.b("info")},[n("共"),this.data.items.length,n("条模型数据")]),i("div",{class:this.ns.b("actions")},[i("div",{class:this.ns.b("action"),onClick:()=>this.copy()},[i("ion-icon",{name:"copy",title:"拷贝"},null)]),i("div",{class:this.ns.b("action"),onClick:()=>this.remove()},[i("ion-icon",{name:"trash",title:"删除"},null)])])]),this.isLoading?i("div",{class:this.ns.b("loading-warp")},[i("div",{class:this.ns.b("loading-inner"),style:{width:"".concat(this.data.models.length/this.data.items.length*100,"%")}},[i("div",{class:this.ns.b("loading-label")},[this.data.models.length,n("/"),this.data.items.length])])]):null]})]})}}),Fe=a({name:"IBizModelClipboardImportView",components:{draggable:w},props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object}},setup(e){const t=v("model-clipboard-import-view"),a=ibiz.modelClipboard,i=ibiz.modelClipboardImportView,s=()=>{ibiz.message.warning("编辑框内，模型内容已重新计算!"),i.state.models=[],i.state.items.forEach((e=>{const t=e.models.map((e=>e.model)).filter((e=>!!e));i.state.models.push(...t)}));try{e=JSON.stringify(i.state.models,null,2),i.state.modelStr=e,i.state.isModelChange=!1}catch(e){ibiz.log.error(e)}var e},n=r((()=>a.state.items.filter((e=>!("default"!==e.type||!Object.is(i.state.params.codeName,e.codeName)||-1!==i.state.items.findIndex((t=>Object.is(t.uuid,e.uuid))))&&e))));return{ns:t,modelClipboardController:a,c:i,materialItem:n,closeView:async()=>{var t,a;if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认关闭",desc:"模型数据已变更，确认关闭吗?"})&&(null==(t=e.modal)||t.dismiss(),i.clearAllData())}else null==(a=e.modal)||a.dismiss()},clearModel:async()=>{if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认清除?",desc:"模型数据已变更，将同已拖入模型一同清空，确认清除吗？"})&&i.clearAllData()}else i.clearAllData()},formatData:()=>{try{i.state.modelStr=JSON.stringify(JSON.parse(i.state.modelStr),null,2)}catch(e){ibiz.message.error("格式有误无法格式化，请检查!",2.5)}},modelChange:e=>{Object.is(i.state.modelStr,e)||(i.state.modelStr=e,i.state.isModelChange=!0)},deleteDropItem:e=>{i.state.items.splice(e,1),s()},dropModelChange:async e=>{if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认操作?",desc:"检测到输入框内容已手动修改，该操作后输入框内容将重新计算，确认操作吗？"})?s():e&&e.added&&null!=e.added.newIndex&&i.state.items.splice(e.added.newIndex,1)}else s()},saveModel:async()=>{var t,a;try{const e=JSON.parse(i.state.modelStr);if(!Array.isArray(e))return void ibiz.message.error("模型数据格式异常，请检查!");i.state.models=e}catch(e){return void ibiz.message.error("模型数据格式异常，请检查!")}i.state.isLoading=!0,i.state.importItems=[];let s=!1;const n=await ibiz.hub.getAppDataEntity(i.state.params.codeName,e.context.srfappid),o=ibiz.hub.getApp(e.context.srfappid),l=await o.deService.getService(e.context,n.id);for(let a=0;a<i.state.models.length;a++){const n=i.state.models[a],o={srfmodelv2scope:e.context.srfmodelv2scope,model:n};try{const t=await l.exec("ImportModelV2",e.context,o,e.params);if(!t.ok||!t.data){ibiz.message.error(t.statusText),s=!0;break}i.state.isModelChange=!1,i.state.importItems.push(n)}catch(e){const a=e;ibiz.message.error((null==a?void 0:a.message)||(null==(t=null==a?void 0:a.data)?void 0:t.message)||(null==a?void 0:a.statusText)||ibiz.i18n.t("core.error.networkAbnormality")),s=!0;break}}if(!s){await ibiz.confirm.warning({title:"关闭导入界面?",desc:"已导入完毕，确认关闭导入界面!"})&&(null==(a=e.modal)||a.dismiss())}setTimeout((()=>{i.state.isLoading=!1}),300)}}},render(){const{isLoading:e,items:t,importItems:a,models:o,modelStr:l}=this.c.state;return c(i(s("el-card"),{class:this.ns.b()},{header:()=>i("div",{class:this.ns.b("header")},[i("span",null,[n("模型导入")]),i(s("el-button"),{title:"关闭模型导入窗口",link:!0,onClick:()=>this.closeView()},{default:()=>[n("关闭")]})]),default:()=>i("div",{class:this.ns.b("content")},[i("div",{class:this.ns.b("import-warp")},[i("div",{class:this.ns.b("drop-area")},[i(w,{class:this.ns.b("drop-area-draggable"),group:{name:"StudioDesign"},itemKey:"uuid",list:t,onChange:e=>this.dropModelChange(e)},{item:({element:e,index:t})=>{const a=e;return i("div",{class:this.ns.b("model-drag-item")},[i("div",{class:this.ns.b("model-drag-item-actions")},[i("div",{class:this.ns.b("model-drag-item-action-item"),title:"删除",onClick:()=>this.deleteDropItem(t)},[i("ion-icon",{name:"close-outline"},null)])]),i("div",{class:this.ns.b("model-drag-item-title")},[a.title]),i("div",{class:this.ns.b("model-drag-item-date")},[a.createdDate])])}}),c(i("div",{class:this.ns.b("drop-tooltip")},[n("请从右侧素材区拖入")]),[[m,0===t.length]])]),i("div",{class:this.ns.b("model-edit")},[i(s("iBizDesignCodeEditor"),{language:"json",modelValue:l,isChangeLanguage:!1,"onUpdate:modelValue":e=>this.modelChange(e)},{rightToolbar:()=>i("div",{class:this.ns.b("edit-actions")},[i(s("el-button"),{title:"清空当前已拖入模型",size:"small",type:"info",onClick:()=>this.clearModel()},{default:()=>[n("清空")]}),i(s("el-button"),{title:"格式化编辑框内JSON数据",size:"small",type:"info",onClick:()=>this.formatData()},{default:()=>[n("格式化")]}),i(s("el-button"),{title:"导入模型数据",size:"small",type:"primary",onClick:()=>this.saveModel()},{default:()=>[n("导入")]})])})])]),i("div",{class:this.ns.b("model-material-warp")},[i("div",{class:this.ns.b("model-material-title")},[n("模型素材")]),i(w,{class:this.ns.b("model-material-content"),sort:!1,group:{name:"StudioDesign",pull:"clone",put:!1},itemKey:"uuid",modelValue:this.materialItem},{item:({element:e})=>{const t=e;return i("div",{class:this.ns.b("model-material-item")},[i("div",{class:this.ns.b("model-material-item-title")},[t.title]),i("div",{class:this.ns.b("model-material-item-date")},[t.createdDate])])}}),c(i("div",{class:this.ns.b("model-material-tooltip")},[n("暂无数据")]),[[m,0===this.materialItem.length]])])])}),[[u("loading"),e&&{text:"数据导入中：".concat(a.length," / ").concat(o.length)}]])}}),Je=a({name:"IBizModelClipboardPasteView",components:{draggable:w},props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object}},setup(e){const t=v("model-clipboard-paste-view"),a=ibiz.modelClipboard,i=ibiz.modelClipboardPasteView,s=l("ModeTree"),n=()=>{ibiz.message.warning("编辑框内，模型内容已重新计算!"),i.state.models=[],i.state.items.forEach((e=>{i.state.models.push(...e.models)}));try{e=JSON.stringify(i.state.models,null,2),i.state.modelStr=e,i.state.isModelChange=!1}catch(e){ibiz.log.error(e)}var e},o=r((()=>a.state.items.filter((e=>!("advanced"!==e.type||!Object.is(i.state.params.codeName,e.codeName)||-1!==i.state.items.findIndex((t=>Object.is(t.uuid,e.uuid))))&&e))));return{c:i,ns:t,activeName:s,materialItem:o,modelClipboardController:a,closeView:async()=>{var t,a;if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认关闭",desc:"模型数据已变更，确认关闭吗?"})&&(null==(t=e.modal)||t.dismiss(),i.clearAllData())}else null==(a=e.modal)||a.dismiss()},clearModel:async()=>{if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认清除?",desc:"模型数据已变更，将同已拖入模型一同清空，确认清除吗？"})&&i.clearAllData()}else i.clearAllData()},formatData:()=>{try{i.state.modelStr=JSON.stringify(JSON.parse(i.state.modelStr),null,2)}catch(e){ibiz.message.error("格式有误无法格式化，请检查!",2.5)}},modelChange:e=>{Object.is(i.state.modelStr,e)||(i.state.modelStr=e,i.state.isModelChange=!0)},deleteDropItem:e=>{i.state.items.splice(e,1),n()},dropModelChange:async e=>{if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认操作?",desc:"检测到输入框内容已手动修改，该操作后输入框内容将重新计算，确认操作吗？"})?n():e&&e.added&&null!=e.added.newIndex&&i.state.items.splice(e.added.newIndex,1)}else n()},saveModel:async()=>{var t,a;try{const e=JSON.parse(i.state.modelStr);if(!Array.isArray(e))return void ibiz.message.error("模型数据格式异常，请检查!");i.state.models=e}catch(e){return void ibiz.message.error("模型数据格式异常，请检查!")}i.state.isLoading=!0,i.state.importItems=[];let s=!1;const n=await ibiz.hub.getAppDataEntity(i.state.params.codeName,e.context.srfappid),o=ibiz.hub.getApp(e.context.srfappid),l=await o.deService.getService(e.context,n.id);for(let a=0;a<i.state.models.length;a++){const n=i.state.models[a],o={...n,srfmodelv2scope:e.context.srfmodelv2scope};try{const t=await l.exec("PasteModel",e.context,o,e.params);if(!t.ok||!t.data){ibiz.message.error(t.statusText),s=!0;break}i.state.isModelChange=!1,i.state.importItems.push(n)}catch(e){const a=e;ibiz.message.error((null==a?void 0:a.message)||(null==(t=null==a?void 0:a.data)?void 0:t.message)||(null==a?void 0:a.statusText)||ibiz.i18n.t("core.error.networkAbnormality")),s=!0;break}}if(!s){await ibiz.confirm.warning({title:"关闭导入界面?",desc:"已导入完毕，确认关闭导入界面!"})&&(null==(a=e.modal)||a.dismiss())}setTimeout((()=>{i.state.isLoading=!1}),300)}}},render(){const{isLoading:e,items:t,importItems:a,models:o,modelStr:l}=this.c.state;return c(i(s("el-card"),{class:this.ns.b()},{header:()=>i("div",{class:this.ns.b("header")},[i("span",null,[n("模型导入")]),i(s("el-button"),{title:"关闭模型导入窗口",link:!0,onClick:()=>this.closeView()},{default:()=>[n("关闭")]})]),default:()=>i("div",{class:this.ns.b("content")},[i("div",{class:this.ns.b("paste-warp")},[i("div",{class:this.ns.b("drop-area")},[i(w,{class:this.ns.b("drop-area-draggable"),group:{name:"StudioDesign"},itemKey:"uuid",list:t,onChange:e=>this.dropModelChange(e)},{item:({element:e,index:t})=>{const a=e;return i("div",{class:this.ns.b("model-drag-item")},[i("div",{class:this.ns.b("model-drag-item-actions")},[i("div",{class:this.ns.b("model-drag-item-action-item"),title:"删除",onClick:()=>this.deleteDropItem(t)},[i("ion-icon",{name:"close-outline"},null)])]),i("div",{class:this.ns.b("model-drag-item-title")},[a.title]),i("div",{class:this.ns.b("model-drag-item-date")},[a.createdDate])])}}),c(i("div",{class:this.ns.b("drop-tooltip")},[n("请从右侧素材区拖入")]),[[m,0===t.length]])]),i("div",{class:this.ns.b("model-edit")},[i(s("el-tabs"),{class:this.ns.be("model-edit","tabs"),modelValue:this.activeName,"onUpdate:modelValue":e=>this.activeName=e},{default:()=>[i(s("el-tab-pane"),{label:"树结构查看",name:"ModeTree"},{default:()=>[i(s("iBizModelTree"),{modelStr:l,context:this.context,onChange:this.modelChange},null)]}),i(s("el-tab-pane"),{label:"JSON",name:"JSON"},{default:()=>[i(s("iBizDesignCodeEditor"),{language:"json",showToolbar:!1,modelValue:l,isChangeLanguage:!1,"onUpdate:modelValue":e=>this.modelChange(e)},null)]})]}),i("div",{class:this.ns.b("edit-actions")},[i(s("el-button"),{title:"清空当前已拖入模型",size:"small",type:"info",onClick:()=>this.clearModel()},{default:()=>[n("清空")]}),i(s("el-button"),{title:"格式化编辑框内JSON数据",size:"small",type:"info",onClick:()=>this.formatData()},{default:()=>[n("格式化")]}),i(s("el-button"),{title:"导入模型数据",size:"small",type:"primary",onClick:()=>this.saveModel()},{default:()=>[n("导入")]})])])]),i("div",{class:this.ns.b("model-material-warp")},[i("div",{class:this.ns.b("model-material-title")},[n("模型素材")]),i(w,{class:this.ns.b("model-material-content"),sort:!1,group:{name:"StudioDesign",pull:"clone",put:!1},itemKey:"uuid",modelValue:this.materialItem},{item:({element:e})=>{const t=e;return i("div",{class:this.ns.b("model-material-item")},[i("div",{class:this.ns.b("model-material-item-title")},[t.title]),i("div",{class:this.ns.b("model-material-item-date")},[t.createdDate])])}}),c(i("div",{class:this.ns.b("model-material-tooltip")},[n("暂无数据")]),[[m,0===this.materialItem.length]])])])}),[[u("loading"),e&&{text:"数据导入中：".concat(a.length," / ").concat(o.length)}]])}});function qe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function We(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(a),!0).forEach((function(t){qe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ke(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function He(e,t){if(null==e)return{};var a,i,s=function(e,t){if(null==e)return{};var a,i,s={},n=Object.keys(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function Xe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ge(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function Qe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(a),!0).forEach((function(t){Xe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ge(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ze(e){return function t(){for(var a=this,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return s.length>=e.length?e.apply(this,s):function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t.apply(a,[].concat(s,i))}}}function et(e){return{}.toString.call(e).includes("Object")}function tt(e){return"function"==typeof e}var at=Ze((function(e,t){throw new Error(e[t]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),it={changes:function(e,t){return et(t)||at("changeType"),Object.keys(t).some((function(t){return a=e,i=t,!Object.prototype.hasOwnProperty.call(a,i);var a,i}))&&at("changeField"),t},selector:function(e){tt(e)||at("selectorType")},handler:function(e){tt(e)||et(e)||at("handlerType"),et(e)&&Object.values(e).some((function(e){return!tt(e)}))&&at("handlersType")},initial:function(e){var t;e||at("initialIsRequired"),et(e)||at("initialType"),t=e,Object.keys(t).length||at("initialContent")}};function st(e,t){return tt(t)?t(e.current):t}function nt(e,t){return e.current=Qe(Qe({},e.current),t),t}function ot(e,t,a){return tt(t)?t(e.current):Object.keys(a).forEach((function(a){var i;return null===(i=t[a])||void 0===i?void 0:i.call(t,e.current[a])})),a}var lt={create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};it.initial(e),it.handler(t);var a={current:e},i=Ze(ot)(a,t),s=Ze(nt)(a),n=Ze(it.changes)(e),o=Ze(st)(a);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return it.selector(e),e(a.current)},function(e){!function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}(i,s,n,o)(e)}]}};var rt,dt={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},ct=(rt=function(e,t){throw new Error(e[t]||e.default)},function e(){for(var t=this,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return i.length>=rt.length?rt.apply(this,i):function(){for(var a=arguments.length,s=new Array(a),n=0;n<a;n++)s[n]=arguments[n];return e.apply(t,[].concat(i,s))}})(dt),mt={config:function(e){var t;return e||ct("configIsRequired"),t=e,{}.toString.call(t).includes("Object")||ct("configType"),e.urls?(console.warn(dt.deprecation),{paths:{vs:e.urls.monacoBase}}):e}};function ut(e,t){return Object.keys(t).forEach((function(a){t[a]instanceof Object&&e[a]&&Object.assign(t[a],ut(e[a],t[a]))})),We(We({},e),t)}var pt={type:"cancelation",msg:"operation is manually canceled"};function ht(e){var t=!1,a=new Promise((function(a,i){e.then((function(e){return t?i(pt):a(e)})),e.catch(i)}));return a.cancel=function(){return t=!0},a}var gt,bt,ft=lt.create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}),vt=(bt=2,function(e){if(Array.isArray(e))return e}(gt=ft)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],i=!0,s=!1,n=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw n}}return a}}(gt,bt)||function(e,t){if(e){if("string"==typeof e)return Ye(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ye(e,t):void 0}}(gt,bt)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),yt=vt[0],wt=vt[1];function $t(e){return document.body.appendChild(e)}function Ct(e){var t,a,i=yt((function(e){return{config:e.config,reject:e.reject}})),s=(t="".concat(i.config.paths.vs,"/loader.js"),a=document.createElement("script"),t&&(a.src=t),a);return s.onload=function(){return e()},s.onerror=i.reject,s}function It(){var e=yt((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],(function(t){xt(t),e.resolve(t)}),(function(t){e.reject(t)}))}function xt(e){yt().monaco||wt({monaco:e})}var Ot=new Promise((function(e,t){return wt({resolve:e,reject:t})})),zt={config:function(e){var t=mt.config(e),a=t.monaco,i=He(t,["monaco"]);wt((function(e){return{config:ut(e.config,i),monaco:a}}))},init:function(){var e=yt((function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}}));if(!e.isInitialized){if(wt({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ht(Ot);if(window.monaco&&window.monaco.editor)return xt(window.monaco),e.resolve(window.monaco),ht(Ot);!function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}($t,Ct)(It)}return ht(Ot)},__getMonacoInstance:function(){return yt((function(e){return e.monaco}))}};var Mt=a({name:"IBizDesignCodeEditor",props:{modelValue:String,language:{type:String,default:"json"},readonly:{type:Boolean,default:!1},minimap:{type:Boolean,default:!0},isChangeLanguage:{type:Boolean,default:!0},showToolbar:{type:Boolean,default:!0},isEnableLoad:{type:Boolean,default:!0},deACMode:{type:Object},openAIChat:{type:Function},enableCompletion:{type:Boolean,default:!1},provideCompletionItems:{type:Function},expandSuggestDetails:{type:Boolean,default:!1}},emits:{"update:modelValue":e=>!0},setup(e,{emit:t}){const a=v("design-code-editor"),i=l(),s=l(),n=$();let o,r,c,m;const u=l(["json","javascript","typescript","css","less","sass","java","sql","vue","python"]),b=l(e.language),f=l(!1),{UIStore:w}=y(),C=e=>"dark"===e?"vs-".concat(w.theme):"vs";p((()=>w.theme),(e=>{c.setTheme(C(e))})),p((()=>e.modelValue),(()=>{o&&e.modelValue!==o.getValue()&&o.setValue(e.modelValue||"")}),{immediate:!0});const I=e=>{const t=c.getEditors().find((t=>t.getModel()===e));return!(!t||t.__instanceId!==n)},x=()=>{s.value&&g((()=>{f.value=!0,zt.config({paths:{vs:"".concat(ibiz.env.pluginBaseUrl,"/monaco-editor@0.45.0/min/vs")}}),zt.init().then((a=>{var i,l,d;f.value=!1,o||s.value&&a&&(c=a.editor,a.languages.register({id:"groovy"}),a.languages.setMonarchTokensProvider("groovy",{tokenizer:{root:[[/\/\/.*$/,"comment"],[/\/\*/,"comment","@comment"],[/(println|def|return|if|else|for|while|psdelogic|psdelogicparam|psdelogicnode|psdelogiclink)\b/,"keyword"],[/"[^"]*"/,"string"],[/'[^']*'/,"string"],[/\d+/,"number"],[/[\+\-\*\/=<>!]+/,"operator"]],comment:[[/.*?\*\//,"comment","@pop"],[/.*/,"comment"]]}}),o=c.create(s.value,{language:b.value,theme:C(w.theme),minimap:{enabled:e.minimap},readOnly:e.readonly,readOnlyMessage:{value:ibiz.i18n.t("editor.code.readOnlyPrompt")},value:e.modelValue,wordWrap:"on"}),e.expandSuggestDetails&&(null==(d=null==(l=null==(i=o.getContribution("editor.contrib.suggestController"))?void 0:i.widget)?void 0:l.value)||d._setDetailsVisible(!0)),o.__instanceId=n,e.deACMode&&e.openAIChat&&ibiz.env.enableAI&&(r=a.languages.registerCodeLensProvider(b.value,{provideCodeLenses:(t,i)=>I(t)?{lenses:[{id:"AI",range:new a.Range(1,1,1,1),command:{title:"".concat(e.deACMode.logicName),id:o.addCommand(0,(()=>{e.openAIChat()}))}}],dispose:()=>{}}:{lenses:[],dispose:()=>{}},resolveCodeLens:(e,t,a)=>t})),e.enableCompletion&&(m=a.languages.registerCompletionItemProvider(b.value,{triggerCharacters:["-","--"],provideCompletionItems:(t,a)=>I(t)&&e.provideCompletionItems?e.provideCompletionItems?e.provideCompletionItems(t,a):void 0:{suggestions:[]}})),o.onDidChangeModelContent((()=>{o&&t("update:modelValue",o.getValue())})))})).catch((()=>{f.value=!1}))}))},O=l(!1),z=()=>{null==o||o.layout()},M=()=>{O.value=!!document.fullscreenElement};let D;return h((()=>{x(),window.addEventListener("resize",z),i.value&&(i.value.addEventListener("fullscreenchange",M),D=new ResizeObserver((()=>{z()})),D.observe(i.value))})),d((()=>{var e;window.removeEventListener("resize",z),null==(e=i.value)||e.removeEventListener("fullscreenchange",M),null==D||D.disconnect(),null==r||r.dispose(),null==m||m.dispose()})),{ns:a,editor:o,containerRef:i,editorRef:s,languages:u,currentLanguage:b,isFullScreen:O,isLoading:f,handleLanguageChange:()=>{null==o||o.dispose(),o=void 0,x(),o&&o.layout()},onToolBarClick:async e=>{if(O.value=e,!s.value)return;const t=i.value;t&&(O.value?t.requestFullscreen():(await document.exitFullscreen(),null==o||o.dispose(),o=void 0,x(),o&&o.layout()))}}},render(){var e,t;let a;return c(i("div",{class:[this.ns.b(),this.ns.is("full-screen",this.isFullScreen)],ref:"containerRef"},[this.showToolbar&&i("div",{class:this.ns.b("toolbar")},[i("div",{class:this.ns.b("left-toolbar")},[i(s("el-select"),{modelValue:this.currentLanguage,"onUpdate:modelValue":e=>this.currentLanguage=e,disabled:!this.isChangeLanguage,onChange:this.handleLanguageChange,teleported:!1},(n=a=this.languages.map((e=>i(s("el-option"),{key:e,label:e,value:e},null))),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!o(n)?a:{default:()=>[a]}))]),i("div",{class:this.ns.b("right-toolbar")},[null==(t=(e=this.$slots).rightToolbar)?void 0:t.call(e),this.isFullScreen?i("ion-icon",{title:"退出全屏",name:"contract-outline",onClick:()=>this.onToolBarClick(!1)},null):i("ion-icon",{title:"全屏",name:"resize-outline",onClick:()=>this.onToolBarClick(!0)},null)])]),i("div",{class:this.ns.b("content"),ref:"editorRef"},null)]),[[u("loading"),this.isEnableLoad&&this.isLoading]]);var n}}),Dt=a({name:"IBizModelEditView",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object},caption:{type:String,default:""},codeName:{type:String,required:!0},readonly:{type:Boolean}},setup(e){const t=v("model-edit-view"),a=l(!1),i=l(""),s=()=>{var t;null==(t=e.modal)||t.dismiss({ok:!0,params:{isSave:a.value}})},n=l(!1),o=l("");return(async()=>{try{n.value=!0,o.value="加载中...";const t=await ibiz.hub.getAppDataEntity(e.codeName,e.context.srfappid),a=ibiz.hub.getApp(e.context.srfappid),s=await a.deService.getService(e.context,t.id),l=await s.exec("ExportModelV2",e.context,{},e.params);200===l.status&&l.data&&l.data.model&&(i.value=JSON.stringify(l.data.model,null,4))}catch(e){const t=e;ibiz.message.error(t.message||ibiz.i18n.t("core.error.networkAbnormality"))}finally{n.value=!1}})(),{ns:t,value:i,loading:n,loadingText:o,closeView:s,save:async(t=!1)=>{var l,r,d;try{JSON.parse(i.value)}catch(e){return void ibiz.message.error("模型数据格式异常，请检查!")}a.value=!0;try{n.value=!0,o.value="保存中...";const a=await ibiz.hub.getAppDataEntity(e.codeName,e.context.srfappid),d=ibiz.hub.getApp(e.context.srfappid),c=await d.deService.getService(e.context,a.id),m=(null==(l=a.codeName)?void 0:l.toLowerCase())||"",u={[a.keyAppDEFieldId]:e.context[m],srfmodelv2scope:e.context.srfmodelv2scope,model:JSON.parse(i.value)},p=await c.exec("ImportModelV2",e.context,u,e.params);200!==p.status?ibiz.message.error((null==(r=p.data)?void 0:r.message)||p.statusText||ibiz.i18n.t("core.error.networkAbnormality")):t&&s()}catch(e){const t=e;ibiz.message.error((null==t?void 0:t.message)||(null==(d=null==t?void 0:t.data)?void 0:d.message)||(null==t?void 0:t.statusText)||ibiz.i18n.t("core.error.networkAbnormality"))}finally{n.value=!1}}}},render(){return c(i("div",{class:this.ns.b(),"element-loading-text":this.loadingText},[i("div",{class:this.ns.b("header")},[i("div",{class:this.ns.b("header-back-btn"),onClick:()=>this.closeView()},[i("ion-icon",{name:"chevron-back-outline"},null),i("span",null,[n("返回")])]),i("div",{class:this.ns.b("header-caption")},[this.caption]),i("div",{class:this.ns.b("header-toolbar")},[this.readonly?null:[i(s("el-button"),{size:"small",onClick:()=>this.save(!0)},{default:()=>[n("保存并关闭")]}),i(s("el-button"),{size:"small",onClick:()=>this.save()},{default:()=>[n("保存")]})],i(s("el-button"),{size:"small",onClick:()=>this.closeView()},{default:()=>[n("关闭")]})]),i("div",{class:this.ns.b("header-close-btn"),title:"关闭",onClick:()=>this.closeView()},[i("ion-icon",{name:"close-outline"},null)])]),i("div",{class:this.ns.b("content")},[i(s("iBizDesignCodeEditor"),{language:"json",isChangeLanguage:!1,modelValue:this.value,"onUpdate:modelValue":e=>this.value=e,isEnableLoad:!this.loading},null)])]),[[u("loading"),this.loading]])}}),Et=Object.defineProperty,jt=(e,t,a)=>(((e,t,a)=>{t in e?Et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class St{constructor(e,t,a){var i;jt(this,"_id"),jt(this,"_text"),jt(this,"_nodeType"),jt(this,"_nodeId"),jt(this,"_leaf"),jt(this,"_data"),jt(this,"_icon"),jt(this,"_refAppDataEntityId"),jt(this,"_label"),jt(this,"_value"),jt(this,"_model"),jt(this,"_parent"),jt(this,"_children");const{id:s,model:n,text:o,label:l,refAppDataEntityId:r}=a;return this._nodeId=s,this._data=e,this._model=n,this._parent=t,this._id=this._parent?"".concat(this._parent._id,".").concat(s):"ROOT.".concat(s),Object.defineProperty(this,"_value",{get(){return this._data[this._nodeId]},set(e){this._data[this._nodeId]=e},enumerable:!0,configurable:!0}),Object.defineProperty(this,"_leaf",{get(){let e=!0;return(Array.isArray(this._value)||null!==this._value&&"object"==typeof this._value)&&(e=!1),e},set(e){},enumerable:!0,configurable:!0}),Object.defineProperty(this,"_nodeType",{get(){var e,t;let a="STATIC";switch(this._nodeId){case"model":a="JSONSCHEMA";break;case"requires":case"_children":a="DE";break;default:"DE"!==(null==(e=this._parent)?void 0:e._nodeType)&&"JSONSCHEMA"!==(null==(t=this._parent)?void 0:t._nodeType)||(a="JSONSCHEMA")}return a},set(e){},enumerable:!0,configurable:!0}),this._text=o,this._label=this.calcLabel(l),this._icon=this.calcIcon(),this._refAppDataEntityId=r||(null==(i=this._parent)?void 0:i._refAppDataEntityId),new Proxy(this,{set:(e,t,a)=>(e[t]=a,!0),get:(e,t,a)=>e[t]})}calcLabel(e){let t="";switch(this._nodeId){case"modeltype":t="模型类型";break;case"model":t="当前模型";break;case"requires":t="关联模型";break;case"_children":t="子模型";break;default:t=e}return t}calcIcon(){let e="VARIABLE";return Array.isArray(this._value)?e="ARRAY":null!==this._value&&"object"==typeof this._value&&(e="OBJECT"),e}}var At=Object.defineProperty,Tt=(e,t,a)=>(((e,t,a)=>{t in e?At(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class kt{constructor(e,t){this.context=e,this.data=t,Tt(this,"entityFeildMap",new Map),Tt(this,"entityFieldItemMap",new Map)}async fetchChildNodes(e){let t=[];return t=e?await this.getChildrenNodeData(e):await this.getRootNodeData(),t}async getRootNodeData(){return await Promise.all(this.data.value.map(((e,t)=>this.getModelTreeNodeData(t,this.data.value))))}async getChildrenNodeData(e){const t=e._value;let a=[];return Array.isArray(t)?a=await Promise.all(t.map(((a,i)=>this.getModelTreeNodeData(i,t,e)))):null!==t&&"object"==typeof t&&(a=await Promise.all(Object.keys(t).map((a=>this.getModelTreeNodeData(a,t,e))))),a}async getModelTreeNodeData(e,t,a){let i="".concat(e),s="",n=a?a._refAppDataEntityId:t[e].modeltype;const{fields:o}=await this.loadEntityModel(n),l=a?t[e]:t[e].model;if(Array.isArray(t)){const e=o.find((e=>e.majorField));e&&(i=l[e.appDEFieldId.toLowerCase()])}else if("JSONSCHEMA"!==(null==a?void 0:a._nodeType)||["modeltype","model","requires","_children"].includes(i)){if("DE"===(null==a?void 0:a._nodeType)){n=e;const{entity:t}=await this.loadEntityModel(n);s=(null==t?void 0:t.logicName)||""}}else{const e=o.find((e=>e.appDEFieldId.toLowerCase()===i.toLowerCase()));e&&(s=e.caption,n=e.refAppDataEntityId||n)}const r=(await this.loadEnyityFormItem(n)).find((e=>{var t;return(null==(t=e.appDEFieldId)?void 0:t.toLowerCase())===i.toLowerCase()})),d={text:i,label:s,model:r,id:"".concat(e),refAppDataEntityId:n};return new St(t,a,d)}async loadEnyityFormItem(e,t=this.context){let a=[];try{if(this.entityFieldItemMap.has(e))a=this.entityFieldItemMap.get(e);else{const i=await x("".concat(e.toLowerCase(),"_copymodelform@").concat(e.toLowerCase()),t.srfappid);i&&i.deeditForm&&(k(i.deeditForm,(e=>{"FORMITEM"===e.detailType&&a.push(e)}),{childrenFields:["deformPages","deformTabPages","deformDetails"]}),this.entityFieldItemMap.set(e,a))}}catch(e){ibiz.log.error(e)}return a}async loadEntityModel(e,t=this.context){var a;let i,s=[];try{i=await ibiz.hub.getAppDataEntity(e,t.srfappid),this.entityFeildMap.has(e)?s=this.entityFeildMap.get(e):(null==(a=i.appDEMethodDTOs)||a.forEach((e=>{var t;"DE"===e.sourceType&&"DEFAULT"===e.type&&(null==(t=e.appDEMethodDTOFields)||t.forEach((e=>{var t,a;s.push({caption:e.logicName,appDEFieldId:e.codeName,refAppDataEntityId:e.refAppDataEntityId,majorField:(null==(t=e.codeName)?void 0:t.toLowerCase())===(null==(a=i.majorAppDEFieldId)?void 0:a.toLowerCase())})})))})),this.entityFeildMap.set(e,s))}catch(e){ibiz.log.error(e)}return{entity:i,fields:s}}async loadJsonSchema(e,t=this.context,a={}){let i,s=[];try{if(i=await ibiz.hub.getAppDataEntity(e,t.srfappid),this.entityFeildMap.has(e))s=this.entityFeildMap.get(e);else{const n=I.stringify(a),o=ibiz.hub.getApp(t.srfappid);let l="/jsonschema/".concat(i.name);0===i.dynaSysMode&&ibiz.appData?l+="?dynamodeltag=".concat(ibiz.appData.dynamodeltag).concat(n?"&".concat(n):""):l+="".concat(n?"?".concat(n):"");const r=await o.net.get(l),{data:d}=r;if(!(d.properties&&Object.keys(d.properties).length>0))return{entity:i,fields:s};Object.keys(d.properties).forEach((e=>{var t,a,n,o;const l=d.properties[e];s.push({appDEFieldId:e,caption:l.description,majorField:e.toLowerCase()===(null==(t=null==i?void 0:i.majorAppDEFieldId)?void 0:t.toLowerCase()),refAppDataEntityId:"array"===l.type?null==(n=null==(a=l.items)?void 0:a.$ref)?void 0:n.split(".")[0]:null==(o=l.$ref)?void 0:o.split(".")[0]})})),this.entityFeildMap.set(e,s)}}catch(e){ibiz.log.error(e)}return{entity:i,fields:s}}}var Lt=Object.defineProperty,Nt=(e,t,a)=>(((e,t,a)=>{t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class _t{constructor(e,t,a){this.data=e,this.context=t,this.params=a,Nt(this,"disabled",!1),Nt(this,"readonly",!1),Nt(this,"editor"),Nt(this,"editorProvider"),this.readonly="STATIC"===e._nodeType}get unitName(){var e;return null==(e=this.data._model)?void 0:e.unitName}get valueFormat(){var e;return null==(e=this.data._model)?void 0:e.valueFormat}get dataType(){var e;return null==(e=this.data._model)?void 0:e.dataType}async init(){var e,t;(null==(e=this.data._model)?void 0:e.editor)&&"HIDDEN"!==(null==(t=this.data._model)?void 0:t.editor.editorType)&&(this.editorProvider=await O(this.data._model.editor),this.editorProvider&&(this.editor=await this.editorProvider.createController(this.data._model.editor,this)))}}const Pt=i("svg",{class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"15510"},[i("path",{d:"M512 34.87111179a477.12888821 477.12888821 0 1 0 0 954.25777642A477.12888821 477.12888821 0 0 0 512 34.87111179z m157.99782327 419.05548639a62.57204562 62.57204562 0 0 1-27.40083044-6.61164317c-19.22147806-9.40625523-41.23756819-16.56318854-60.66353007 7.29325586-15.26812442 18.88067173-23.85644441 30.67257139-23.85644441 30.67257139s14.38202792 74.29578403 27.60531425 107.08135477c13.15512506 32.71740947 34.96673139 63.18549705 84.45181321 50.57566215 5.65738539-1.43138667 11.31477078-3.06725714 17.92641394-5.04393396-8.38383618 16.76767235-49.96221072 62.91285197-109.7396443 65.29849642-60.52720754 2.31748316-87.65539289-25.9012825-111.51183728-119.28222207a3618.27284312 3618.27284312 0 0 1-75.11371927 100.46971161 58.95949833 58.95949833 0 0 1-85.26974846 0 63.66262595 63.66262595 0 0 1 0-88.0643605c0.6816127-0.6816127 1.49954795-1.15874159 2.18116064-1.84035429a61.75411038 61.75411038 0 0 1 35.44386027-17.24480124c15.67709204-2.52196698 32.51292567-1.43138667 48.12185644 1.5677092 41.23756819 7.97486855 70.9558818-24.26541202 59.16398213-65.63930276a1566.95943016 1566.95943016 0 0 0-17.58560759-58.55053072C409.75809538 380.17610432 323.6704117 383.85681288 323.6704117 383.85681288s28.90037838-41.91918089 90.65448876-53.64291928c56.57385389-10.76948062 104.08225891 10.22419047 134.68666902 111.03470841 14.99547934-21.74344505 27.74163678-41.23756819 41.57837455-59.98191737 9.33809395-12.47351236 18.74434919-26.99186282 30.26360375-36.94340822 16.08605965-13.49593141 29.17302345-22.69770283 49.07611422-22.69770281 35.375699 0 64.07159356 29.65015233 64.07159356 66.18459292 0.06816127 36.4662793-28.62773329 66.11643165-64.00343229 66.11643165z","p-id":"15511"},null)]),Vt=i("svg",{class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"14313"},[i("path",{d:"M332.8 697.6a44.8 44.8 0 1 0 0-89.6 44.8 44.8 0 0 0 0 89.6z m179.2 0a44.8 44.8 0 1 0 0-89.6 44.8 44.8 0 0 0 0 89.6z m179.2 0a44.8 44.8 0 1 0 0-89.6 44.8 44.8 0 0 0 0 89.6zM256 208v32a16 16 0 0 1-16 16H160v512h80a16 16 0 0 1 16 16v32a16 16 0 0 1-16 16H160a64 64 0 0 1-64-64V256a64 64 0 0 1 64-64h80a16 16 0 0 1 16 16z m512 0v32c0 8.832 7.168 16 16 16h80v512h-80a16 16 0 0 0-16 16v32c0 8.832 7.168 16 16 16h80a64 64 0 0 0 64-64V256a64 64 0 0 0-64-64h-80a16 16 0 0 0-16 16z","p-id":"14314"},null)]),Bt=i("svg",{class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"12281"},[i("path",{d:"M225.28 185.258667c22.997333-23.04 54.186667-35.925333 86.698667-35.925334a42.666667 42.666667 0 0 1 0 85.333334 37.333333 37.333333 0 0 0-37.333334 37.333333v120.021333c0 38.698667-10.112 77.824-30.592 108.501334a144.469333 144.469333 0 0 1-8.490666 11.477333c3.029333 3.669333 5.888 7.509333 8.533333 11.52 20.437333 30.634667 30.549333 69.76 30.549333 108.501333v119.978667a37.333333 37.333333 0 0 0 37.333334 37.333333 42.666667 42.666667 0 1 1 0 85.333334 122.666667 122.666667 0 0 1-122.666667-122.666667v-120.021333c0-24.917333-6.698667-46.848-16.213333-61.141334-9.557333-14.336-18.048-16.170667-21.12-16.170666a42.666667 42.666667 0 1 1 0-85.333334c3.072 0 11.52-1.834667 21.077333-16.170666 9.557333-14.293333 16.256-36.266667 16.256-61.184V272.042667c0-32.554667 12.928-63.744 35.968-86.741334zM669.354667 192a42.666667 42.666667 0 0 1 42.666666-42.666667 122.666667 122.666667 0 0 1 122.666667 122.666667v120.021333c0 24.917333 6.698667 46.848 16.213333 61.141334 9.557333 14.336 18.048 16.170667 21.077334 16.170666a42.666667 42.666667 0 1 1 0 85.333334c-2.986667 0-11.52 1.834667-21.034667 16.170666-9.557333 14.293333-16.256 36.266667-16.256 61.184v119.978667a122.666667 122.666667 0 0 1-122.666667 122.666667 42.666667 42.666667 0 1 1 0-85.333334 37.333333 37.333333 0 0 0 37.333334-37.333333v-120.021333c0-38.698667 10.112-77.824 30.592-108.501334 2.602667-3.968 5.461333-7.808 8.490666-11.477333a144.682667 144.682667 0 0 1-8.533333-11.52c-20.437333-30.634667-30.549333-69.76-30.549333-108.501333V272.042667a37.333333 37.333333 0 0 0-37.333334-37.333334 42.666667 42.666667 0 0 1-42.666666-42.666666z","p-id":"12282"},null)]);function Ut(e){switch(e){case"ARRAY":return Vt;case"OBJECT":return Bt;default:return Pt}}var Rt=a({name:"IBizModelTree",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modelStr:{type:String,required:!0}},emits:{change:e=>!0},setup(e,{emit:t}){const a=v("model-tree"),n=l({}),o=l([]),r=l($()),d=l([]);let c="";const m=l([]),u=new kt(e.context,d),h=async t=>{const a=await u.fetchChildNodes(t);return t?t._children=a:o.value=a,await(async t=>{await Promise.all(t.map((async t=>{const a=new _t(t,e.context,e.params);await a.init(),n.value[t._id]=a})))})(a),a};p((()=>e.modelStr),(()=>{if(e.modelStr!==c)try{c=e.modelStr,d.value=JSON.parse(e.modelStr),"[]"===e.modelStr&&(m.value=[],n.value={})}catch(e){c="",n.value={},d.value=[],m.value=[]}finally{r.value=$()}}),{immediate:!0});const g=(e,a,i)=>{i?e._data[i]=a:e._value=a,c=JSON.stringify(d.value,null,2),t("change",c)};return{ns:a,UUID:r,expandedKeys:m,load:async(e,t)=>{var a;let i=[];const s=e.data?null==(a=n.value[e.data._id])?void 0:a.data:void 0;i=(null==s?void 0:s._children)?s._children:await h(s),t(i)},renderEditor:e=>{const t=n.value[e._id];if(t)return t.editorProvider?b(s(t.editorProvider.formEditor),{value:e._value,data:e._data,controller:t.editor,disabled:t.disabled,readonly:t.readonly,class:a.em("node","editor"),onChange:(t,a)=>{g(e,t,a)}}):i(s("el-input"),{class:a.em("node","editor"),"model-value":e._value,disabled:t.disabled,readonly:t.readonly,onInput:t=>g(e,t)},null)},onExpandChange:(e,t)=>{const a=m.value.includes(e);if(t&&!a)m.value.push(e);else if(!t&&a){const t=m.value.indexOf(e);-1!==t&&m.value.splice(t,1)}}}},render(){return i("div",{class:this.ns.b()},[i(s("el-tree"),{lazy:!0,key:this.UUID,"node-key":"_id",props:{label:"_text",children:"_children",isLeaf:"_leaf"},load:this.load,onNodeExpand:e=>{this.onExpandChange(e._id,!0)},onNodeCollapse:e=>{this.onExpandChange(e._id,!1)},"default-expanded-keys":this.expandedKeys},{default:({data:e})=>{var t;return i("div",{class:this.ns.e("node")},[Ut(e._icon),i("div",{class:this.ns.em("node","caption")},[i("div",{class:this.ns.em("node","text")},[e._text]),i("div",{class:this.ns.em("node","label")},[e._label?"#".concat(e._label):""])]),"OBJECT"!==e._icon?i("div",{class:this.ns.em("node","content")},[i("span",{class:this.ns.em("node","separator")},["==>"]),"ARRAY"===e._icon?i("span",null,["[".concat(null==(t=e._value)?void 0:t.length,"]")]):this.renderEditor(e)]):null])}})])}});const Ft=new z(t.meta.url);var Jt=a({name:"IBizModelRuntime",props:{title:{type:String},modal:{type:Object},entity:{type:Object,required:!0},context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})}},setup(e){const t=v("model-runtime"),a=r((()=>({psdevslnsys:e.context.psdevslnsys,Authorization:"Bearer ".concat(L()),"Content-Type":"application/json"}))),i=r((()=>"".concat(e.entity.name,"__").concat(e.context[e.entity.name.toLowerCase()])));return{ns:t,url:r((()=>"".concat(ibiz.env.baseUrl,"/").concat(ibiz.env.appId,"/psdevslnsys/").concat(e.context.psdevslnsys,"/getruntimenodes"))),headers:a,parentKey:i,configBaseUrl:Ft.dir("assets/json/runtime-model"),onClose:()=>{var t;null==(t=e.modal)||t.dismiss()}}},render(){return i("div",{class:this.ns.b()},[i("div",{class:this.ns.e("title")},[i("div",{class:this.ns.em("title","caption")},[n("模型运行时")]),i("ion-icon",{name:"close-outline",title:"退出",class:this.ns.em("title","icon"),onClick:this.onClose},null)]),i("div",{class:this.ns.e("content")},[i(s("ibiz-model-runtime"),{id:"root",url:this.url,headers:this.headers,parentKey:this.parentKey,configBaseUrl:this.configBaseUrl},null),i(s("loading-mask"),{id:"rootLoadingMask","default-show":"true"},null),i(s("loading-panel"),{id:"rootLoadingPanel"},null)])])}}),qt=a({name:"IBizModelClone",props:{item:{type:Object,required:!0},modal:{type:Object,required:!0},params:{type:Object,default:()=>({})},modelData:{type:Object,required:!0},context:{type:Object,default:()=>({})}},setup(e){const t=v("model-clone"),a=l(),i=l(!1),s=ibiz.hub.getApp(e.context.srfappid),n=e.item.srfdecodename,o=e.context.clone();o[n.toLowerCase()]=e.item.srfkey;h((()=>{(async()=>{try{i.value=!1;const t=await s.deService.exec(n,"CopyModel",o,e.params);t.ok&&t.data&&(a.value=t.data)}catch(e){ibiz.message.error(e.message||"模型拷贝发生未知错误!")}finally{i.value=!0}})()}));return{ns:t,data:a,isLoaded:i,onCancel:()=>{e.modal.dismiss()},onConfirm:async()=>{try{if(a.value){if((await s.deService.exec(n,"PasteModel",o,{...a.value},e.params)).ok)return e.modal.dismiss({ok:!0})}}catch(e){ibiz.message.error(e.message||"模型拷贝发生未知错误!")}return e.modal.dismiss()},onFormDataChange:e=>{if(a.value){const t=e.data[0];a.value.model=t instanceof M?t.$origin:t}}}},render(){var e;return c(i("div",{class:this.ns.b()},[i("div",{class:this.ns.e("title")},[n("模型拷贝")]),i("div",{class:this.ns.e("content")},[this.isLoaded&&i(s("iBizControlShell"),{isSimple:!0,data:null==(e=this.data)?void 0:e.model,context:this.context,params:this.params,modelData:this.modelData,class:this.ns.em("content","control"),onFormDataChange:this.onFormDataChange},null)]),i("div",{class:this.ns.e("footer")},[i(s("el-button"),{title:"确认",onClick:()=>this.onConfirm()},{default:()=>[n("确认")]}),i(s("el-button"),{title:"取消",onClick:()=>this.onCancel()},{default:()=>[n("取消")]})])]),[[u("loading"),!this.isLoaded]])}}),Kt=a({name:"IBizDSLModelClipboardImportView",components:{draggable:w},props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object}},setup(e){const t=v("dsl-model-clipboard-import-view"),a=ibiz.modelClipboard,i=ibiz.dslModelClipboardImportView,s=()=>{ibiz.message.warning("编辑框内，模型内容已重新计算!"),i.state.models=[];try{i.state.items.forEach((e=>{const t=e.models.filter((e=>!!e.dsl)).map((e=>e.dsl));i.state.models.push(...t)})),e=i.state.models.join("\n"),i.state.modelStr=e,i.state.isModelChange=!1}catch(e){ibiz.log.error(e)}var e},n=r((()=>a.state.items.filter((e=>!("dsl"!==e.type||!Object.is(i.state.params.codeName,e.codeName)||-1!==i.state.items.findIndex((t=>Object.is(t.uuid,e.uuid))))&&e))));return{c:i,ns:t,modelClipboardController:a,materialItem:n,closeView:async()=>{var t,a;if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认关闭",desc:"模型数据已变更，确认关闭吗?"})&&(null==(t=e.modal)||t.dismiss(),i.clearAllData())}else null==(a=e.modal)||a.dismiss()},clearModel:async()=>{if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认清除?",desc:"模型数据已变更，将同已拖入模型一同清空，确认清除吗？"})&&i.clearAllData()}else i.clearAllData()},modelChange:e=>{Object.is(i.state.modelStr,e)||(i.state.modelStr=e,i.state.isModelChange=!0)},deleteDropItem:e=>{i.state.items.splice(e,1),s()},dropModelChange:async e=>{if(i.state.isModelChange){await ibiz.confirm.warning({title:"确认操作?",desc:"检测到输入框内容已手动修改，该操作后输入框内容将重新计算，确认操作吗？"})?s():e&&e.added&&null!=e.added.newIndex&&i.state.items.splice(e.added.newIndex,1)}else s()},saveModel:async()=>{var t,a;i.state.isLoading=!0;let s=!1;const n=await ibiz.hub.getAppDataEntity(i.state.params.codeName,e.context.srfappid),o=ibiz.hub.getApp(e.context.srfappid),l=await o.deService.getService(e.context,n.id);try{const t=await l.exec("CompileModelDSL",e.context,{build:!0,dsl:i.state.modelStr,srfmodelv2scope:e.context.srfmodelv2scope},e.params);t.ok&&t.data?i.state.isModelChange=!1:(ibiz.message.error(t.statusText),s=!0)}catch(e){ibiz.message.error((null==e?void 0:e.message)||(null==(t=null==e?void 0:e.data)?void 0:t.message)||(null==e?void 0:e.statusText)||ibiz.i18n.t("core.error.networkAbnormality")),s=!0}if(!s){await ibiz.confirm.warning({title:"关闭导入界面?",desc:"已导入完毕，确认关闭导入界面!"})&&(null==(a=e.modal)||a.dismiss())}setTimeout((()=>{i.state.isLoading=!1}),300)}}},render(){const{isLoading:e,items:t,modelStr:a}=this.c.state;return c(i(s("el-card"),{class:this.ns.b()},{header:()=>i("div",{class:this.ns.b("header")},[i("span",null,[n("模型导入")]),i(s("el-button"),{title:"关闭模型导入窗口",link:!0,onClick:()=>this.closeView()},{default:()=>[n("关闭")]})]),default:()=>i("div",{class:this.ns.b("content")},[i("div",{class:this.ns.b("import-warp")},[i("div",{class:this.ns.b("drop-area")},[i(w,{class:this.ns.b("drop-area-draggable"),group:{name:"StudioDesign"},itemKey:"uuid",list:t,onChange:e=>this.dropModelChange(e)},{item:({element:e,index:t})=>{const a=e;return i("div",{class:this.ns.b("model-drag-item")},[i("div",{class:this.ns.b("model-drag-item-actions")},[i("div",{class:this.ns.b("model-drag-item-action-item"),title:"删除",onClick:()=>this.deleteDropItem(t)},[i("ion-icon",{name:"close-outline"},null)])]),i("div",{class:this.ns.b("model-drag-item-title")},[a.title]),i("div",{class:this.ns.b("model-drag-item-date")},[a.createdDate])])}}),c(i("div",{class:this.ns.b("drop-tooltip")},[n("请从右侧素材区拖入")]),[[m,0===t.length]])]),i("div",{class:this.ns.b("model-edit")},[i(s("iBizDesignCodeEditor"),{language:"groovy",modelValue:a,isChangeLanguage:!1,"onUpdate:modelValue":e=>this.modelChange(e)},{rightToolbar:()=>i("div",{class:this.ns.b("edit-actions")},[i(s("el-button"),{title:"清空当前已拖入模型",size:"small",type:"info",onClick:()=>this.clearModel()},{default:()=>[n("清空")]}),i(s("el-button"),{title:"导入模型数据",size:"small",type:"primary",onClick:()=>this.saveModel()},{default:()=>[n("导入")]})])})])]),i("div",{class:this.ns.b("model-material-warp")},[i("div",{class:this.ns.b("model-material-title")},[n("模型素材")]),i(w,{class:this.ns.b("model-material-content"),sort:!1,group:{name:"StudioDesign",pull:"clone",put:!1},itemKey:"uuid",modelValue:this.materialItem},{item:({element:e})=>{const t=e;return i("div",{class:this.ns.b("model-material-item")},[i("div",{class:this.ns.b("model-material-item-title")},[t.title]),i("div",{class:this.ns.b("model-material-item-date")},[t.createdDate])])}}),c(i("div",{class:this.ns.b("model-material-tooltip")},[n("暂无数据")]),[[m,0===this.materialItem.length]])])])}),[[u("loading"),e&&{text:"数据导入中"}]])}}),Wt=a({name:"IBizDSLModelEditView",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object},caption:{type:String,default:""},codeName:{type:String,required:!0},readonly:{type:Boolean}},setup(e){const t=v("dsl-model-edit-view"),a=l(!1),i=l(""),s=()=>{var t;null==(t=e.modal)||t.dismiss({ok:!0,params:{isSave:a.value}})},n=l(!1),o=l("");return(async()=>{try{n.value=!0,o.value="加载中...";const t=await ibiz.hub.getAppDataEntity(e.codeName,e.context.srfappid),a=ibiz.hub.getApp(e.context.srfappid),s=await a.deService.getService(e.context,t.id),l=await s.exec("ExportModelDSL",e.context,{},e.params);200===l.status&&l.data&&l.data.dsl&&(i.value=l.data.dsl)}catch(e){const t=e;ibiz.message.error(t.message||ibiz.i18n.t("core.error.networkAbnormality"))}finally{n.value=!1}})(),{ns:t,value:i,loading:n,loadingText:o,closeView:s,save:async(t=!1)=>{var l,r,d;a.value=!0;try{n.value=!0,o.value="保存中...";const a=await ibiz.hub.getAppDataEntity(e.codeName,e.context.srfappid),d=ibiz.hub.getApp(e.context.srfappid),c=await d.deService.getService(e.context,a.id),m=(null==(l=a.codeName)?void 0:l.toLowerCase())||"",u=await c.exec("CompileModelDSL",e.context,{build:!0,dsl:i.value.replace(new RegExp("(".concat(m,"\\([^)]*\\))(\\{[^}]*\\}|(?=\\s|$))"),"g"),((e,t,a)=>a&&a.startsWith("{")?"".concat(t,'{\noption(update:"true")').concat(a.slice(1)):"".concat(t,'{\noption(update:"true")}'))),srfkey:e.context[m]},e.params);200!==u.status?ibiz.message.error((null==(r=u.data)?void 0:r.message)||u.statusText||ibiz.i18n.t("core.error.networkAbnormality")):t&&s()}catch(e){const t=e;ibiz.message.error((null==t?void 0:t.message)||(null==(d=null==t?void 0:t.data)?void 0:d.message)||(null==t?void 0:t.statusText)||ibiz.i18n.t("core.error.networkAbnormality"))}finally{n.value=!1}}}},render(){return c(i("div",{class:this.ns.b(),"element-loading-text":this.loadingText},[i("div",{class:this.ns.b("header")},[i("div",{class:this.ns.b("header-back-btn"),onClick:()=>this.closeView()},[i("ion-icon",{name:"chevron-back-outline"},null),i("span",null,[n("返回")])]),i("div",{class:this.ns.b("header-caption")},[this.caption]),i("div",{class:this.ns.b("header-toolbar")},[this.readonly?null:[i(s("el-button"),{size:"small",onClick:()=>this.save(!0)},{default:()=>[n("保存并关闭")]}),i(s("el-button"),{size:"small",onClick:()=>this.save()},{default:()=>[n("保存")]})],i(s("el-button"),{size:"small",onClick:()=>this.closeView()},{default:()=>[n("关闭")]})]),i("div",{class:this.ns.b("header-close-btn"),title:"关闭",onClick:()=>this.closeView()},[i("ion-icon",{name:"close-outline"},null)])]),i("div",{class:this.ns.b("content")},[i(s("iBizDesignCodeEditor"),{language:"groovy",isChangeLanguage:!1,modelValue:this.value,"onUpdate:modelValue":e=>this.value=e,isEnableLoad:!this.loading},null)])]),[[u("loading"),this.loading]])}}),Ht=a({name:"IBizDSLModelClipboardItem",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},data:{type:Object,required:!0},enableSelect:{type:Boolean,default:!1}},emits:["delete"],setup(e,{emit:t}){const a=v("dsl-model-clipboard-item"),i=ibiz.modelClipboard,s=l(!1),n=l(!1),o=r((()=>{let t="info";return e.data.isError?t="danger":e.data.isExport?t="success":s.value&&(t="warning"),t}));(async()=>{if(!e.data.isExport){try{const t=e.data.items.map((e=>e.srfkey)),a={};e.data.models.filter((e=>!!e.dsl)).forEach(((e,t)=>{Object.assign(a,{[t]:e.dsl})})),e.data.isMerge&&(e.data.models=[]),s.value=!0;const i=await ibiz.hub.getAppDataEntity(e.data.codeName,e.context.srfappid),n=ibiz.hub.getApp(e.context.srfappid),o=await n.deService.getService(e.context,i.id),l=await o.exec(e.data.isMerge?"mergemodeldsl":"ExportModelDSL",e.data.isMerge?e.context:{...e.context,[i.deapicodeName]:"___srfkeys___"},e.data.isMerge?{...e.params,dsl:a}:{...e.params,srfkeys:t.join(";")});if(l.ok&&l.data){const t=l.data;e.data.models.push(t)}}catch(t){e.data.isError=!0,e.data.errorInfo=t.message||"模型".concat(e.data.isMerge?"合并":"导出","发生未知错误!"),ibiz.message.error(e.data.errorInfo)}e.data.isExport=!0,i.saveToStore(),setTimeout((()=>{s.value=!1}),300)}})();return d((()=>{n.value=!0})),{ns:a,stateType:o,isLoading:s,modelClipboardController:i,copy:()=>{const t=document.createElement("textarea");t.style.position="absolute",t.style.left="-9999px";const a=e.data.models.filter((e=>!!e.dsl)).map((e=>e.dsl));t.value=a.join("\n"),document.body.appendChild(t),t.select();const i=document.execCommand("copy");document.body.removeChild(t),i?ibiz.message.success("已复制模型数据至剪贴板"):ibiz.message.error("复制模型数据失败")},remove:()=>{t("delete")}}},render(){return i(s("el-timeline-item"),{class:this.ns.b(),timestamp:this.data.createdDate,type:this.stateType,placement:"top"},{default:()=>[i(s("el-card"),{shadow:"hover"},{default:()=>[i("div",{class:this.ns.e("content")},[i("div",{class:this.ns.em("content","title")},[i(s("el-input"),{modelValue:this.data.title,"onUpdate:modelValue":e=>this.data.title=e,onChange:()=>{this.modelClipboardController.saveToStore()}},null)]),i("div",{class:this.ns.em("content","info")},[n("共"),this.data.items.length||this.data.models.length,n("条模型数据")]),i("div",{class:this.ns.e("actions")},[this.enableSelect&&i("div",{class:this.ns.em("actions","item")},[i(s("el-checkbox"),{modelValue:this.data.isSelected,"onUpdate:modelValue":e=>this.data.isSelected=e},null)]),i("div",{class:this.ns.em("actions","item"),onClick:()=>this.copy()},[i("ion-icon",{name:"copy",title:"拷贝"},null)]),i("div",{class:this.ns.em("actions","item"),onClick:()=>this.remove()},[i("ion-icon",{name:"trash",title:"删除"},null)])])]),this.isLoading?i("div",{class:this.ns.e("loading")},[i("div",{class:this.ns.em("loading","inner"),style:{width:"".concat(this.data.models.length/1*100,"%")}},[i("div",{class:this.ns.em("loading","label")},[this.data.models.length,n("/1")])])]):null]})]})}});var Yt=a({name:"IBizDSLModelClipboard",props:{context:{type:Object,default:()=>({})},params:{type:Object,default:()=>({})},modal:{type:Object}},setup(e){var t;const a=v("dsl-model-clipboard"),i=ibiz.modelClipboard,s=l(!1),n=r((()=>i.state.items.filter((e=>"dsl"===e.type)))),o=()=>{n.value.forEach((e=>{e.isSelected=!1}))},d=r((()=>n.value.filter((e=>e.isSelected))));null==(t=e.modal)||t.hooks.beforeDismiss.tapPromise((async()=>{o()}));return{ns:a,items:n,selected:d,controller:i,enableMerge:s,close:()=>{var t;null==(t=e.modal)||t.dismiss()},removeAll:async()=>{if(i.state.items.length>0){await ibiz.confirm.warning({title:"确认删除所有?",desc:"确认删除当前粘贴板的数据?"})&&i.clearAll("dsl")}},handleMerge:async()=>{const e=[];d.value.forEach((t=>{e.push(...t.models)})),o(),ibiz.modelClipboard.createItem({models:e,type:"dsl",isMerge:!0,title:"合并模型",codeName:"pssystem"})},handleChange:e=>{o()}}},render(){let e;return i("div",{class:this.ns.b()},[i("div",{class:this.ns.e("header")},[i("div",{class:this.ns.em("header","title")},[n("DSL模型粘贴板")]),i("div",{class:this.ns.e("actions")},[i("div",{class:this.ns.em("actions","merge")},[this.enableMerge&&i("div",null,[n("已选中"),this.selected.length,n("项")]),i(s("el-switch"),{size:"small","active-text":"合并模型",modelValue:this.enableMerge,"onUpdate:modelValue":e=>this.enableMerge=e,onChange:this.handleChange},null)]),i(s("el-button"),{size:"small",type:"info",onClick:()=>this.removeAll()},{default:()=>[n("清空")]}),i("ion-icon",{name:"close-outline",title:"关闭",onClick:()=>this.close()},null)])]),i("div",{class:this.ns.e("content")},[i(s("el-timeline"),null,(t=e=this.items.map((e=>i(Ht,{data:e,key:e.uuid,params:this.params,context:this.context,enableSelect:this.enableMerge,onDelete:()=>this.controller.removeById(e.uuid)},null))),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!o(t)?e:{default:()=>[e]}))]),this.enableMerge&&i("div",{class:this.ns.e("footer")},[i(s("el-button"),{title:"确定合并",class:this.ns.em("footer","button"),onClick:()=>this.handleMerge()},{default:()=>[i("span",null,[n("确定合并")])]})])]);var t}}),Xt={install(e){e.component("IBizModelClipboard",Be),e.component("IBizModelClipboardItem",Re),e.component("IBizModelClipboardImportView",Fe),e.component("IBizModelClipboardPasteView",Je),e.component("IBizDesignCodeEditor",Mt),e.component("IBizModelEditView",Dt),e.component("IBizModelTree",Rt),e.component("IBizModelRuntime",Jt),e.component("IBizModelClone",qt),e.component("IBizDSLModelClipboard",Yt),e.component("IBizDSLModelClipboardImportView",Kt),e.component("IBizDSLModelEditView",Wt)}};class Gt extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t;if(!ibiz.modelClipboard)return{};if(!Array.isArray(n)||0===n.length)return{};const l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));const c={},m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId);ibiz.modelClipboard.createItem({title:"".concat(u.logicName,"-").concat(u.codeName),codeName:u.codeName,items:n});const p=ibiz.overlay.createDrawer((e=>b(s("IBizModelClipboard"),{modal:e,context:r,params:c})),void 0,{placement:"right",width:500,showClose:!1});return p.present(),await p.onWillDismiss(),{}}}class Qt extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t;if(!ibiz.modelClipboardImportView)return{};const l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));const c={},m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId);ibiz.modelClipboardImportView.updateParams({codeName:u.codeName,srfmodelv2scope:r.srfmodelv2scope});const p=ibiz.overlay.createDrawer((e=>b(s("IBizModelClipboardImportView"),{modal:e,context:r,params:c})),void 0,{placement:"top",showClose:!1});return p.present(),await p.onWillDismiss(),{refresh:!0,refreshMode:1}}}class Zt extends D{async execAction(e,t){var a;const{context:i,params:n,view:o,data:l}=t,r="true"===(null==(a=e.uiactionParamJO)?void 0:a.readonly);if(!r){const e=ibiz.uiDomainManager.get(o.context.srfsessionid);if(null==e?void 0:e.dataModification){const e=await o.call(S.SAVE);if(!e&&null!==e)return{}}}const d=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&l.length>0,c=i.clone(),m=$(),u=ibiz.uiDomainManager.create(m);c.srfsessionid=u.id;const p=[...e.navigateContexts||[]],h=A(o.model.appDataEntityId);if(h&&"NONE"!==e.actionTarget){const e=h,t="srfkey";p.unshift({appId:o.model.appId,key:e,value:t,rawValue:!1})}C(p)&&Object.assign(c,E(p,d?j(p,l):l[0]||{},n,i));const g={},f=e.navigateParams;C(f)&&Object.assign(g,E(f,d?j(f,l):l[0]||{},n,i));const v=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId),y=ibiz.overlay.createDrawer((t=>b(s("IBizModelEditView"),{modal:t,context:c,params:g,caption:o.model.caption||e.caption,codeName:null==v?void 0:v.codeName,readonly:r})),void 0,{placement:"top",showClose:!1});y.present();const w=await y.onWillDismiss();ibiz.uiDomainManager.destroy(m);const I={};return w.ok&&w.params&&w.params.isSave&&(I.refresh=!0,I.refreshMode=1),I}}class ea extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t;if(!ibiz.modelClipboard)return{};if(!Array.isArray(n)||0===n.length)return{};const l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));const c={},m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId);ibiz.modelClipboard.createItem({type:"advanced",title:"".concat(u.logicName,"-").concat(u.codeName),codeName:u.codeName,items:n});const p=ibiz.overlay.createDrawer((e=>b(s("IBizModelClipboard"),{modal:e,type:"advanced",context:r,params:c})),void 0,{placement:"right",width:500,showClose:!1});return p.present(),await p.onWillDismiss(),{}}}class ta extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t;if(!ibiz.modelClipboardImportView)return{};const l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));const c={},m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId);ibiz.modelClipboardPasteView.updateParams({codeName:u.codeName,srfmodelv2scope:r.srfmodelv2scope});const p=ibiz.overlay.createDrawer((e=>b(s("IBizModelClipboardPasteView"),{modal:e,context:r,params:c})),void 0,{placement:"top",showClose:!1});return p.present(),await p.onWillDismiss(),{refresh:!0,refreshMode:1}}}class aa extends D{async execAction(e,t){const{context:a,params:i,data:n}=t;if(!Array.isArray(n)||0===n.length)return{};const o=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,l=a.clone(),r=e.navigateContexts;C(r)&&Object.assign(l,E(r,o?j(r,n):n[0]||{},i,a));const d={},c=e.navigateParams;C(c)&&Object.assign(d,E(c,o?j(c,n):n[0]||{},i,a));const m=n[0].srfdecodename,u={cancel:!0};try{const e=await x("".concat(m.toLowerCase(),"_clonemodelform@").concat(m.toLowerCase()),a.srfappid);if(e&&e.deeditForm){const t=ibiz.overlay.createModal((t=>b(s("IBizModelClone"),{modal:t,item:n[0],params:d,context:l,modelData:e.deeditForm})),void 0,{width:"80%",height:"80%"});t.present();const a=await t.onWillDismiss();u.cancel=!0!==a.ok}else ibiz.message.error("[".concat(m,"] 实体未支持模型克隆！"))}catch(e){ibiz.log.error(e),ibiz.message.error("[".concat(m,"] 实体未支持模型克隆！"))}return u}}class ia extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t,l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));const c={},m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId),p=ibiz.overlay.createDrawer((e=>b(s("IBizModelRuntime"),{modal:e,entity:u,context:r,params:c})),void 0,{placement:"top",showClose:!1});return p.present(),await p.onWillDismiss(),{}}}class sa extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t;if(!ibiz.modelClipboard)return{};if(!Array.isArray(n)||0===n.length)return{};const l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));let c={};const m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a)),Object.keys(c).length&&(Object.keys(c).forEach((e=>{["true","false"].includes(c[e].toLowerCase())&&(c[e]="true"===c[e].toLowerCase())})),c=this.transformObject(c));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId);ibiz.modelClipboard.createItem({type:"dsl",title:"".concat(u.logicName,"-").concat(u.codeName),codeName:u.codeName,items:n});const p=ibiz.overlay.createDrawer((e=>b(s("IBizDSLModelClipboard"),{modal:e,context:r,params:c})),void 0,{placement:"right",width:500,showClose:!1});return p.present(),await p.onWillDismiss(),{}}transformObject(e){return Object.entries(e).reduce(((e,[t,a])=>{const i=t.split("."),s=i.pop();return i.reduce(((e,t)=>e[t]=e[t]||{}),e)[s]=a,e}),{})}}class na extends D{async execAction(e,t){const{context:a,params:i,data:n,view:o}=t;if(!ibiz.dslModelClipboardImportView)return{};const l=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,r=a.clone(),d=e.navigateContexts;C(d)&&Object.assign(r,E(d,l?j(d,n):n[0]||{},i,a));let c={};const m=e.navigateParams;C(m)&&Object.assign(c,E(m,l?j(m,n):n[0]||{},i,a)),Object.keys(c).length&&(Object.keys(c).forEach((e=>{["true","false"].includes(c[e].toLowerCase())&&(c[e]="true"===c[e].toLowerCase())})),c=this.transformObject(c));const u=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId);ibiz.dslModelClipboardImportView.updateParams({codeName:u.codeName,srfmodelv2scope:r.srfmodelv2scope});const p=ibiz.overlay.createDrawer((e=>b(s("IBizDSLModelClipboardImportView"),{modal:e,context:r,params:c})),void 0,{placement:"top",showClose:!1});return p.present(),await p.onWillDismiss(),{refresh:!0,refreshMode:1}}transformObject(e){return Object.entries(e).reduce(((e,[t,a])=>{const i=t.split("."),s=i.pop();return i.reduce(((e,t)=>e[t]=e[t]||{}),e)[s]=a,e}),{})}}class oa extends D{async execAction(e,t){var a;const{context:i,params:n,view:o,data:l}=t,r="true"===(null==(a=e.uiactionParamJO)?void 0:a.readonly);if(!r){const e=ibiz.uiDomainManager.get(o.context.srfsessionid);if(null==e?void 0:e.dataModification){const e=await o.call(S.SAVE);if(!e&&null!==e)return{}}}const d=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&l.length>0,c=i.clone(),m=$(),u=ibiz.uiDomainManager.create(m);c.srfsessionid=u.id;const p=[...e.navigateContexts||[]],h=A(o.model.appDataEntityId);if(h&&"NONE"!==e.actionTarget){const e=h,t="srfkey";p.unshift({appId:o.model.appId,key:e,value:t,rawValue:!1})}C(p)&&Object.assign(c,E(p,d?j(p,l):l[0]||{},n,i));const g={},f=e.navigateParams;C(f)&&Object.assign(g,E(f,d?j(f,l):l[0]||{},n,i));const v=await ibiz.hub.getAppDataEntity(o.model.appDataEntityId,o.model.appId),y=ibiz.overlay.createDrawer((t=>b(s("IBizDSLModelEditView"),{modal:t,context:c,params:g,caption:o.model.caption||e.caption,codeName:null==v?void 0:v.codeName,readonly:r})),void 0,{placement:"top",showClose:!1});y.present();const w=await y.onWillDismiss();ibiz.uiDomainManager.destroy(m);const I={};return w.ok&&w.params&&w.params.isSave&&(I.refresh=!0,I.refreshMode=1),I}}class la extends D{async execAction(e,t){const{context:a,params:i,data:n}=t;if(!ibiz.modelClipboard)return{};const o=["MULTIKEY","MULTIDATA"].includes(e.actionTarget)&&n.length>0,l=a.clone(),r=e.navigateContexts;C(r)&&Object.assign(l,E(r,o?j(r,n):n[0]||{},i,a));const d={},c=e.navigateParams;C(c)&&Object.assign(d,E(c,o?j(c,n):n[0]||{},i,a));const m=ibiz.overlay.createDrawer((e=>b(s("dsl"===d.type?"IBizDSLModelClipboard":"IBizModelClipboard"),{modal:e,type:d.type,context:l,params:d})),void 0,{placement:"right",width:500,showClose:!1});return m.present(),await m.onWillDismiss(),{}}}var ra={install(){const e=new Gt;T("DEUIACTION_EXPORT_TO_MODEL_CLIPBOARD",(()=>e));const t=new Qt;T("DEUIACTION_IMPORT_FOR_MODEL_CLIPBOARD",(()=>t));const a=new Zt;T("DEUIACTION_MODEL_EDIT",(()=>a));const i=new ea;T("DEUIACTION_MODEL_COPY",(()=>i));const s=new ta;T("DEUIACTION_MODEL_PASTE",(()=>s));const n=new aa;T("DEUIACTION_MODEL_CLONE",(()=>n));const o=new ia;T("DEUIACTION_OPEN_MODEL_RUNTIME",(()=>o));const l=new sa;T("DEUIACTION_DSL_EXPORT",(()=>l));const r=new na;T("DEUIACTION_DSL_IMPORT",(()=>r));const d=new oa;T("DEUIACTION_DSL_EDIT",(()=>d));const c=new la;T("DEUIACTION_OPEN_MODEL_CLIPBOARD",(()=>c))}},da=Object.defineProperty,ca=(e,t,a)=>(((e,t,a)=>{t in e?da(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class ma{constructor(e){var t,a;ca(this,"uuid",$()),ca(this,"createdDate",(new Date).toLocaleString(void 0,{hour12:!1})),ca(this,"title",""),ca(this,"isExport",!1),ca(this,"isError",!1),ca(this,"errorInfo"),ca(this,"codeName"),ca(this,"items",[]),ca(this,"models",[]),ca(this,"type","default"),ca(this,"isSelected",!1),ca(this,"isMerge",!1),this.title=e.title,this.codeName=e.codeName,this.type=e.type||"default",this.isMerge=e.isMerge||!1,(null==(t=e.items)?void 0:t.length)&&(this.items=e.items),(null==(a=e.models)?void 0:a.length)&&(this.isMerge||(this.isExport=!0),this.models=e.models)}}var ua=Object.defineProperty,pa=(e,t,a)=>(((e,t,a)=>{t in e?ua(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const ha=new class{constructor(){pa(this,"localStorageKey","ModelClipboardCache")}getModelDataItems(){const e=window.localStorage.getItem(this.localStorageKey);try{if(e){const t=JSON.parse(e);return Array.isArray(t)?t:[]}}catch(e){ibiz.log.error(e)}return[]}saveModelDataItems(e){localStorage.setItem(this.localStorageKey,JSON.stringify(e))}clearModelDataItems(){localStorage.removeItem(this.localStorageKey)}};e("c","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});!function(e,t){!function(t,a){e.exports=a()}(0,(function(){var e=[],t=[],a={},i={},s={};function n(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function o(e,t){return e===t?t:e===e.toLowerCase()?t.toLowerCase():e===e.toUpperCase()?t.toUpperCase():e[0]===e[0].toUpperCase()?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():t.toLowerCase()}function l(e,t){return e.replace(t[0],(function(a,i){var s,n,l=(s=t[1],n=arguments,s.replace(/\$(\d{1,2})/g,(function(e,t){return n[t]||""})));return o(""===a?e[i-1]:a,l)}))}function r(e,t,i){if(!e.length||a.hasOwnProperty(e))return t;for(var s=i.length;s--;){var n=i[s];if(n[0].test(t))return l(t,n)}return t}function d(e,t,a){return function(i){var s=i.toLowerCase();return t.hasOwnProperty(s)?o(i,s):e.hasOwnProperty(s)?o(i,e[s]):r(s,i,a)}}function c(e,t,a,i){return function(i){var s=i.toLowerCase();return!!t.hasOwnProperty(s)||!e.hasOwnProperty(s)&&r(s,s,a)===s}}function m(e,t,a){return(a?t+" ":"")+(1===t?m.singular(e):m.plural(e))}return m.plural=d(s,i,e),m.isPlural=c(s,i,e),m.singular=d(i,s,t),m.isSingular=c(i,s,t),m.addPluralRule=function(t,a){e.push([n(t),a])},m.addSingularRule=function(e,a){t.push([n(e),a])},m.addUncountableRule=function(e){"string"!=typeof e?(m.addPluralRule(e,"$0"),m.addSingularRule(e,"$0")):a[e.toLowerCase()]=!0},m.addIrregularRule=function(e,t){t=t.toLowerCase(),e=e.toLowerCase(),s[e]=t,i[t]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach((function(e){return m.addIrregularRule(e[0],e[1])})),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach((function(e){return m.addPluralRule(e[0],e[1])})),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach((function(e){return m.addSingularRule(e[0],e[1])})),["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[eé]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(m.addUncountableRule),m}))}({exports:{}});var ga=Object.defineProperty,ba=(e,t,a)=>(((e,t,a)=>{t in e?ga(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class fa{constructor(){ba(this,"items",[])}}var va=Object.defineProperty,ya=(e,t,a)=>(((e,t,a)=>{t in e?va(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const wa=new class{constructor(){ya(this,"state",new fa),this.state.items=ha.getModelDataItems()}createItem(e){this.state.items.splice(0,0,new ma(e)),this.saveToStore()}saveToStore(){ha.saveModelDataItems(this.state.items)}removeById(e){const t=this.state.items.findIndex((t=>t.uuid===e));this.state.items.splice(t,1),this.saveToStore()}clearAll(e){this.state.items=this.state.items.filter((t=>t.type!==e)),this.state.items.length?this.saveToStore():ha.clearModelDataItems()}};var $a=Object.defineProperty,Ca=(e,t,a)=>(((e,t,a)=>{t in e?$a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class Ia{constructor(){Ca(this,"isLoading",!1),Ca(this,"items",[]),Ca(this,"importItems",[]),Ca(this,"models",[]),Ca(this,"modelStr",""),Ca(this,"isModelChange",!1),Ca(this,"params",{})}}var xa=Object.defineProperty,Oa=(e,t,a)=>(((e,t,a)=>{t in e?xa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const za=new class{constructor(){Oa(this,"state",new Ia)}updateParams(e){e&&!Object.is(JSON.stringify(e),JSON.stringify(this.state.params))&&(this.state.params=e,this.clearAllData())}clearAllData(){this.state.isLoading=!1,this.state.items=[],this.state.importItems=[],this.state.models=[],this.state.modelStr="",this.state.isModelChange=!1}};var Ma=Object.defineProperty,Da=(e,t,a)=>(((e,t,a)=>{t in e?Ma(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class Ea{constructor(){Da(this,"isLoading",!1),Da(this,"items",[]),Da(this,"importItems",[]),Da(this,"models",[]),Da(this,"modelStr",""),Da(this,"isModelChange",!1),Da(this,"params",{})}}var ja=Object.defineProperty,Sa=(e,t,a)=>(((e,t,a)=>{t in e?ja(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const Aa=new class{constructor(){Sa(this,"state",new Ea)}updateParams(e){e&&!Object.is(JSON.stringify(e),JSON.stringify(this.state.params))&&(this.state.params=e,this.clearAllData())}clearAllData(){this.state.isLoading=!1,this.state.items=[],this.state.importItems=[],this.state.models=[],this.state.modelStr="",this.state.isModelChange=!1}};var Ta=Object.defineProperty,ka=(e,t,a)=>(((e,t,a)=>{t in e?Ta(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class La{constructor(){ka(this,"isLoading",!1),ka(this,"items",[]),ka(this,"importItems",[]),ka(this,"models",[]),ka(this,"modelStr",""),ka(this,"isModelChange",!1),ka(this,"params",{})}}var Na=Object.defineProperty,_a=(e,t,a)=>(((e,t,a)=>{t in e?Na(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const Pa=new class{constructor(){_a(this,"state",new La)}updateParams(e){e&&!Object.is(JSON.stringify(e),JSON.stringify(this.state.params))&&(this.state.params=e,this.clearAllData())}clearAllData(){this.state.isLoading=!1,this.state.items=[],this.state.importItems=[],this.state.models=[],this.state.modelStr="",this.state.isModelChange=!1}};e("i",{install(e){(function(){var e=[];if("undefined"!=typeof window){var a=window;a.customElements&&(!a.Element||a.Element.prototype.closest&&a.Element.prototype.matches&&a.Element.prototype.remove&&a.Element.prototype.getRootNode)||e.push(t.import("./dom-aFvcbrAw.js")),"function"==typeof Object.assign&&Object.entries&&Array.prototype.find&&Array.prototype.includes&&String.prototype.startsWith&&String.prototype.endsWith&&(!a.NodeList||a.NodeList.prototype.forEach)&&a.fetch&&function(){try{var e=new URL("b","http://a");return e.pathname="c%20d","http://a/c%20d"===e.href&&e.searchParams}catch(e){return!1}}()&&"undefined"!=typeof WeakMap||e.push(t.import("./core-js-OCldaz4_.js").then((function(e){return e.c})))}return Promise.all(e)})().then((()=>{Ve()})),e.use(Xt),e.use(ra),ibiz.modelClipboard||(wa.state=f(wa.state),ibiz.modelClipboard=wa),ibiz.modelClipboardImportView||(za.state=f(za.state),ibiz.modelClipboardImportView=za),ibiz.modelClipboardPasteView||(Aa.state=f(Aa.state),ibiz.modelClipboardPasteView=Aa),ibiz.dslModelClipboardImportView||(Pa.state=f(Pa.state),ibiz.dslModelClipboardImportView=Pa)}})}}}));
