System.register(["@ibiz-template/runtime","vue","@ibiz-template/vue3-util","qx-util","element-plus","@ibiz-template/core"],(function(e,i){"use strict";var t,n,r,o,a,s,l,c,d,b,u,g,p,m,h,v,f,y,z,w,x,I,A,C,k,S,O;return{setters:[function(e){t=e.PluginStaticResource,n=e.UIActionUtil,r=e.SysUIActionTag,o=e.EditorController,a=e.getDeACMode,s=e.registerEditorProvider},function(e){l=e.defineComponent,c=e.ref,d=e.watch,b=e.onMounted,u=e.onUnmounted,g=e.withDirectives,p=e.createVNode,m=e.resolveDirective,h=e.resolveComponent,v=e.nextTick},function(e){f=e.getCodeProps,y=e.getEditorEmits,z=e.useNamespace,w=e.useUIStore},function(e){x=e.createUUID},function(e){I=e.ElMessageBox},function(e){A=e.getToken,C=e.StringUtil,k=e.getAppCookie,S=e.CoreConst,O=e.IBizContext}],execute:function(){function D(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function T(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),t.push.apply(t,n)}return t}function E(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?T(Object(t),!0).forEach((function(i){D(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}))}return e}function P(e,i){if(null==e)return{};var t,n,r=function(e,i){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],i.indexOf(t)>=0||(r[t]=e[t]);return r}(e,i);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],i.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}function j(e,i){(null==i||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function L(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function V(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),t.push.apply(t,n)}return t}function U(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?V(Object(t),!0).forEach((function(i){L(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}))}return e}function M(e){return function i(){for(var t=this,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length>=e.length?e.apply(this,r):function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return i.apply(t,[].concat(r,n))}}}function F(e){return{}.toString.call(e).includes("Object")}function N(e){return"function"==typeof e}var _=M((function(e,i){throw new Error(e[i]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),B={changes:function(e,i){return F(i)||_("changeType"),Object.keys(i).some((function(i){return t=e,n=i,!Object.prototype.hasOwnProperty.call(t,n);var t,n}))&&_("changeField"),i},selector:function(e){N(e)||_("selectorType")},handler:function(e){N(e)||F(e)||_("handlerType"),F(e)&&Object.values(e).some((function(e){return!N(e)}))&&_("handlersType")},initial:function(e){var i;e||_("initialIsRequired"),F(e)||_("initialType"),i=e,Object.keys(i).length||_("initialContent")}};function R(e,i){return N(i)?i(e.current):i}function $(e,i){return e.current=U(U({},e.current),i),i}function q(e,i,t){return N(i)?i(e.current):Object.keys(t).forEach((function(t){var n;return null===(n=i[t])||void 0===n?void 0:n.call(i,e.current[t])})),t}var H={create:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};B.initial(e),B.handler(i);var t={current:e},n=M(q)(t,i),r=M($)(t),o=M(B.changes)(e),a=M(R)(t);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return B.selector(e),e(t.current)},function(e){!function(){for(var e=arguments.length,i=new Array(e),t=0;t<e;t++)i[t]=arguments[t];return function(e){return i.reduceRight((function(e,i){return i(e)}),e)}}(n,r,o,a)(e)}]}};var W,G={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},Z=(W=function(e,i){throw new Error(e[i]||e.default)},function e(){for(var i=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.length>=W.length?W.apply(this,n):function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return e.apply(i,[].concat(n,r))}})(G),K={config:function(e){var i;return e||Z("configIsRequired"),i=e,{}.toString.call(i).includes("Object")||Z("configType"),e.urls?(console.warn(G.deprecation),{paths:{vs:e.urls.monacoBase}}):e}};function Y(e,i){return Object.keys(i).forEach((function(t){i[t]instanceof Object&&e[t]&&Object.assign(i[t],Y(e[t],i[t]))})),E(E({},e),i)}var J={type:"cancelation",msg:"operation is manually canceled"};function Q(e){var i=!1,t=new Promise((function(t,n){e.then((function(e){return i?n(J):t(e)})),e.catch(n)}));return t.cancel=function(){return i=!0},t}var X,ee,ie=H.create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}),te=(ee=2,function(e){if(Array.isArray(e))return e}(X=ie)||function(e,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(t.push(a.value),!i||t.length!==i);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return t}}(X,ee)||function(e,i){if(e){if("string"==typeof e)return j(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?j(e,i):void 0}}(X,ee)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),ne=te[0],re=te[1];function oe(e){return document.body.appendChild(e)}function ae(e){var i,t,n=ne((function(e){return{config:e.config,reject:e.reject}})),r=(i="".concat(n.config.paths.vs,"/loader.js"),t=document.createElement("script"),i&&(t.src=i),t);return r.onload=function(){return e()},r.onerror=n.reject,r}function se(){var e=ne((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),i=window.require;i.config(e.config),i(["vs/editor/editor.main"],(function(i){le(i),e.resolve(i)}),(function(i){e.reject(i)}))}function le(e){ne().monaco||re({monaco:e})}var ce=new Promise((function(e,i){return re({resolve:e,reject:i})})),de={config:function(e){var i=K.config(e),t=i.monaco,n=P(i,["monaco"]);re((function(e){return{config:Y(e.config,n),monaco:t}}))},init:function(){var e=ne((function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}}));if(!e.isInitialized){if(re({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),Q(ce);if(window.monaco&&window.monaco.editor)return le(window.monaco),e.resolve(window.monaco),Q(ce);!function(){for(var e=arguments.length,i=new Array(e),t=0;t<e;t++)i[t]=arguments[t];return function(e){return i.reduceRight((function(e,i){return i(e)}),e)}}(oe,ae)(se)}return Q(ce)},__getMonacoInstance:function(){return ne((function(e){return e.monaco}))}};const be=new t(i.meta.url);var ue=Object.defineProperty,ge=(e,i,t)=>(((e,i,t)=>{i in e?ue(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t);class pe{constructor(e,i,t){this.monaco=e,this.editor=i,this.config=t,ge(this,"visible",!1),ge(this,"UUID",x()),ge(this,"debounceTimer",null),ge(this,"abortController",null),this.registerInlineCompletions()}registerInlineCompletions(){this.editor.__inlineCompletionsId=this.UUID;const e=this.monaco.languages.registerInlineCompletionsProvider(this.config.language,{provideInlineCompletions:async(e,i)=>{this.visible=!1;const t=e.getLineContent(i.lineNumber);return this.validate(e)&&t.trim()?(this.debounceTimer&&clearTimeout(this.debounceTimer),new Promise((t=>{this.debounceTimer=window.setTimeout((async()=>{const n=await this.getCompletion(e,i);n?(this.visible=!0,t({items:[{insertText:n,range:new this.monaco.Range(i.lineNumber,i.column,i.lineNumber,i.column)}]})):t({items:[]})}),500)}))):{items:[]}},freeInlineCompletions(e){}});this.editor.addCommand(this.monaco.KeyCode.Tab,(async()=>{this.visible?(this.editor.trigger(null,"editor.action.inlineSuggest.commit",{}),this.visible=!1):this.editor.trigger(null,"tab",{})})),this.editor.onDidDispose((()=>{e.dispose()}))}validate(e){const i=this.monaco.editor.getEditors().find((i=>i.getModel()===e));return!(!i||i.__inlineCompletionsId!==this.UUID)}getLinesValue(e,i,t,n){const r=i.getLineCount(),o="Above"===e?Math.max(1,t.lineNumber-n):Math.min(r,t.lineNumber+1),a="Above"===e?Math.max(1,t.lineNumber-1):Math.min(r,t.lineNumber+n);return("Above"===e?1===t.lineNumber:t.lineNumber===r)?"":i.getValueInRange({startLineNumber:o,startColumn:1,endLineNumber:a,endColumn:i.getLineMaxColumn(a)})}calcContext(e,i){return{position:i,currentLine:e.getLineContent(i.lineNumber),word:(e.getWordAtPosition(i)||e.getWordUntilPosition(i)).word,timestamp:Date.now(),aboveLines:this.getLinesValue("Above",e,i,5),belowLines:this.getLinesValue("Below",e,i,3),languageId:e.getLanguageId()}}getRequestHeaders(){const e={"Content-Type":"application/json",srfsystemid:ibiz.env.dcSystem};A()&&(e["".concat(ibiz.env.tokenHeader,"Authorization")]="".concat(ibiz.env.tokenPrefix,"Bearer ").concat(A()));const{orgData:i}=ibiz;return(null==i?void 0:i.systemid)&&(e.srfsystemid=i.systemid),(null==i?void 0:i.orgid)&&(e.srforgid=i.orgid),e}async getCompletion(e,i){}}const me=new Map([["ibiz",{declare:"\n      /**\n       * @description ibiz全局对象\n       * @type {IApiIBizsys & IApiRuntimeIbizsys}\n       */\n      const ibiz: IApiIBizsys & IApiRuntimeIbizsys;\n      ",interface:"IApiIBizsys & IApiRuntimeIbizsys"}],["view",{declare:"\n      /**\n       * @description 当前视图控制器\n       * @type {IApiViewController}\n       */\n      const view: IApiViewController;\n      ",interface:"IApiViewController"}],["ctrl",{declare:"\n      /**\n       * @description 当前部件控制器\n       * @type {IApiControlController}\n       */\n      const ctrl: IApiControlController;\n      ",interface:"IApiControlController"}],["context",{declare:"\n      /**\n       * @description 当前上下文\n       * @type {IApiContext}\n       */\n      const context: IApiContext;\n      ",interface:"IApiContext"}],["params",{declare:"\n      /**\n       * @description 当前视图参数\n       * @type {IApiParams}\n       */\n      const params: IApiParams;\n      ",interface:"IApiParams"}],["env",{declare:"\n      /**\n       * @description ibiz环境变量\n       * @type {IEnvironment}\n       */\n      const env: IEnvironment & IApiEnvGlobalConfig;\n      ",interface:"IEnvironment & IApiEnvGlobalConfig"}],["app",{declare:"\n      /**\n       * @description 应用控制器\n       * @type {IApiAppHubController}\n       */\n      const app: IApiAppHubController;\n      ",interface:"IApiAppHubController"}],["data",{declare:"\n      /**\n       * @description 当前行为数据，具体数据类型需根据当前逻辑自行判断\n       * @type {(IApiData | IApiData[])}\n       */\n      const data: IApiData | IApiData[];\n      ",interface:"IApiData"}],["appSession",{declare:"\n      /**\n       * @description 全局共享数据对象\n       * @type {IApiData}\n       */\n      const appSession: IApiData;\n      ",interface:"IApiData"}],["parent",{declare:"\n      /**\n       * @description 父级视图控制器\n       * @type {IApiViewController}\n       */\n      const parent: IApiViewController;\n      ",interface:"IApiViewController"}],["topView",{declare:"\n      /**\n       * @description 顶级视图控制器\n       * @type {IApiViewController}\n       */\n      const topView: IApiViewController;\n      ",interface:"IApiViewController"}],["parentView",{declare:"\n      /**\n       * @description 父级视图控制器\n       * @type {IApiViewController}\n       */\n      const parentView: IApiViewController;\n      ",interface:"IApiViewController"}],["topViewSession",{declare:"\n      /**\n       * @description 顶级视图共享数据对象\n       * @type {IApiData}\n       */\n      const topViewSession: IApiData;\n      ",interface:"IApiData"}],["viewSession",{declare:"\n      /**\n       * @description 当前视图共享数据对象\n       * @type {IApiData}\n       */\n      const viewSession: IApiData;\n      ",interface:"IApiData"}],["uiLogic",{declare:"\n      /**\n       * @description 界面逻辑参数对象，属性为当前逻辑所有参数\n       * @type {IApiData}\n       */\n      const uiLogic: IApiData;\n      ",interface:"IApiData"}],["util",{declare:"\n      /**\n       * @description 应用工具\n       * @type {IApiUtil}\n       */\n      const util: IApiUtil;\n      ",interface:"IApiUtil"}]]),he="\n:root.light {\n    /* 功能色 */\n    --ibiz-color-white: rgba(var(--ibiz-white), 1); /* 白色 */\n    --ibiz-color-black: rgba(var(--ibiz-black), 1); /* 黑色 */\n\n    /* 主要颜色 */\n    --ibiz-color-primary: rgba(var(--ibiz-blue-cyan-4), 1); /* 主要颜色，仅在需要非常强调的情况下使用 */\n    --ibiz-color-primary-text: rgba(var(--ibiz-white), 1); /* 主要颜色文字色，和背景色形成对比 */\n    --ibiz-color-primary-hover: rgba(var(--ibiz-blue-cyan-3), 1); /* 主要颜色悬浮态 */\n    --ibiz-color-primary-hover-text: rgba(var(--ibiz-white), 1); /* 主要颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-primary-active: rgba(var(--ibiz-blue-cyan-5), 1); /* 主要颜色激活态 */\n    --ibiz-color-primary-active-text: rgba(var(--ibiz-white), 1); /* 主要颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-primary-disabled: rgba(var(--ibiz-blue-cyan-2), 1); /* 主要颜色禁用态 */\n    --ibiz-color-primary-disabled-text: rgba(var(--ibiz-white), 1); /* 主要颜色禁用态文字色，和背景色形成对比 */\n    --ibiz-color-primary-light-default: rgba(var(--ibiz-blue-cyan-0), 1); /* 浅版主要颜色（多用于背景） */\n    --ibiz-color-primary-light-hover: rgba(var(--ibiz-blue-cyan-1), 1); /* 浅版主要颜色悬浮态 */\n    --ibiz-color-primary-light-active: rgba(var(--ibiz-blue-cyan-2), 1); /* 浅版主要颜色激活态 */\n\n    /* 次要颜色 */\n    --ibiz-color-secondary: rgba(var(--ibiz-light-blue-5), 1); /* 次要颜色，强调作用次于主要颜色，但仍然具有强调作用 */\n    --ibiz-color-secondary-text: rgba(var(--ibiz-white), 1); /* 次要颜色文字色，和背景色形成对比 */\n    --ibiz-color-secondary-hover: rgba(var(--ibiz-light-blue-6), 1); /* 次要颜色悬浮态 */\n    --ibiz-color-secondary-hover-text: rgba(var(--ibiz-white), 1); /* 次要颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-secondary-active: rgba(var(--ibiz-light-blue-7), 1); /* 次要颜色激活态 */\n    --ibiz-color-secondary-active-text: rgba(var(--ibiz-white), 1); /* 次要颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-secondary-disabled: rgba(var(--ibiz-light-blue-2), 1); /* 次要颜色禁用态 */\n    --ibiz-color-secondary-disabled-text: rgba(var(--ibiz-white), 1); /* 次要颜色禁用态文字色，和背景色形成对比 */\n    --ibiz-color-secondary-light-default: rgba(var(--ibiz-light-blue-0), 1); /* 浅版次要颜色（多用于背景），强调作用次于主要颜色，但仍然具有强调作用 */\n    --ibiz-color-secondary-light-hover: rgba(var(--ibiz-light-blue-1), 1); /* 浅版次要颜色悬浮态 */\n    --ibiz-color-secondary-light-active: rgba(var(--ibiz-light-blue-2), 1); /* 浅版次要颜色激活态 */\n\n    /* 第三颜色 */\n    --ibiz-color-tertiary: rgba(var(--ibiz-grey-5), 1); /* 第三颜色，可以在页面上多次使用 */\n    --ibiz-color-tertiary-text: rgba(var(--ibiz-white), 1); /* 第三颜色文字色，和背景色形成对比 */\n    --ibiz-color-tertiary-hover: rgba(var(--ibiz-grey-4), 1); /* 第三颜色悬浮态 */\n    --ibiz-color-tertiary-hover-text: rgba(var(--ibiz-white), 1); /* 第三颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-tertiary-active: rgba(var(--ibiz-grey-6), 1); /* 第三颜色激活态 */\n    --ibiz-color-tertiary-active-text: rgba(var(--ibiz-white), 1); /* 第三颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-tertiary-light-default: rgba(var(--ibiz-grey-0), 1); /* 浅版第三颜色（多用于背景），可以在页面上多次使用 */\n    --ibiz-color-tertiary-light-hover: rgba(var(--ibiz-grey-1), 1); /* 浅版第三颜色悬浮态 */\n    --ibiz-color-tertiary-light-active: rgba(var(--ibiz-grey-2), 1); /* 浅版第三颜色激活态 */\n\n    /* 信息色 */\n    --ibiz-color-info: rgba(var(--ibiz-blue-cyan-4), 1); /* 信息色, 通常用于表达客观、中立信息 */\n    --ibiz-color-info-text: rgba(var(--ibiz-white), 1); /* 信息颜色文字色，和背景色形成对比 */\n    --ibiz-color-info-hover: rgba(var(--ibiz-blue-cyan-3), 1); /* 信息色悬浮态 */\n    --ibiz-color-info-hover-text: rgba(var(--ibiz-white), 1); /* 信息颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-info-active: rgba(var(--ibiz-blue-cyan-5), 1); /* 信息色激活态 */\n    --ibiz-color-info-active-text: rgba(var(--ibiz-white), 1); /* 信息颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-info-disabled: rgba(var(--ibiz-blue-cyan-2), 1); /* 信息色禁用态 */\n    --ibiz-color-info-disabled-text: rgba(var(--ibiz-white), 1); /* 信息颜色禁用态文字色，和背景色形成对比 */\n    --ibiz-color-info-light-default: rgba(var(--ibiz-blue-cyan-0), 1); /* 浅版信息色（多用于背景），通常用于表达客观、中立信息 */\n    --ibiz-color-info-light-hover: rgba(var(--ibiz-blue-cyan-1), 1); /* 浅版信息色悬浮态 */\n    --ibiz-color-info-light-active: rgba(var(--ibiz-blue-cyan-2), 1); /* 浅版信息色激活态 */\n\n    /* 成功色 */\n    --ibiz-color-success: rgba(var(--ibiz-green-5), 1); /* 成功色，表示安全、成功、开启的状态 */\n    --ibiz-color-success-text: rgba(var(--ibiz-white), 1); /* 成功颜色文字色，和背景色形成对比 */\n    --ibiz-color-success-hover: rgba(var(--ibiz-green-4), 1); /* 成功色悬浮态 */\n    --ibiz-color-success-hover-text: rgba(var(--ibiz-white), 1); /* 成功颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-success-active: rgba(var(--ibiz-green-6), 1); /* 成功色激活态 */\n    --ibiz-color-success-active-text: rgba(var(--ibiz-white), 1); /* 成功颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-success-disabled: rgba(var(--ibiz-green-2), 1); /* 成功色禁用态 */\n    --ibiz-color-success-disabled-text: rgba(var(--ibiz-white), 1); /* 成功颜色禁用态文字色，和背景色形成对比 */\n    --ibiz-color-success-light-default: rgba(var(--ibiz-green-0), 1); /* 浅版成功色（多用于背景），表示安全、成功、开启的状态 */\n    --ibiz-color-success-light-hover: rgba(var(--ibiz-green-1), 1); /* 浅版成功色悬浮态 */\n    --ibiz-color-success-light-active: rgba(var(--ibiz-green-2), 1); /* 浅版成功色激活态 */\n\n    /* 警示色 */\n    --ibiz-color-warning: rgba(var(--ibiz-orange-5), 1); /* 警示色，表示警告、不安全的状态 */\n    --ibiz-color-warning-text: rgba(var(--ibiz-white), 1); /* 警示颜色文字色，和背景色形成对比 */\n    --ibiz-color-warning-hover: rgba(var(--ibiz-orange-4), 1); /* 警示色悬浮态 */\n    --ibiz-color-warning-hover-text: rgba(var(--ibiz-white), 1); /* 警示颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-warning-active: rgba(var(--ibiz-orange-6), 1); /* 警示色激活态 */\n    --ibiz-color-warning-active-text: rgba(var(--ibiz-white), 1); /* 警示颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-warning-light-default: rgba(var(--ibiz-orange-0), 1); /* 浅版警示色（多用于背景），表示警告、不安全的状态 */\n    --ibiz-color-warning-light-hover: rgba(var(--ibiz-orange-1), 1); /* 浅版警示色悬浮态 */\n    --ibiz-color-warning-light-active: rgba(var(--ibiz-orange-2), 1); /* 浅版警示色激活态 */\n\n    /* 危险色 */\n    --ibiz-color-danger: rgba(var(--ibiz-red-5), 1); /* 危险色，表示危险的操作、或需要特别注意的危险信息 */\n    --ibiz-color-danger-text: rgba(var(--ibiz-white), 1); /* 危险颜色文字色，和背景色形成对比 */\n    --ibiz-color-danger-hover: rgba(var(--ibiz-red-4), 1); /* 危险色悬浮态 */\n    --ibiz-color-danger-hover-text: rgba(var(--ibiz-white), 1); /* 危险颜色悬浮态文字色，和背景色形成对比 */\n    --ibiz-color-danger-active: rgba(var(--ibiz-red-6), 1); /* 危险色激活态 */\n    --ibiz-color-danger-active-text: rgba(var(--ibiz-white), 1); /* 危险颜色激活态文字色，和背景色形成对比 */\n    --ibiz-color-danger-light-default: rgba(var(--ibiz-red-0), 1); /* 浅版危险色（多用于背景），表示危险的操作、或需要特别注意的危险信息 */\n    --ibiz-color-danger-light-hover: rgba(var(--ibiz-red-1), 1); /* 浅版危险色悬浮态 */\n    --ibiz-color-danger-light-active: rgba(var(--ibiz-red-2), 1); /* 浅版危险色激活态 */\n\n    /* 文本/图标颜色 */\n    --ibiz-color-text-0: rgba(var(--ibiz-grey-9), 1); /* 文本/图标颜色 - 最主要 */\n    --ibiz-color-text-1: rgba(var(--ibiz-grey-7), 1); /* 文本/图标颜色 - 稍次要 */\n    --ibiz-color-text-2: rgba(var(--ibiz-grey-6), 1); /* 文本/图标颜色 - 次要 */\n    --ibiz-color-text-3: rgba(var(--ibiz-grey-4), 1); /* 文本/图标颜色 - 最次要 */\n    --ibiz-color-text-5: #dbe4ec; /* 文本色(特殊) - 应用搜索框使用 */\n    --ibiz-color-text-menu: #dbe4ec; /* 文本 - 特殊-菜单颜色 */\n\n    /* 图标颜色 */\n    --ibiz-color-icon-0: #65b3fc; /* 图标颜色 - 最主要 */\n    --ibiz-color-icon-1: #cbe7fe; /* 图标颜色 - 次要 */\n\n    /* 链接颜色 */\n    --ibiz-color-link: rgba(var(--ibiz-blue-cyan-5), 1); /* 链接颜色，通常用于a标签颜色 */\n    --ibiz-color-link-hover: rgba(var(--ibiz-blue-cyan-4), 1); /* 链接颜色 - 悬浮态 */\n    --ibiz-color-link-active: rgba(var(--ibiz-blue-cyan-6), 1); /* 链接颜色 - 激活态 */\n    --ibiz-color-link-visited: rgba(var(--ibiz-blue-cyan-5), 1); /* 链接颜色 - 已访问 */\n\n    /* 背景色 */\n    --ibiz-color-bg-0: rgba(var(--ibiz-grey-0), 1); /* 背景色 - 最下层（底部页面） */\n    --ibiz-color-bg-1: rgba(var(--ibiz-white), 1); /* 背景色 - 次下层（页面中需要提升的内容） */\n    --ibiz-color-bg-2: rgba(var(--ibiz-white), 1); /* 背景色 - 中间层（模态等容器） */\n    --ibiz-color-bg-3: rgba(var(--ibiz-white), 1); /* 背景色 - 次上层（通知，Toast等） */\n    --ibiz-color-bg-4: rgba(var(--ibiz-white), 1); /* 背景色 - 最上层（特殊） */\n    --ibiz-color-bg-5: rgba(var(--ibiz-blue-cyan-3), 0.6); /* 背景色(特殊) - 应用搜索框使用 */\n    --ibiz-color-bg-overlay: rgba(var(--ibiz-black), 0.5); /* 蒙层背景色 */\n\n    /* 填充色 */\n    --ibiz-color-fill-0: rgba(var(--ibiz-grey-8), 0.05); /* 填充色 - 默认态 */\n    --ibiz-color-fill-1: rgba(var(--ibiz-grey-8), 0.1); /* 填充色 - 悬浮态 */\n    --ibiz-color-fill-2: rgba(var(--ibiz-grey-8), 0.13); /* 填充色 - 激活态 */\n    --ibiz-color-scroll-menu: rgba(132,165,198,.4); /* 填充色 - 特殊-菜单滚动条颜色 */\n\n    /* 边框 */\n    --ibiz-color-border: rgba(var(--ibiz-grey-9), 0.1); /* 默认描边颜色 */\n\n    /* 禁用态 */\n    --ibiz-color-disabled-text: rgba(var(--ibiz-grey-9), 0.35); /* 禁用态 - 文字 */\n    --ibiz-color-disabled-border: rgba(var(--ibiz-grey-1), 1); /* 禁用态 - 描边 */\n    --ibiz-color-disabled-bg: rgba(var(--ibiz-grey-1), 1); /* 禁用态 - 背景 */\n    --ibiz-color-disabled-fill: rgba(var(--ibiz-grey-8), 0.04); /* 禁用态 - 填充 */\n\n    /* 阴影 */\n    --ibiz-color-shadow: rgba(var(--ibiz-black), 0.04); /* 用于模拟描边的阴影颜色 */\n    --ibiz-shadow-elevated: 0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1); /* 用于toast, modal, popover等需要提升层级的界面元素 */\n\n    /* 字号 */\n    --ibiz-font-size-small: 12px; /* 小字体，用于辅助说明、状态提示等 */\n    --ibiz-font-size-regular: 14px; /* 常规字体，页面主体文本默认大小 */\n    --ibiz-font-size-header-6: 16px; /* 标题6级，次级标题或段落小标题 */\n    --ibiz-font-size-header-5: 18px; /* 标题5级，中等标题，用于章节分隔 */\n    --ibiz-font-size-header-4: 20px; /* 标题4级，主要标题，突出内容层级 */\n    --ibiz-font-size-header-3: 24px; /* 标题3级，较大标题，用于页面主标题 */\n    --ibiz-font-size-header-2: 28px; /* 标题2级，特大标题，强调核心内容 */\n    --ibiz-font-size-header-1: 32px; /* 标题1级，最大标题，用于页面核心标题或标语 */\n\n    /* 字重 */\n    --ibiz-font-weight-light: 200; /* 细字体，用于次要文本或提示信息 */\n    --ibiz-font-weight-regular: 400; /* 常规字重，页面主体文本默认粗细 */\n    --ibiz-font-weight-bold: 800; /* 粗字体，用于标题、按钮文本或需要强调的内容 */\n\n    /* 圆角 */\n    --ibiz-border-radius-extra-small: 2px; /* 超小圆角，用于 checkbox 内圆角 */\n    --ibiz-border-radius-small: 4px; /* 小圆角, 用于 button、tag、tabs 等大多数组件, 比较常用 */\n    --ibiz-border-radius-medium: 8px; /* 中圆角, 用于 dropdown、scrollist、transfer 等菜单类组件 */\n    --ibiz-border-radius-large: 12px; /* 大圆角, 用于 modal */\n    --ibiz-border-radius-circle: 50%; /* 全圆角, 用于 avatar, badge 等组件 */\n    --ibiz-border-radius-full: 9999px; /* 用于创建全尺寸圆角，如胶囊标签等 */\n\n    /* 高度 */\n    --ibiz-height-control-small: 24px; /* 小型控件高度，如小尺寸按钮、输入框 */\n    --ibiz-height-control-default: 32px; /* 默认控件高度，适用于大多数按钮、输入框 */\n    --ibiz-height-control-large: 40px; /* 大型控件高度，用于需要突出显示的按钮或输入框 */\n\n    /* 描边尺寸 */\n    --ibiz-border-thickness: 0; /* 无边框，用于隐藏默认描边 */\n    --ibiz-border-thickness-control: 1px; /* 控件默认描边宽度，如按钮、输入框边框 */\n    --ibiz-border-thickness-control-focus: 1px; /* 控件聚焦时的描边宽度，通常配合颜色变化突出状态 */\n\n    /* 图标尺寸 */\n    --ibiz-width-icon-extra-small: 8px; /* 超小图标，用于状态点、微小装饰 */\n    --ibiz-width-icon-small: 12px; /* 小图标，用于按钮内小图标、列表项辅助图标 */\n    --ibiz-width-icon-medium: 16px; /* 中等图标，页面常规图标尺寸（默认） */\n    --ibiz-width-icon-large: 20px; /* 大图标，用于功能区按钮、卡片主图标 */\n    --ibiz-width-icon-extra-large: 24px; /* 特大图标，用于页面主视觉图标或突出功能图标 */\n\n    /* 间距 */\n    --ibiz-spacing-none: 0; /* 无间距，元素紧贴 */\n    --ibiz-spacing-super-tight: 2px; /* 超紧密间距，用于微交互元素 */\n    --ibiz-spacing-extra-tight: 4px; /* 紧密间距，组件内元素间微小间隔 */\n    --ibiz-spacing-tight: 8px; /* 较紧密间距，按钮组、标签间距 */\n    --ibiz-spacing-base-tight: 12px; /* 基础紧密间距，列表项内间距 */\n    --ibiz-spacing-base: 16px; /* 基准间距，页面常规元素间距（默认） */\n    --ibiz-spacing-base-loose: 20px; /* 基础宽松间距，卡片内内容间距 */\n    --ibiz-spacing-loose: 24px; /* 宽松间距，区块间间距、段落间距 */\n    --ibiz-spacing-extra-loose: 32px; /* 超宽松间距，页面主要模块分隔 */\n    --ibiz-spacing-super-loose: 40px; /* 最大间距，页面头部/底部与内容区间隔 */\n}\n";var ve=Object.defineProperty,fe=(e,i,t)=>(((e,i,t)=>{i in e?ve(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t);class ye{constructor(e,i,t){this.monaco=e,this.editor=i,this.config=t,fe(this,"UUID",x()),this.registerByLanguage()}async registerByLanguage(){switch(this.config.language){case"typescript":this.registerTypeScript();break;case"css":this.registerCss()}}registerCss(){this.editor.__inlineCompletionsId=this.UUID;const e=[];(()=>{try{if(he){const i=new Map,t=he.split("\n");let n="";t.forEach((e=>{const t=e.match(/\/\*\s*(.*?)\s*\*\//),r=e.match(/--([\w-]+):\s*([^;]+);\s*\/\*\s*(.*?)\s*\*\//);if(t&&!r&&(n=t[1].trim()),r){const e=r[1].trim(),t=r[3].trim(),o="--".concat(e);i.set(o,{label:"--".concat(e),detail:n,documentation:t})}})),e.push(...i.values())}}catch(e){ibiz.log.error(e)}})();const i=this.monaco.languages.registerCompletionItemProvider("css",{triggerCharacters:["-","--"],provideCompletionItems:(i,t)=>{if(!this.validate(i))return{suggestions:[]};const n=((e,i)=>{const t=e.getLineContent(i.lineNumber).substring(0,i.column-1),n=t.lastIndexOf("var("),r=t.indexOf(")",n);return-1!==n&&(-1===r||r>i.column)})(i,t);return{suggestions:e.map((e=>({label:e.label,kind:4,detail:e.detail,documentation:e.documentation,insertText:n?e.label:"var(".concat(e.label,")")})))}}});this.editor.onDidDispose((()=>{null==i||i.dispose()}))}async registerTypeScript(){let e;this.editor.onDidFocusEditorText((()=>{const i=this.getTypeScriptVariable(),t="ibiz-editor.d.ts";e=this.monaco.languages.typescript.typescriptDefaults.addExtraLib(i,t);const n=this.monaco.editor.getModel(this.monaco.Uri.parse(t));n?n.setValue(i):this.monaco.editor.createModel(i,this.config.language,this.monaco.Uri.parse(t))})),this.editor.onDidBlurEditorText((()=>{null==e||e.dispose()}));const{libName:i}=this.config;if(!this.monaco.languages.typescript.typescriptDefaults.getExtraLibs()[i]&&!window.isTypeScriptLibInitialized){window.isTypeScriptLibInitialized=!0;try{const e=await fetch(be.dir("assets/type/types.txt"));if(200===e.status){const t=await e.text();t&&(this.monaco.languages.typescript.typescriptDefaults.addExtraLib("".concat(t),i),this.monaco.editor.createModel("".concat(t),this.config.language,this.monaco.Uri.parse(i)),this.monaco.languages.registerDefinitionProvider(this.config.language,{provideDefinition:async(e,i)=>{try{const t=await this.monaco.languages.typescript.getTypeScriptWorker(),n=await t(e.uri),r=e.getOffsetAt(i),o=await n.getDefinitionAtPosition(e.uri.toString(),r);if(o&&o.length>0){return o.map((e=>{const i=this.monaco.Uri.parse(e.fileName),t=this.monaco.editor.getModel(i);if(t){const n=t.getPositionAt(e.textSpan.start),r=t.getPositionAt(e.textSpan.start+e.textSpan.length);return{uri:i,range:new this.monaco.Range(n.lineNumber-1,n.column-1,r.lineNumber-1,r.column-1)}}return""})).filter((e=>!!e))}}catch(e){console.error(e)}return{uri:e.uri,range:new this.monaco.Range(1,1,1,1)}}}))}}catch(e){ibiz.log.error(e)}}}getTypeScriptVariable(){const e=[],{globalVariable:i}=this.config;if(i){i.split("|").forEach((i=>{const[t,n=""]=i.split(":"),r=me.get(t);if(r){const i=n||r.interface,t=r.declare.replaceAll(r.interface,i);e.push({declare:t,interface:i})}}))}else e.push(...Array.from(me.values()));const t=[];e.forEach((e=>e.interface.includes("&")?t.push(...e.interface.split("&")):t.push(e.interface)));const n="import { ".concat(Array.from(new Set(t)).join()," } from './ibiz-global'"),r="declare global {".concat(e.map((e=>e.declare)).join(""),"}");return"".concat(n,"\n").concat(r)}validate(e){const i=this.monaco.editor.getEditors().find((i=>i.getModel()===e));return!(!i||i.__inlineCompletionsId!==this.UUID)}}const ze={defaultToken:"invalid",tokenPostfix:".ts",keywords:["abstract","any","as","asserts","bigint","boolean","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","infer","instanceof","interface","is","keyof","let","module","namespace","never","new","null","number","object","out","package","private","protected","public","override","readonly","require","global","return","satisfies","set","static","string","super","switch","symbol","this","throw","true","try","type","typeof","undefined","unique","unknown","var","void","while","with","yield","async","await","of"],operators:["<=",">=","==","!=","===","!==","=>","+","-","**","*","/","%","++","--","<<","</",">>",">>>","&","|","^","!","~","&&","||","??","?",":","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=","@"],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,regexpctl:/[(){}\[\]\$\^|\-*+?\.]/,regexpesc:/\\(?:[bBdDfnrstvwWn0\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/#?[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/\/(?=([^\\\/]|\\.)+\/([dgimsuy]*)(\s*)(\.|;|,|\)|\]|\}|$))/,{token:"regexp",bracket:"@open",next:"@regexp"}],[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/0[xX](@hexdigits)n?/,"number.hex"],[/0[oO]?(@octaldigits)n?/,"number.octal"],[/0[bB](@binarydigits)n?/,"number.binary"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@jsdoc"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],jsdoc:[[/[^\/*]+/,"comment.doc"],[/\*\//,"comment.doc","@pop"],[/[\/*]/,"comment.doc"]],regexp:[[/(\{)(\d+(?:,\d*)?)(\})/,["regexp.escape.control","regexp.escape.control","regexp.escape.control"]],[/(\[)(\^?)(?=(?:[^\]\\\/]|\\.)+)/,["regexp.escape.control",{token:"regexp.escape.control",next:"@regexrange"}]],[/(\()(\?:|\?=|\?!)/,["regexp.escape.control","regexp.escape.control"]],[/[()]/,"regexp.escape.control"],[/@regexpctl/,"regexp.escape.control"],[/[^\\\/]/,"regexp"],[/@regexpesc/,"regexp.escape"],[/\\\./,"regexp.invalid"],[/(\/)([dgimsuy]*)/,[{token:"regexp",bracket:"@close",next:"@pop"},"keyword.other"]]],regexrange:[[/-/,"regexp.escape.control"],[/\^/,"regexp.invalid"],[/@regexpesc/,"regexp.escape"],[/[^\]]/,"regexp"],[/\]/,{token:"regexp.escape.control",next:"@pop",bracket:"@close"}]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\$\{/,{token:"delimiter.bracket",next:"@bracketCounting"}],[/[^\\`$]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}};var we=Object.defineProperty,xe=(e,i,t)=>(((e,i,t)=>{i in e?we(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t);class Ie{constructor(e,i){this.monaco=e,this.config=i,xe(this,"themeName","vs-dark"),this.registerByLanguage()}registerByLanguage(){if("typescript"===this.config.language)this.registerTypeScriptTheme()}registerTypeScriptTheme(){this.themeName="ts-dark-plus",this.monaco.editor.defineTheme(this.themeName,{base:"vs-dark",inherit:!0,rules:[{token:"support.type.object.ts",foreground:"#4FC1FF"},{token:"support.function.method.ts",foreground:"#DCDCAA"},{token:"support.property.ts",foreground:"#9CDCFE"},{token:"delimiter.method.ts",foreground:"#D4D4D4"}],colors:{"editor.foreground":"#D4D4D4","editor.background":"#1E1E1E"}}),this.monaco.languages.setMonarchTokensProvider("typescript",{...ze,tokenizer:{...ze.tokenizer,root:[[/([a-zA-Z_$][\w$]*)(\.)([a-zA-Z_$][\w$]*)(\()/,["support.type.object.ts","delimiter.method.ts","support.function.method.ts","delimiter.method.ts"]],[/([a-zA-Z_$][\w$]*)(\.)([a-zA-Z_$][\w$]*)/,["support.type.object.ts","delimiter.method.ts","support.property.ts"]],...ze.tokenizer.root]}})}}var Ae=Object.defineProperty,Ce=(e,i,t)=>(((e,i,t)=>{i in e?Ae(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t);class ke{constructor(e,i){this.monaco=e,this.config=i,Ce(this,"modules",[]),Ce(this,"theme"),this.theme=new Ie(e,i)}initModules(e){this.modules.push(new pe(this.monaco,e,this.config)),this.modules.push(new ye(this.monaco,e,this.config))}}const Se=l({name:"IBizAICode",props:f(),emits:y(),setup(e,{emit:t}){const o=c(),a=z("code"),s=e.controller,l=x(),g=c(""),m=c(!0),h=c(!1),f=c(!1),y=c(!1),A=c(!1),D=c(!1),T=c(!1),E="ibiz-global.d.ts";let P="";const j=s.model;let L,V,U,M,F,N,_;j.editorParams&&(j.editorParams.enableEdit&&(h.value=!0,f.value=!0,m.value=s.toBoolean(j.editorParams.enableEdit)&&!e.readonly&&!e.disabled),j.editorParams.enableFullScreen&&(y.value=s.toBoolean(j.editorParams.enableFullScreen)),j.editorParams.GLOBALVARIABLE&&(P=j.editorParams.GLOBALVARIABLE));const{UIStore:B,zIndex:R}=w();d((()=>B.theme),(e=>{U.setTheme((e=>{var i;const t=null==(i=null==s?void 0:s.editorParams)?void 0:i.customTheme;return t?"dark"===t?"vs-dark":"vs":"dark"===e?"vs-".concat(B.theme):"vs"})(e))})),d((()=>e.value),(e=>{e!==g.value&&(g.value=e||"",null==V||V.setValue(g.value))}),{immediate:!0});const $=()=>{V&&((e.readonly||e.disabled)&&(h.value=!1,f.value=!0),V.updateOptions({readOnly:h.value?f.value:e.readonly||e.disabled}))};d((()=>e.readonly),$,{immediate:!0}),d((()=>e.disabled),$,{immediate:!0});const q=()=>{null==V||V.dispose(),V=null,null==N||N.clear(),N=null,null==M||M.dispose(),M=null,null==F||F.dispose(),F=null,null==_||_.close()},H=async()=>{if(!s.deACMode||!s.model.appDataEntityId)return;const{contentToolbarItems:o,footerToolbarItems:a,questionToolbarItems:l,otherToolbarItems:c}=function(e){var i,t;const n=[],r=[],o=[],a=[];return null==(t=null==(i=e.deuiactionGroup)?void 0:i.uiactionGroupDetails)||t.forEach((e=>{var i,t,s,l,c;const d={appId:e.appId,id:e.uiactionId,label:e.showCaption?e.caption:"",title:e.tooltip,icon:{showIcon:e.showIcon,cssClass:null==(i=e.sysImage)?void 0:i.cssClass,imagePath:null==(t=e.sysImage)?void 0:t.imagePath}};e.sysImage&&e.sysImage.imagePath&&!e.sysImage.imagePath.startsWith("http")&&(d.icon.imagePath="".concat(ibiz.env.assetsUrl,"/images/").concat(e.sysImage.imagePath)),(null==(s=e.uiactionId)?void 0:s.startsWith("msg_content_"))?n.push(d):(null==(l=e.uiactionId)?void 0:l.startsWith("msg_footer_"))?r.push(d):(null==(c=e.uiactionId)?void 0:c.startsWith("question_"))?o.push(d):a.push(d)})),{contentToolbarItems:n,footerToolbarItems:r,questionToolbarItems:o,otherToolbarItems:a}}(s.deACMode);let d;"true"===s.editorParams.srfaiappendcurdata&&(d=await(async()=>{let i=e.data;if(s.model.appDataEntityId)try{const e=await ibiz.hub.getApp(s.model.appId).deService.exec(s.model.appDataEntityId,"GetTempRealTimeData",s.context,s.params);e.ok&&e.data&&(i=e.data)}catch(e){ibiz.log.warn(e)}return i})());const b=await i.import("@ibiz-template-plugin/ai-chat");_=b.chat||b.default.chat;let u,g="";_.create({containerOptions:{zIndex:R.increment()},chatOptions:{caption:s.deACMode.logicName,context:{...s.context},params:{...s.params,srfactag:s.deACMode.codeName},appendCurData:d,appendCurContent:s.editorParams.srfaiappendcurcontent?C.fill(s.editorParams.srfaiappendcurcontent,s.context,s.params,e.data):void 0,appDataEntityId:s.model.appDataEntityId,contentToolbarItems:o,footerToolbarItems:a,questionToolbarItems:l,otherToolbarItems:c,question:async(e,i,t,n,r)=>{g=x(),u=new AbortController;const o=await ibiz.hub.getApp(i.srfappid).deService.getService(i,n.appDataEntityId);try{await o.aiChatSse((i=>{if(20===i.actionstate&&i.actionresult)e.addMessage({messageid:g,state:i.actionstate,type:"DEFAULT",role:"ASSISTANT",content:i.actionresult});else if(30===i.actionstate&&i.actionresult){const t=JSON.parse(i.actionresult).choices;t&&t.length>0&&e.replaceMessage({messageid:g,state:i.actionstate,type:"DEFAULT",role:"ASSISTANT",content:t[0].content||""})}else 40===i.actionstate&&e.replaceMessage({messageid:g,state:i.actionstate,type:"ERROR",role:"ASSISTANT",content:i.actionresult})}),u,i,t,{messages:r})}catch(i){e.replaceMessage({messageid:g,state:40,type:"ERROR",role:"ASSISTANT",content:i.message||ibiz.i18n.t("app.aiError")}),null==u||u.abort()}finally{return e.completeMessage(g,!0),!0}},abortQuestion:async e=>{null==u||u.abort(),await e.stopMessage({messageid:g,state:30,type:"DEFAULT",role:"ASSISTANT",content:""}),await e.completeMessage(g,!0)},action:(e,i)=>{"backfill"===e&&t("change",i.realcontent)},history:async(e,i,t)=>{const n=await ibiz.hub.getApp(e.srfappid).deService.getService(e,t.appDataEntityId),r=t.appendCurData?t.appendCurData:{},o=await n.aiChatHistory(e,i,r);if(o.data&&Array.isArray(o.data)){let e;o.data.forEach((i=>{if("TOOL"===i.role)e&&i.content&&_.aiChat.updateRecommendPrompt(e,i.content);else{const t={messageid:x(),state:30,type:"DEFAULT",role:i.role,content:i.content,completed:!0};e=t,_.aiChat.addMessage(t)}}))}return!0},recommendPrompt:async(e,i,t)=>{const n=await ibiz.hub.getApp(e.srfappid).deService.getService(e,t.appDataEntityId),r=await n.aiChatRecommendPrompt(e,i,t.message);if(r.ok&&r.data){const e=r.data.choices;return e&&e.length>0?e[0]:null}return null},uploader:{onUpload:async(e,i,t)=>{const n=ibiz.util.file.calcFileUpDownUrl((null==t?void 0:t.context)||s.context,(null==t?void 0:t.params)||s.params,{}),r={},o=k(S.TOKEN);o&&Object.assign(r,{["".concat(ibiz.env.tokenHeader,"Authorization")]:"".concat(ibiz.env.tokenPrefix,"Bearer ").concat(o)});const a=new FormData;a.append("file",e);return(await ibiz.net.axios({url:n.uploadUrl,method:"post",headers:r,data:a,onUploadProgress:e=>{const t=e.loaded/e.total*100;i(t)}})).data}},extendToolbarClick:async(e,i,t,o,a)=>{var l,c;const d=await n.exec(i.id,{view:s.view,ctrl:s.ctrl,context:O.create(t),params:o,data:[a],event:e},i.appId);if(d.closeView)s.view.closeView({ok:!0});else if(d.refresh)switch(d.refreshMode){case 1:s.view.callUIAction(r.REFRESH);break;case 2:null==(l=s.view.parentView)||l.callUIAction(r.REFRESH);break;case 3:null==(c=s.view.getTopView())||c.callUIAction(r.REFRESH)}return d}}})},W=async(e,i)=>{if(e.languages.typescript.typescriptDefaults.getExtraLibs()[i])return;T.value=!0;const t=await e.languages.typescript.getTypeScriptWorker(),n=await t(e.Uri.parse(i));let r;r=setInterval((()=>{(async()=>{(await n.getScriptFileNames()).includes(i)&&r&&(clearInterval(r),r=null,T.value=!1)})()}),600)},G=()=>{v((()=>{D.value=!0,de.config({paths:{vs:"".concat(ibiz.env.pluginBaseUrl,"/monaco-editor@0.45.0/min/vs")}}),de.init().then((i=>{var n,r,c;D.value=!1,V||(L=new ke(i,{id:s.model.id,data:e.data,context:s.context,params:s.params,language:e.language||e.controller.language,libName:E,globalVariable:P}),U=i.editor,V=U.create(o.value,{language:e.language||e.controller.language,theme:L.theme.themeName,foldingStrategy:"indentation",renderLineHighlight:"all",selectOnLineNumbers:!0,minimap:{enabled:!0},suggest:{preview:!0,matchOnWordStartOnly:!1},quickSuggestions:!0,readOnly:h.value?f.value:e.readonly||e.disabled,readOnlyMessage:{value:ibiz.i18n.t("editor.code.readOnlyPrompt")},fontSize:16,fixedOverflowWidgets:!0,scrollBeyondLastLine:!1,overviewRulerBorder:!1}),V.__instanceId=l,null==(c=null==(r=null==(n=V.getContribution("editor.contrib.suggestController"))?void 0:n.widget)?void 0:r.value)||c._setDetailsVisible(!0),W(i,E),L.initModules(V),s.deACMode&&(M=i.languages.registerCodeLensProvider(e.language||e.controller.language,{provideCodeLenses:function(e,t){return(e=>{const i=U.getEditors().find((i=>i.getModel()===e));return!(!i||i.__instanceId!==l)})(e)?{lenses:[{id:"AI",range:new i.Range(1,1,1,1),command:{title:"".concat(s.deACMode.logicName),id:V.addCommand(0,(()=>H()))}}],dispose:()=>{}}:{lenses:[],dispose:()=>{}}},resolveCodeLens:(e,i,t)=>i}))),setTimeout((()=>{V.layout(),V.setValue(g.value)}));const d=()=>{N&&N.clear(),s.placeHolder&&!(null==V?void 0:V.getValue())&&(N=V.createDecorationsCollection([{range:new i.Range(1,1,1,1),options:{isWholeLine:!0,beforeContentClassName:"".concat(a.e("first-prompt")," ghost-text-decoration")}}]))},b=V.setValue.bind(V);V.setValue=e=>{b(e),d()},V.onDidFocusEditorText((()=>{null==N||N.clear()})),V.onDidBlurEditorText((()=>{d()})),V.onDidChangeModelContent((()=>{h.value||(g.value=V.getValue(),t("change",g.value))})),window.addEventListener("resize",(()=>{V.layout()}))})).catch((()=>{D.value=!1}))}))},Z=()=>{f.value=!f.value,V&&(f.value?V.updateOptions({readOnly:!0}):V.updateOptions({readOnly:!1}))},K=async()=>{g.value=String(null==V?void 0:V.getValue()),q(),A.value=!A.value,G()};return b((()=>{G()})),u((()=>{q()})),{ns:a,currentVal:g,codeEditBox:o,isFullScreen:A,hasEnableEdit:h,readonlyState:f,isLoading:D,isTSFileLoading:T,renderFooter:()=>h.value?p("div",{class:[a.b("footer"),{[a.b("footer-dialog")]:A.value}]},[p("div",{class:a.be("footer","cancel"),onClick:()=>{e.value!==(null==V?void 0:V.getValue())?I({title:ibiz.i18n.t("editor.common.confirmCancel"),type:"warning",customClass:a.b("message"),message:p("div",{class:a.be("message","message-content")},[p("p",null,[ibiz.i18n.t("editor.common.confirmCancelPrompt")]),p("p",{class:a.bem("message","message-content","message-tip")},[ibiz.i18n.t("editor.common.cancelEditPrompt")])]),showCancelButton:!0,cancelButtonClass:a.be("message","message-cancel"),confirmButtonClass:a.be("message","message-comfire")}).then((()=>{null==V||V.setValue(String(e.value||"")),Z()})).catch((()=>{null==V||V.focus()})):Z()}},[ibiz.i18n.t("app.cancel")]),p("div",{class:a.be("footer","save"),onClick:()=>(Z(),V&&(g.value=V.getValue(),t("change",g.value)),void(A.value&&K()))},[ibiz.i18n.t("app.save")])]):null,renderHeaderToolbar:()=>h.value||y.value?p("div",{class:a.b("toolbar")},[h.value&&m.value&&f.value?p("i",{class:"fa fa-edit","aria-hidden":"true",onClick:()=>Z()},null):null,y.value?p("span",{class:a.be("toolbar","fullscreen"),title:ibiz.i18n.t("editor.common.".concat(A.value?"minimize":"fullscreen")),onClick:()=>K()},[A.value?p("i",{class:"ch-icon ch-icon-minscreen"},null):p("i",{class:"ch-icon ch-icon-fullscreen"},null)]):null]):null,renderCodeContent:()=>p("div",{ref:o,class:a.e("box"),style:{[a.cssVarBlockName("placeholder")]:'"'.concat(s.placeHolder,'"')}},null),changeFullScreenState:K}},render(){var e,i;const t=!(null==(i=null==(e=this.controller.view)?void 0:e.state)?void 0:i.isLoading)&&this.isLoading;return this.isFullScreen?p(h("el-dialog"),{modelValue:this.isFullScreen,"onUpdate:modelValue":e=>this.isFullScreen=e,class:this.ns.b("dialog-full-screen"),onClose:()=>this.changeFullScreenState()},{default:()=>[g(p("div",{class:[this.ns.b(),{[this.ns.b("editor-readonly")]:this.readonlyState},{[this.ns.b("editor-enable")]:!this.readonlyState}]},[this.renderHeaderToolbar(),this.renderCodeContent(),this.hasEnableEdit&&!this.readonlyState?this.renderFooter():null]),[[m("loading"),t]])]}):g(p("div",{class:[this.ns.b(),{[this.ns.b("editor-readonly")]:this.readonlyState},{[this.ns.b("editor-enable")]:!this.readonlyState}]},[this.renderHeaderToolbar(),this.renderCodeContent(),this.hasEnableEdit&&!this.readonlyState?this.renderFooter():null]),[[m("loading"),t]])}});var Oe=Object.defineProperty,De=(e,i,t)=>(((e,i,t)=>{i in e?Oe(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t);class Te extends o{constructor(){super(...arguments),De(this,"deACMode")}get language(){return this.editorParams.codeType||this.editorParams.language||"typescript"}get theme(){return this.editorParams.theme||"vs-dark"}async onInit(){await super.onInit();const{appDEACModeId:e,appDataEntityId:i}=this.model;e&&(this.deACMode=await a(e,i,this.context.srfappid))}}var Ee=Object.defineProperty,Pe=(e,i,t)=>(((e,i,t)=>{i in e?Ee(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t);class je{constructor(){Pe(this,"formEditor","IBizAICode"),Pe(this,"gridEditor","IBizAICode")}async createController(e,i){const t=new Te(e,i);return await t.init(),t}}e("default",{install(e){e.component("IBizAICode",Se),s("EDITOR_CUSTOMSTYLE_AI_CODE",(()=>new je))}})}}}));
