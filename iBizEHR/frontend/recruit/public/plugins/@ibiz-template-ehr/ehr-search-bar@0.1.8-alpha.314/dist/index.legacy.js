!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(t,r,n){return r=s(r),function(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,l()?Reflect.construct(r,n||[],s(t).constructor):r.apply(t,n))}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(l=function(){return!!e})()}function u(e,t,r,n){var o=c(s(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof o?function(e){return o.apply(r,e)}:o}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},c.apply(null,arguments)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function p(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return r};var t,r={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(t){s=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),l=new F(n||[]);return i(a,"_invoke",{value:C(e,r,l)}),a}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",b={};function g(){}function O(){}function w(){}var S={};s(S,l,(function(){return this}));var P=Object.getPrototypeOf,E=P&&P(P(T([])));E&&E!==n&&o.call(E,l)&&(S=E);var x=w.prototype=g.prototype=Object.create(S);function k(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function N(t,r){function n(i,a,l,u){var c=h(t[i],t,a);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==e(f)&&o.call(f,"__await")?r.resolve(f.__await).then((function(e){n("next",e,l,u)}),(function(e){n("throw",e,l,u)})):r.resolve(f).then((function(e){s.value=e,l(s)}),(function(e){return n("throw",e,l,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(e,t){function o(){return new r((function(r,o){n(e,t,r,o)}))}return a=a?a.then(o,o):o()}})}function C(e,r,n){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var l=n.delegate;if(l){var u=I(l,n);if(u){if(u===b)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var c=h(e,r,n);if("normal"===c.type){if(o=n.done?m:v,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=m,n.method="throw",n.arg=c.arg)}}}function I(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,I(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=h(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,b;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function T(r){if(r||""===r){var n=r[l];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var i=-1,a=function e(){for(;++i<r.length;)if(o.call(r,i))return e.value=r[i],e.done=!1,e;return e.value=t,e.done=!0,e};return a.next=a}}throw new TypeError(e(r)+" is not iterable")}return O.prototype=w,i(x,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:O,configurable:!0}),O.displayName=s(w,c,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===O||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,s(e,c,"GeneratorFunction")),e.prototype=Object.create(x),e},r.awrap=function(e){return{__await:e}},k(N.prototype),s(N.prototype,u,(function(){return this})),r.AsyncIterator=N,r.async=function(e,t,n,o,i){void 0===i&&(i=Promise);var a=new N(f(e,t,n,o),i);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(x),s(x,c,"Generator"),s(x,l,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=T,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return l.type="throw",l.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],l=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},r}function h(e,t,r,n,o,i,a){try{var l=e[i](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){h(i,n,o,a,l,"next",e)}function l(e){h(i,n,o,a,l,"throw",e)}a(void 0)}))}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function m(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(e,t,r){return(t=g(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}System.register(["@ibiz-template/runtime","vue","@ibiz-template/vue3-util","lodash-es","qx-util","@ibiz-template/core"],(function(e,o){"use strict";var c,s,h,y,g,O,w,S,P,E,x,k,N,C,I,L,j,F,T,_,A,D,R,B,G;return{setters:[function(e){c=e.ConfigService,s=e.ValueOP,h=e.ControlController,y=e.calcSearchConds,g=e.ScriptFactory,O=e.ItemsValueOPs,w=e.isSimpleItems,S=e.SearchBarFilterSimpleItemsController,P=e.SearchBarFilterController,E=e.SearchBarFilterItemsController,x=e.registerControlProvider},function(e){k=e.defineComponent,N=e.ref,C=e.computed,I=e.createVNode,L=e.resolveComponent,j=e.createTextVNode,F=e.isVNode,T=e.h},function(e){_=e.useNamespace,A=e.useControlController},function(e){D=e.isNil,R=e.isString},function(e){B=e.createUUID},function(e){G=e.clone}],execute:function(){var o=function(){return m((function e(t,r){var n,o;v(this,e),b(this,"config",void 0),this.model=t,this.context=r,this.config=new c(t.appId,"ehrsearchbar","".concat(r.srfuserid,"_").concat((null===(n=this.model.appDataEntityId)||void 0===n?void 0:n.toLowerCase())||"app","_").concat(null===(o=this.model.codeName)||void 0===o?void 0:o.toLowerCase()))}),[{key:"save",value:(t=d(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.config.save(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"load",value:(e=d(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.config.load());case 1:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e,t}(),U=/\$\{[^}]*\}/,M=[s.IS_NULL,s.IS_NOT_NULL,s.EXISTS,s.NOT_EXISTS],V=function(e){function l(){var e;v(this,l);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return b(e=a(this,l,[].concat(r)),"service",void 0),b(e,"appDataEntity",void 0),b(e,"filterControllers",[]),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(l,e),m(l,[{key:"initState",value:function(){u(l,"initState",this,3)([]),this.state.filters=[],this.state.filterNodes=[],this.state.filterGroups=[],this.state.activeFilter=""}},{key:"onCreated",value:(x=d(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(l,"onCreated",this,3)([]);case 2:return e.next=4,ibiz.hub.getAppDataEntity(this.model.appDataEntityId,this.context.srfappid);case 4:return this.appDataEntity=e.sent,this.service=new o(this.model,this.context),e.next=8,this.initSearchBarFilters();case 8:return e.next=10,this.service.load();case 10:t=e.sent,r=t.filters,this.state.filters=r||[],this.initFilterNodes(),this.initFilterGroup();case 15:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"getFilterParams",value:function(){var e=this,t={},r=G(this.state.filterNodes);r[0].children=r[0].children.filter((function(e){return"FIELD"!==e.nodeType||!(!e.field||!e.valueOP||!M.includes(e.valueOP)&&D(e.value))}));var n=y(r,{after:function(t,r){"FIELD"===t.nodeType&&R(t.value)&&U.test(t.value)&&(r.value=g.execSingleLine("`".concat(t.value,"`"),function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.getEventArgs())))}});return n&&Object.assign(t,{searchconds:n}),t}},{key:"findFilterControllerByNode",value:function(e){return this.filterControllers.find((function(t){return"SIMPLE_ITEMS"!==t.type&&(t.fieldName===e.field&&(!t.valueOP||t.valueOP===e.valueOP))}))}},{key:"initSearchBarFilters",value:(h=d(p().mark((function e(){var t,r,n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.model.searchBarFilters)&&t.length){e.next=3;break}return e.abrupt("return");case 3:return r=new Map,t.forEach((function(e){var t;if(null!==(t=e.defsearchMode)&&void 0!==t&&t.valueOP&&O.includes(e.defsearchMode.valueOP)){if(w(e))return void n.filterControllers.push(new S(e,n.appDataEntity,n.context,n.params));var o="".concat(e.appDEFieldId,"_").concat(e.defsearchMode.valueOP);return r.has(o)||r.set(o,[]),void r.get(o).push(e)}var i=new P(e,n.appDataEntity,n.context,n.params);n.filterControllers.push(i)})),r.size>0&&r.forEach((function(e){var t=new E(e,n.appDataEntity,n.context,n.params);n.filterControllers.push(t)})),e.next=8,Promise.all(this.filterControllers.map((function(e){return e.init()})));case 8:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"initFilterNodes",value:function(){var e=this.model.groupMode,t=this.filterControllers.filter((function(e){var t;return"true"===(null===(t=e.model.userParam)||void 0===t?void 0:t.defaultShow)})).map((function(e){return{nodeType:"FIELD",field:e.key,valueOP:e.valueOP,value:null}}))||[];this.state.filterNodes=[{children:t,nodeType:"GROUP",logicType:"OR"===e?"OR":"AND"}]}},{key:"initFilterGroup",value:function(){var e=this.filterControllers.map((function(e){var t;return{key:e.key,caption:e.label,selected:"true"===(null===(t=e.model.userParam)||void 0===t?void 0:t.defaultShow)}})),n=this.model.searchBarGroups,o=(null==n?void 0:n.map((function(e){var t=[];if(e.data)try{var r,n=JSON.parse(e.data);n.theme_model.searchconds&&(t=(null===(r=n.theme_model.searchconds[0])||void 0===r||null===(r=r.searchconds)||void 0===r?void 0:r.map((function(e){return e.fieldname})))||[])}catch(o){ibiz.log.error(ibiz.i18n.t("runtime.controller.control.searchBar.JSONFormat",{data:e.data}),o)}return{keys:t,groupName:e.caption}})))||[],i=e.reduce((function(e,t){var n,i=(null===(n=o.find((function(e){return e.keys.includes(t.key)})))||void 0===n?void 0:n.groupName)||"未分类",a=e.get(i)||[];return e.set(i,[].concat(r(a),[t]))}),new Map),a=r(i.entries()).map((function(e){var r=t(e,2);return{caption:r[0],children:r[1]}})),l=a.findIndex((function(e){return"未分类"===e.caption}));if(-1!==l){var u=a.splice(l,1)[0];a.push(u)}this.state.filterGroups=a}},{key:"handleFilterChange",value:function(e){var t=this;this.state.activeFilter=e;var r=this.state.filters.find((function(t){return t.key===e}));if(r){var n=this.model.groupMode,o=r.filterNodeFields.filter((function(e){return!!t.findFilterControllerByNode(e)}));this.state.filterNodes=[{children:o,nodeType:"GROUP",logicType:"OR"===n?"OR":"AND"}]}else this.initFilterNodes();this.onSearch()}},{key:"handleFilterItemChange",value:function(e,t){var r=this.filterControllers.find((function(t){return t.key===e}));if(r){var o,i=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){u=!0,a=e},f:function(){try{l||null==r.return||r.return()}finally{if(u)throw a}}}}(this.state.filterGroups);try{for(i.s();!(o=i.n()).done;){var a=o.value.children.find((function(t){return t.key===e}));if(a){a.selected=t;break}}}catch(u){i.e(u)}finally{i.f()}var l=this.state.filterNodes[0].children;t?l.push({nodeType:"FIELD",field:r.key,valueOP:r.valueOP,value:null}):(this.state.filterNodes[0].children=l.filter((function(t){return t.field!==e})),this.onSearch())}}},{key:"onSearch",value:function(){this.evt.emit("onSearch",void 0)}},{key:"onReset",value:function(){this.handleFilterChange(this.state.activeFilter),this.onSearch()}},{key:"onSaveFilter",value:(s=d(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=B(),n={key:r,caption:t,filterNodeFields:this.state.filterNodes[0].children},this.state.filters.push(n),e.next=5,this.service.save({filters:this.state.filters});case 5:this.state.activeFilter=r;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"onRemoveFilter",value:(c=d(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===(r=this.state.filters.findIndex((function(e){return e.key===t})))){e.next=6;break}return this.state.filters.splice(r,1),e.next=5,this.service.save({filters:this.state.filters});case 5:this.state.activeFilter===t&&(this.state.activeFilter="",this.initFilterNodes());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})}]);var c,s,h,x}(h);function z(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!F(e)}var X=[{valueOP:s.EQ,label:"等于(=)"},{valueOP:s.NOT_EQ,label:"不等于(<>)"},{valueOP:s.GT,label:"大于(>)"},{valueOP:s.GT_AND_EQ,label:"大于等于(>=)"},{valueOP:s.LT,label:"小于(<)"},{valueOP:s.LT_AND_EQ,label:"小于等于(<=)"},{valueOP:s.IS_NULL,label:"值为空(Nil)"},{valueOP:s.IS_NOT_NULL,label:"值不为空(NotNil)"},{valueOP:s.IN,label:"值在范围中(In)"},{valueOP:s.NOT_IN,label:"值不在范围中(NotIn)"},{valueOP:s.LIKE,label:"文本包含(%)"},{valueOP:s.LIFT_LIKE,label:"文本左包含(%#)"},{valueOP:s.RIGHT_LIKE,label:"文本右包含(#%)"},{valueOP:s.EXISTS,label:"存在(EXISTS)"},{valueOP:s.NOT_EXISTS,label:"不存在(NOTEXISTS)"}],H=[s.IS_NULL,s.IS_NOT_NULL,s.EXISTS,s.NOT_EXISTS],q=k({name:"SearchBar",props:{controller:{type:Object,required:!0},modal:{type:Object}},setup:function(e){var t=_("search-bar"),n=e.controller,o=N(""),i=N([]),a=N(""),l=N(!1),u=C((function(){var e;return(null===(e=n.state.filterNodes[0])||void 0===e?void 0:e.children)||[]})),c=C((function(){var e;return((null===(e=n.state.filterNodes[0])||void 0===e?void 0:e.children)||[]).length})),s=function(){var e=d(p().mark((function e(){var t=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length>0&&void 0!==t[0]&&t[0])){e.next=4;break}return e.next=4,n.onSaveFilter(a.value);case 4:l.value=!1,a.value="";case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(e,r){if(!r.editor||!r.editorProvider||e.valueOP&&H.includes(e.valueOP))return null;var o=r.calcEditorProps(e),i=o.data,a=o.value;return I("div",{class:t.em("filter-node","editor")},[T(L(r.editorProvider.formEditor),{data:i,value:a,disabled:e.disabled,controller:r.editor,key:r.editor.model.id,onChange:function(t,o){r.onEditorChange(e,t,o),n.onSearch()}})])};return{c:n,ns:t,renderTop:function(){if(e.modal)return I("div",{class:t.e("top")},[I("div",{class:t.em("top","title")},[I(L("ion-icon"),{name:"filter-circle"},null),n.model.logicName,I("sup",{class:t.em("top","counter")},[c.value])]),I(L("ion-icon"),{title:"关闭",name:"close-outline",class:t.em("top","close"),onClick:function(t){return e.modal.dismiss()}},null)])},renderHeader:function(){var e;return I("div",{class:t.e("header")},[I("div",{class:t.em("header","title")},[j("筛选条件")]),I(L("el-select"),{clearable:!0,placeholder:0===n.state.filters.length?"暂无已保存的筛选条件":"选择已保存的筛选条件",class:t.em("header","select"),popperClass:t.e("filter-select"),"model-value":n.state.activeFilter,disabled:0===n.state.filters.length,onChange:function(e){return n.handleFilterChange(e)}},z(e=n.state.filters.map((function(e){return I(L("el-option"),{key:e.key,value:e.key,label:e.caption,class:t.em("filter-select","item")},{default:function(){return[I("div",null,[e.caption]),I(L("ion-icon"),{title:"删除",name:"close-outline",class:t.em("filter-select","remove"),onClick:function(t){t.stopPropagation(),n.onRemoveFilter(e.key)}},null)]}})})))?e:{default:function(){return[e]}}),I("div",{class:t.em("header","actions")},[I(L("el-popover"),{trigger:"click",placement:"bottom",class:t.e("popover"),visible:l.value,"onUpdate:visible":function(e){return l.value=e}},{reference:function(){return I(L("el-button"),{type:"text"},{default:function(){return[j("保存")]}})},default:function(){return I("div",{class:t.em("popover","content")},[I(L("el-input"),{placeholder:"筛选条件名称",modelValue:a.value,"onUpdate:modelValue":function(e){return a.value=e},class:t.em("popover","filter-name")},null),I("div",{class:t.em("popover","actions")},[I(L("el-button"),{type:"text",disabled:!a.value,onClick:function(){return s(!0)}},{default:function(){return[j("确认")]}}),I(L("el-button"),{type:"text",onClick:function(){return s()}},{default:function(){return[j("取消")]}})])])}}),I(L("el-button"),{type:"text",onClick:function(){return n.onReset()}},{default:function(){return[j("还原")]}})])])},renderContent:function(){return I("div",{class:t.e("content")},[u.value.map((function(e){var r;if("FIELD"===e.nodeType){var o=n.findFilterControllerByNode(e);if(o){var i=X.filter((function(e){return!o.valueOP||e.valueOP===o.valueOP}));return I("div",{class:t.e("filter-node")},[I("div",{class:t.em("filter-node","header")},[I("div",{class:t.em("filter-node","label")},[o.label]),I(L("ion-icon"),{title:"删除",name:"close-outline",class:t.em("filter-node","remove"),onClick:function(){return n.handleFilterItemChange(o.key,!1)}},null)]),I(L("el-select"),{disabled:e.disabled||o.valueOP,"model-value":e.valueOP,class:t.em("filter-node","op-select"),onChange:function(t){return function(e,t){e.valueOP=t,e.value=null}(e,t)}},z(r=i.map((function(e){return I(L("el-option"),{label:e.label,key:e.valueOP,value:e.valueOP},null)})))?r:{default:function(){return[r]}}),f(e,o)])}}}))])},renderFooter:function(){return I("div",{class:t.e("footer")},[I(L("el-popover"),{width:200,placement:"top",trigger:"click",class:t.e("popover"),popperStyle:{height:"360px"},onShow:function(){return o.value="",void(i.value=r(Array(n.state.filterGroups.length).keys()))}},{reference:function(){return I(L("el-button"),{type:"text"},{default:function(){return[I(L("ion-icon"),{name:"add-outline"},null),j("添加筛选项")]}})},default:function(){var e;return I("div",{class:t.em("popover","content")},[I(L("el-input"),{placeholder:"搜索",modelValue:o.value,"onUpdate:modelValue":function(e){return o.value=e},class:t.em("popover","search")},{suffix:function(){return I(L("ion-icon"),{name:"search-outline"},null)}}),I(L("el-collapse"),{modelValue:i.value,"onUpdate:modelValue":function(e){return i.value=e},class:t.em("popover","collapse")},z(e=n.state.filterGroups.map((function(e,r){var i;return I(L("el-collapse-item"),{name:r,title:e.caption},z(i=e.children.map((function(e){if(!o.value||e.caption.includes(o.value))return I(L("el-checkbox"),{class:t.em("popover","filter"),label:e.caption,"model-value":e.selected,onChange:function(t){return n.handleFilterItemChange(e.key,t)}},null)})))?i:{default:function(){return[i]}})})))?e:{default:function(){return[e]}})])}})])}}},render:function(){return I("div",{class:this.ns.b()},[this.renderTop(),this.renderHeader(),this.renderContent(),this.renderFooter()])}}),Q=k({name:"IBizEhrSearchBarControl",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object}},setup:function(){var e=A((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,t,r){if(l())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&f(o,r.prototype),o}(V,t)})),t=_("ehr-search-bar"),r=N(),n=function(){var t=d(p().mark((function t(n){var o;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(o=ibiz.overlay.createPopover((function(t){return T(q,{controller:e,modal:t})}),{},{height:"80%",noArrow:!0,autoClose:!0,placement:"top",width:"".concat(r.value.ref.offsetWidth,"px")})).present(n.target),t.next=4,o.onWillDismiss();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{c:e,ns:t,buttonRef:r,openSearchModal:n}},render:function(){var e=this;return I("div",{class:this.ns.b()},["SEARCHBAR2"===this.c.model.searchBarStyle?I(L("el-button"),{type:"text",ref:"buttonRef",class:this.ns.e("button"),onClick:this.openSearchModal},{default:function(){return[I("div",{class:e.ns.em("button","left")},[I(L("ion-icon"),{name:"filter-circle"},null),e.c.model.logicName]),I(L("ion-icon"),{name:"caret-up",class:e.ns.em("button","right")},null)]}}):I(q,{controller:this.c},null)])}}),K=m((function e(){v(this,e),b(this,"component","IBizEhrSearchBarControl")}));e("default",{install:function(e){e.component(Q.name,Q),x("CUSTOM_FILTER_SEARCHBAR",(function(){return new K}))}})}}}))}();
